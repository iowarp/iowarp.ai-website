<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-sdk/runtime_modules" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Chimaera Module Development Guide | IOWarp - Context Engineering for Agentic AI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.iowarp.ai/img/iowarp_logo.png"><meta data-rh="true" name="twitter:image" content="https://www.iowarp.ai/img/iowarp_logo.png"><meta data-rh="true" property="og:url" content="https://www.iowarp.ai/docs/sdk/runtime_modules"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Chimaera Module Development Guide | IOWarp - Context Engineering for Agentic AI"><meta data-rh="true" name="description" content="Linking"><meta data-rh="true" property="og:description" content="Linking"><link data-rh="true" rel="icon" href="/img/favicons/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.iowarp.ai/docs/sdk/runtime_modules"><link data-rh="true" rel="alternate" href="https://www.iowarp.ai/docs/sdk/runtime_modules" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.iowarp.ai/docs/sdk/runtime_modules" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Chimaera Module Development Guide","item":"https://www.iowarp.ai/docs/sdk/runtime_modules"}]}</script><link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="IOWarp - Context Engineering for Agentic AI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="IOWarp - Context Engineering for Agentic AI Atom Feed">





<meta name="description" content="Infrastructure for autonomous scientific exploration. 15 MCP servers, ClaudIO agent framework, context orchestration. $5M NSF funded.">
<meta name="keywords" content="context engineering, agentic AI, autonomous agents, scientific computing, HPC, Model Context Protocol, MCP, IOWarp, ClaudIO, data orchestration, machine learning, computational science">
<meta name="author" content="IOWarp Project - Gnosis Research Center, Illinois Institute of Technology">
<meta property="og:title" content="IOWarp - Context Engineering for Agentic AI">
<meta property="og:description" content="Infrastructure for autonomous scientific exploration. 15 MCP servers, ClaudIO agent framework, context orchestration. $5M NSF funded.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.iowarp.ai">
<meta property="og:image" content="https://www.iowarp.ai/img/iowarp_logo.png">
<meta property="og:image:width" content="800">
<meta property="og:image:height" content="800">
<meta property="og:image:alt" content="IOWarp Logo - Context Engineering for Agentic AI in Scientific Computing">
<meta property="og:image:type" content="image/png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="IOWarp - Context Engineering for Agentic AI">
<meta name="twitter:description" content="15 MCP servers for scientific computing. ClaudIO agents. Context orchestration. $5M NSF funded.">
<meta name="twitter:image" content="https://www.iowarp.ai/img/iowarp_logo.png">
<meta name="twitter:image:alt" content="IOWarp Logo - Context Engineering for Agentic AI in Scientific Computing">
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<link rel="alternate" type="application/rss+xml" title="IOWarp News RSS Feed" href="https://www.iowarp.ai/news/rss.xml">
<link rel="alternate" type="application/atom+xml" title="IOWarp News Atom Feed" href="https://www.iowarp.ai/news/atom.xml">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://github.com"><link rel="stylesheet" href="/assets/css/styles.a5d29b90.css">
<script src="/assets/js/runtime~main.b2ea8c75.js" defer="defer"></script>
<script src="/assets/js/main.411b0851.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/iowarp_logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="sticky top-0 z-50"><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/iowarp_logo.png" alt="IOWarp Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/iowarp_logo.png" alt="IOWarp Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">IOWarp</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Platform</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/platform/overview">Overview</a></li><li><a class="dropdown__link" href="/platform/intelligence">Intelligence</a></li><li><a class="dropdown__link" href="/platform/tooling">Tooling</a></li><li><a class="dropdown__link" href="/platform/storage">Storage</a></li><li><a class="dropdown__link" href="/platform/performance">Performance</a></li></ul></div><a class="navbar__item navbar__link" href="/use-cases">Use Cases</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Research</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/research/papers">Papers</a></li><li><a class="dropdown__link" href="/research/demos">Demos</a></li><li><a class="dropdown__link" href="/news">News</a></li></ul></div><a class="navbar__item navbar__link" href="/community">Community</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a href="https://github.com/iowarp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item">
            <a href="/news/rss.xml" class="navbar__link" title="RSS Feed" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 0.25rem; vertical-align: middle;">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" style="margin-top: 2px;">
                <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/>
              </svg>
              RSS
            </a>
          </div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav></div><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro"><span title="Welcome to IOWarp Documentation" class="linkLabel_WmDU">Welcome to IOWarp Documentation</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/getting-started/installation"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/deployment/hpc-cluster"><span title="Deployment" class="categoryLinkLabel_W154">Deployment</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/agent-toolkit/mcp"><span title="Agent Toolkit" class="categoryLinkLabel_W154">Agent Toolkit</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/sdk/interprocess"><span title="IOWarp SDK" class="categoryLinkLabel_W154">IOWarp SDK</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sdk/interprocess"><span title="Hermes Shared Memory (CTE)" class="linkLabel_WmDU">Hermes Shared Memory (CTE)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/sdk/runtime_modules"><span title="Chimaera Module Development Guide" class="linkLabel_WmDU">Chimaera Module Development Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sdk/context_transfer"><span title="Context Transfer SDK" class="linkLabel_WmDU">Context Transfer SDK</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sdk/context_assimilation"><span title="Context Assimilation SDK" class="linkLabel_WmDU">Context Assimilation SDK</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/api/python-api"><span title="API Reference" class="categoryLinkLabel_W154">API Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/faq"><span title="FAQ" class="categoryLinkLabel_W154">FAQ</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">IOWarp SDK</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Chimaera Module Development Guide</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Chimaera Module Development Guide</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="linking">Linking<a href="#linking" class="hash-link" aria-label="Direct link to Linking" title="Direct link to Linking" translate="no">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">find_package(iowarp-core CONFIG)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="table-of-contents">Table of Contents<a href="#table-of-contents" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents" translate="no">​</a></h2>
<ol>
<li class=""><a href="#overview" class="">Overview</a></li>
<li class=""><a href="#architecture" class="">Architecture</a></li>
<li class=""><a href="#coding-style" class="">Coding Style</a></li>
<li class=""><a href="#module-structure" class="">Module Structure</a>
<ul>
<li class=""><a href="#task-definition-mod_name_tasksh" class="">Task Definition</a></li>
<li class=""><a href="#client-implementation-mod_name_clienthcc" class="">Client Implementation</a></li>
<li class=""><a href="#runtime-container-mod_name_runtimehcc" class="">Runtime Container</a></li>
<li class=""><a href="#execution-modes-and-dynamic-scheduling" class="">Execution Modes and Dynamic Scheduling</a></li>
</ul>
</li>
<li class=""><a href="#configuration-and-code-generation" class="">Configuration and Code Generation</a></li>
<li class=""><a href="#task-development" class="">Task Development</a></li>
<li class=""><a href="#synchronization-primitives" class="">Synchronization Primitives</a></li>
<li class=""><a href="#pool-query-and-task-routing" class="">Pool Query and Task Routing</a></li>
<li class=""><a href="#client-server-communication" class="">Client-Server Communication</a></li>
<li class=""><a href="#memory-management" class="">Memory Management</a>
<ul>
<li class=""><a href="#chi_client-buffer-allocation" class="">CHI_CLIENT Buffer Allocation</a></li>
<li class=""><a href="#shared-memory-compatible-data-structures" class="">Shared-Memory Compatible Data Structures</a></li>
</ul>
</li>
<li class=""><a href="#build-system-integration" class="">Build System Integration</a></li>
<li class=""><a href="#external-chimod-development" class="">External ChiMod Development</a></li>
<li class=""><a href="#example-module" class="">Example Module</a></li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>Chimaera modules (ChiMods) are dynamically loadable components that extend the runtime with new functionality. Each module consists of:</p>
<ul>
<li class=""><strong>Client library</strong>: Minimal code for task submission from user processes</li>
<li class=""><strong>Runtime library</strong>: Server-side execution logic</li>
<li class=""><strong>Task definitions</strong>: Shared structures for client-server communication</li>
<li class=""><strong>Configuration</strong>: YAML metadata describing the module</li>
</ul>
<p><strong>Header Organization</strong>: All ChiMod headers are organized under the namespace directory structure (<code>include/[namespace]/[module_name]/</code>) to provide clear namespace separation and prevent header conflicts.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-principles">Core Principles<a href="#core-principles" class="hash-link" aria-label="Direct link to Core Principles" title="Direct link to Core Principles" translate="no">​</a></h3>
<ol>
<li class=""><strong>Client-Server Separation</strong>: Clients only submit tasks; runtime handles all logic</li>
<li class=""><strong>Shared Memory Communication</strong>: Tasks are allocated in shared memory segments</li>
<li class=""><strong>Task-Based Processing</strong>: All operations are expressed as tasks with methods</li>
<li class=""><strong>Zero-Copy Design</strong>: Data stays in shared memory; only pointers are passed</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-components">Key Components<a href="#key-components" class="hash-link" aria-label="Direct link to Key Components" title="Direct link to Key Components" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">ChiMod/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── include/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   └── [namespace]/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       └── MOD_NAME/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│           ├── MOD_NAME_client.h     # Client API</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│           ├── MOD_NAME_runtime.h    # Runtime container</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│           ├── MOD_NAME_tasks.h      # Task definitions</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│           └── autogen/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│               └── MOD_NAME_methods.h    # Method constants</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── src/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── MOD_NAME_client.cc        # Client implementation</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   ├── MOD_NAME_runtime.cc       # Runtime implementation</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   └── autogen/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       └── MOD_NAME_lib_exec.cc  # Auto-generated virtual method implementations</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── chimaera_mod.yaml              # Module configuration</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└── CMakeLists.txt                 # Build configuration</span><br></span></code></pre></div></div>
<p><strong>Include Directory Structure:</strong></p>
<ul>
<li class="">All ChiMod headers are organized under the namespace directory</li>
<li class="">Structure: <code>include/[namespace]/[module_name]/</code></li>
<li class="">Example: Admin headers are in <code>include/[namespace]/admin/</code> (where <code>[namespace]</code> is the namespace from <code>chimaera_repo.yaml</code>)</li>
<li class="">Headers follow naming pattern: <code>[module_name]_[type].h</code></li>
<li class="">Auto-generated headers are in the <code>autogen/</code> subdirectory</li>
<li class=""><strong>Note</strong>: The namespace comes from <code>chimaera_repo.yaml</code> and the chimod directory name doesn&#x27;t need to match the namespace</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="coding-style">Coding Style<a href="#coding-style" class="hash-link" aria-label="Direct link to Coding Style" title="Direct link to Coding Style" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="general-guidelines">General Guidelines<a href="#general-guidelines" class="hash-link" aria-label="Direct link to General Guidelines" title="Direct link to General Guidelines" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Namespace</strong>: All module code under <code>chimaera::MOD_NAME</code></p>
</li>
<li class="">
<p><strong>Naming Conventions</strong>:</p>
<ul>
<li class="">Classes: <code>PascalCase</code> (e.g., <code>CustomTask</code>)</li>
<li class="">Methods: <code>PascalCase</code> for public, <code>camelCase</code> for private</li>
<li class="">Variables: <code>snake_case_</code> with trailing underscore for members</li>
<li class="">Constants: <code>kConstantName</code></li>
<li class="">Enums: <code>kEnumValue</code></li>
</ul>
</li>
<li class="">
<p><strong>Header Guards</strong>: Use <code>#ifndef MOD_NAME_COMPONENT_H_</code></p>
</li>
<li class="">
<p><strong>Includes</strong>: System headers first, then library headers, then local headers</p>
</li>
<li class="">
<p><strong>Comments</strong>: Use Doxygen-style comments for public APIs</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="code-formatting">Code Formatting<a href="#code-formatting" class="hash-link" aria-label="Direct link to Code Formatting" title="Direct link to Code Formatting" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Brief description</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Detailed description if needed</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @param param_name Parameter description</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @return Return value description</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ExampleClass</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Public methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">PublicMethod</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Private members with trailing underscore</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  u32 member_variable_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="module-structure">Module Structure<a href="#module-structure" class="hash-link" aria-label="Direct link to Module Structure" title="Direct link to Module Structure" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-definition-mod_name_tasksh">Task Definition (MOD_NAME_tasks.h)<a href="#task-definition-mod_name_tasksh" class="hash-link" aria-label="Direct link to Task Definition (MOD_NAME_tasks.h)" title="Direct link to Task Definition (MOD_NAME_tasks.h)" translate="no">​</a></h3>
<p>Task definition patterns:</p>
<ol>
<li class=""><strong>CreateParams Structure</strong>: Define configuration parameters for container creation<!-- -->
<ul>
<li class="">CreateParams use cereal serialization and do NOT require allocator-based constructors</li>
<li class="">Only need default constructor and parameter-based constructors</li>
<li class="">Allocator is NOT passed to CreateParams - it&#x27;s handled internally by BaseCreateTask</li>
</ul>
</li>
<li class=""><strong>CreateTask Template</strong>: Use GetOrCreatePoolTask template for container creation (non-admin modules)</li>
<li class=""><strong>Custom Tasks</strong>: Define custom tasks with SHM/Emplace constructors and HSHM data members</li>
</ol>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">MOD_NAME_TASKS_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">MOD_NAME_TASKS_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/MOD_NAME/autogen/MOD_NAME_methods.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Include admin tasks for GetOrCreatePoolTask</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/admin/admin_tasks.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * CreateParams for MOD_NAME chimod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Contains configuration parameters for MOD_NAME container creation</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// MOD_NAME-specific parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string config_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Required: chimod library name for module manager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> chimod_lib_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;chimaera_MOD_NAME&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Default constructor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Constructor with parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> config_data </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 worker_count </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">config_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">worker_count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Serialization support for cereal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">serialize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Load configuration from PoolConfig (for compose mode)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Required for compose feature support</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * @param pool_config Pool configuration from compose section</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">LoadConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Parse YAML config string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    YAML</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Node config </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">YAML</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Load</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">config_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Load module-specific parameters from YAML</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;config_data&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      config_data_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;config_data&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">as</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">std</span><span class="token generic-function generic class-name double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">string</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;worker_count&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      worker_count_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;worker_count&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">as</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">chi</span><span class="token generic-function generic class-name double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">u32</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * CreateTask - Initialize the MOD_NAME container</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Type alias for GetOrCreatePoolTask with CreateParams (uses kGetOrCreatePool method)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Non-admin modules should use GetOrCreatePoolTask instead of BaseCreateTask</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">GetOrCreatePoolTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateParams</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Custom operation task</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CustomTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Task-specific data using HSHM macros</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Input/output string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 operation_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// Input parameter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 result_code_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// Output result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// SHM constructor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">CustomTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">operation_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">result_code_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Emplace constructor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">CustomTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">TaskId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 operation_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">operation_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">operation_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">result_code_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    method_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCustom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Clear</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token macro property">  </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">// MOD_NAME_TASKS_H_</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="client-implementation-mod_name_clienthcc">Client Implementation (MOD_NAME_client.h/cc)<a href="#client-implementation-mod_name_clienthcc" class="hash-link" aria-label="Direct link to Client Implementation (MOD_NAME_client.h/cc)" title="Direct link to Client Implementation (MOD_NAME_client.h/cc)" translate="no">​</a></h3>
<p>The client provides a simple API for task submission:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">MOD_NAME_CLIENT_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">MOD_NAME_CLIENT_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/MOD_NAME/MOD_NAME_tasks.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Client</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">ContainerClient</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">Client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Synchronous operation - waits for completion</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> CreateParams</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> params </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Wait</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// CRITICAL: Update client pool_id_ with the actual pool ID from the task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CHI_IPC</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Asynchronous operation - returns immediately</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> CreateParams</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> params </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> ipc_manager </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> CHI_IPC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// CRITICAL: CreateTask MUST use admin pool for GetOrCreatePool processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kAdminPoolId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Always use admin pool for CreateTask</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        CreateParams</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">chimod_lib_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ChiMod name from CreateParams</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pool_name_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">// Pool name from base client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        params</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">// CreateParams with configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Submit to runtime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Enqueue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token macro property">  </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">// MOD_NAME_CLIENT_H_</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chimod-createtask-pool-assignment-requirements">ChiMod CreateTask Pool Assignment Requirements<a href="#chimod-createtask-pool-assignment-requirements" class="hash-link" aria-label="Direct link to ChiMod CreateTask Pool Assignment Requirements" title="Direct link to ChiMod CreateTask Pool Assignment Requirements" translate="no">​</a></h3>
<p><strong>CRITICAL</strong>: All ChiMod clients implementing Create functions MUST use the explicit <code>chi::kAdminPoolId</code> variable when constructing CreateTask operations. You CANNOT use <code>pool_id_</code> for CreateTask operations.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-this-is-required">Why This is Required<a href="#why-this-is-required" class="hash-link" aria-label="Direct link to Why This is Required" title="Direct link to Why This is Required" translate="no">​</a></h4>
<p>CreateTask operations are actually GetOrCreatePoolTask operations that must be processed by the admin ChiMod to create or find the target pool. The <code>pool_id_</code> variable is not initialized until after the Create operation completes successfully.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="correct-usage">Correct Usage<a href="#correct-usage" class="hash-link" aria-label="Direct link to Correct Usage" title="Direct link to Correct Usage" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// CORRECT: Always use chi::kAdminPoolId for CreateTask</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kAdminPoolId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">          </span><span class="token comment" style="color:rgb(106, 153, 85)">// REQUIRED: Use admin pool for CreateTask</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CreateParams</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">chimod_lib_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(106, 153, 85)">// Target pool ID to create</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    params</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="incorrect-usage">Incorrect Usage<a href="#incorrect-usage" class="hash-link" aria-label="Direct link to Incorrect Usage" title="Direct link to Incorrect Usage" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: Never use pool_id_ for CreateTask operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: pool_id_ is not initialized yet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CreateParams</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">chimod_lib_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    params</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-points">Key Points<a href="#key-points" class="hash-link" aria-label="Direct link to Key Points" title="Direct link to Key Points" translate="no">​</a></h4>
<ol>
<li class=""><strong>Admin Pool Processing</strong>: CreateTask is a GetOrCreatePoolTask that must be handled by the admin pool</li>
<li class=""><strong>Uninitialized Variable</strong>: <code>pool_id_</code> is not set until after Create completes</li>
<li class=""><strong>Universal Requirement</strong>: This applies to ALL ChiMod clients, including admin, bdev, and custom modules</li>
<li class=""><strong>Create Responsibility</strong>: Create operations are responsible for allocating new pool IDs using the admin pool</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chimod-name-requirements">ChiMod Name Requirements<a href="#chimod-name-requirements" class="hash-link" aria-label="Direct link to ChiMod Name Requirements" title="Direct link to ChiMod Name Requirements" translate="no">​</a></h3>
<p><strong>CRITICAL</strong>: All ChiMod clients MUST use <code>CreateParams::chimod_lib_name</code> instead of hardcoding module names.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="correct-usage-1">Correct Usage<a href="#correct-usage-1" class="hash-link" aria-label="Direct link to Correct Usage" title="Direct link to Correct Usage" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// CORRECT: Use CreateParams::chimod_lib_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kAdminPoolId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CreateParams</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">chimod_lib_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Dynamic reference to CreateParams</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    params</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="incorrect-usage-1">Incorrect Usage<a href="#incorrect-usage-1" class="hash-link" aria-label="Direct link to Incorrect Usage" title="Direct link to Incorrect Usage" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: Never hardcode module names</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kAdminPoolId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;chimaera_MOD_NAME&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Hardcoded name breaks flexibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    params</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-this-is-required-1">Why This is Required<a href="#why-this-is-required-1" class="hash-link" aria-label="Direct link to Why This is Required" title="Direct link to Why This is Required" translate="no">​</a></h4>
<ol>
<li class=""><strong>Namespace Flexibility</strong>: Allows ChiMods to work with different namespace configurations</li>
<li class=""><strong>Single Source of Truth</strong>: The module name is defined once in CreateParams</li>
<li class=""><strong>External ChiMods</strong>: Essential for external ChiMods using custom namespaces</li>
<li class=""><strong>Maintainability</strong>: Changes to module names only require updating CreateParams</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementation-pattern">Implementation Pattern<a href="#implementation-pattern" class="hash-link" aria-label="Direct link to Implementation Pattern" title="Direct link to Implementation Pattern" translate="no">​</a></h4>
<p>All non-admin ChiMods using <code>GetOrCreatePoolTask</code> must follow this pattern:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// In AsyncCreate method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kAdminPoolId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Always use admin pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CreateParams</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">chimod_lib_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// REQUIRED: Use static member</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Pool identifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">                              </span><span class="token comment" style="color:rgb(106, 153, 85)">// Target pool ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/* ...CreateParams arguments... */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Note</strong>: The admin ChiMod uses <code>BaseCreateTask</code> directly and doesn&#x27;t require the chimod name parameter.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-container-mod_name_runtimehcc">Runtime Container (MOD_NAME_runtime.h/cc)<a href="#runtime-container-mod_name_runtimehcc" class="hash-link" aria-label="Direct link to Runtime Container (MOD_NAME_runtime.h/cc)" title="Direct link to Runtime Container (MOD_NAME_runtime.h/cc)" translate="no">​</a></h3>
<p>The runtime container executes tasks server-side:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">MOD_NAME_RUNTIME_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">MOD_NAME_RUNTIME_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/MOD_NAME/MOD_NAME_tasks.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">Container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token operator" style="color:rgb(212, 212, 212)">~</span><span class="token function" style="color:rgb(220, 220, 170)">Container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">override</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Initialize container with pool information (REQUIRED)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * This is called by the framework before Create is called</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">override</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Call base class initialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Initialize the client for this ChiMod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    client_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Create the container (Method::kCreate)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * This method creates queues and sets up container resources</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * NOTE: Container is already initialized via Init() before Create is called</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Container is already initialized via Init() before Create is called</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Do NOT call Init() here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Additional container-specific initialization logic here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Container created and initialized for pool: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> pool_name_</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; (ID: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;)&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Custom operation (Method::kCustom)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Custom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CustomTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Process the operation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string result </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">processData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">operation_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">data_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">main_allocator_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_code_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Task completion is handled by the framework</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string </span><span class="token function" style="color:rgb(220, 220, 170)">processData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> u32 op_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Business logic here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> input </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;_processed&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Define ChiMod entry points using CHI_TASK_CC macro</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">CHI_TASK_CC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token macro property">  </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">// MOD_NAME_RUNTIME_H_</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="execution-modes-and-dynamic-scheduling">Execution Modes and Dynamic Scheduling<a href="#execution-modes-and-dynamic-scheduling" class="hash-link" aria-label="Direct link to Execution Modes and Dynamic Scheduling" title="Direct link to Execution Modes and Dynamic Scheduling" translate="no">​</a></h3>
<p>The Chimaera runtime supports two execution modes through the <code>ExecMode</code> enum in <code>RunContext</code>, enabling sophisticated task routing patterns:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="execmode-overview">ExecMode Overview<a href="#execmode-overview" class="hash-link" aria-label="Direct link to ExecMode Overview" title="Direct link to ExecMode Overview" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Execution mode for task processing</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">enum</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ExecMode</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">u32</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  kExec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">              </span><span class="token comment" style="color:rgb(106, 153, 85)">/**&lt; Normal task execution (default) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  kDynamicSchedule </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">/**&lt; Dynamic scheduling - route after execution */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p>The execution mode is accessible through the <code>RunContext</code> parameter passed to all task methods:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">YourMethod</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">YourTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Check execution mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exec_mode </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ExecMode</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kDynamicSchedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Dynamic scheduling logic - modify task routing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Return early - task will be re-routed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Normal execution logic (kExec mode)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... perform actual work ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="kexec-mode-default">kExec Mode (Default)<a href="#kexec-mode-default" class="hash-link" aria-label="Direct link to kExec Mode (Default)" title="Direct link to kExec Mode (Default)" translate="no">​</a></h4>
<p><strong>Purpose</strong>: Normal task execution mode where tasks are processed completely and then marked as finished.</p>
<p><strong>Behavior</strong>:</p>
<ul>
<li class="">Tasks execute their full logic</li>
<li class="">Results are written to task output parameters</li>
<li class="">Worker calls <code>EndTask()</code> after execution completes</li>
<li class="">Task is marked as completed and cleaned up</li>
</ul>
<p><strong>When to use</strong>: The default mode for all standard task processing.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="kdynamicschedule-mode">kDynamicSchedule Mode<a href="#kdynamicschedule-mode" class="hash-link" aria-label="Direct link to kDynamicSchedule Mode" title="Direct link to kDynamicSchedule Mode" translate="no">​</a></h4>
<p><strong>Purpose</strong>: Two-phase execution where the first execution determines routing, then the task is re-routed and executed again.</p>
<p><strong>Behavior</strong>:</p>
<ol>
<li class="">Worker sets <code>exec_mode = kDynamicSchedule</code> before first execution</li>
<li class="">Task method examines state and modifies <code>task-&gt;pool_query_</code> for routing</li>
<li class="">Task returns early without performing full execution</li>
<li class="">Worker calls <code>RerouteDynamicTask()</code> instead of <code>EndTask()</code></li>
<li class="">Task is re-routed using the updated <code>pool_query_</code></li>
<li class="">Task executes again in normal <code>kExec</code> mode with the new routing</li>
</ol>
<p><strong>When to use</strong>:</p>
<ul>
<li class="">Tasks that need runtime-dependent routing decisions</li>
<li class="">Cache optimization patterns (check local, then broadcast if not found)</li>
<li class="">Conditional distributed execution based on state</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-getorcreatepool-with-dynamic-scheduling">Example: GetOrCreatePool with Dynamic Scheduling<a href="#example-getorcreatepool-with-dynamic-scheduling" class="hash-link" aria-label="Direct link to Example: GetOrCreatePool with Dynamic Scheduling" title="Direct link to Example: GetOrCreatePool with Dynamic Scheduling" translate="no">​</a></h4>
<p>The admin ChiMod&#x27;s <code>GetOrCreatePool</code> method demonstrates the canonical dynamic scheduling pattern:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">GetOrCreatePool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">GetOrCreatePoolTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CreateParams</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">pool_manager </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> CHI_POOL_MANAGER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string pool_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">pool_name_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// PHASE 1: Dynamic scheduling - determine routing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exec_mode </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ExecMode</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kDynamicSchedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Check if pool exists locally first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId existing_pool_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pool_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">FindPoolByName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">existing_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">IsNull</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Pool exists locally - route to local execution only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">HILOG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">kDebug</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Admin: Pool &#x27;{}&#x27; found locally (ID: {}), using Local query&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> existing_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Local</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Pool doesn&#x27;t exist - broadcast creation to all nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">HILOG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">kDebug</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Admin: Pool &#x27;{}&#x27; not found locally, broadcasting creation&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Return early - worker will re-route task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// PHASE 2: Normal execution - actually create/get the pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">HILOG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">kDebug</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Admin: Executing GetOrCreatePool task - ChiMod: {}, Pool: {}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">chimod_name_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">return_code_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">error_message_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain">pool_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">CreatePool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">chi</span><span class="token generic-function generic class-name double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">return_code_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">error_message_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Failed to create or get pool via PoolManager&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">return_code_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pools_created_</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">HILOG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">kDebug</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Admin: Pool operation completed successfully - ID: {}, Name: {}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">exception </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">return_code_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">99</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">error_message_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">GetCtxAllocator</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Exception during pool creation: &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">what</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">HELOG</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">kError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Admin: Pool creation failed with exception: {}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">what</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-dynamic-poolquery">Using Dynamic() PoolQuery<a href="#using-dynamic-poolquery" class="hash-link" aria-label="Direct link to Using Dynamic() PoolQuery" title="Direct link to Using Dynamic() PoolQuery" translate="no">​</a></h4>
<p>The <code>PoolQuery::Dynamic()</code> factory method triggers dynamic scheduling:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Client code - request dynamic routing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> pool_query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Dynamic</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_pool_name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>What happens internally:</strong></p>
<ol>
<li class="">Worker recognizes <code>Dynamic()</code> pool query</li>
<li class="">Sets <code>rctx.exec_mode = ExecMode::kDynamicSchedule</code></li>
<li class="">Routes task to local node first</li>
<li class="">Task method checks cache and updates <code>pool_query_</code></li>
<li class="">Worker re-routes with updated query</li>
<li class="">Task executes again in normal mode with correct routing</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="benefits-of-dynamic-scheduling">Benefits of Dynamic Scheduling<a href="#benefits-of-dynamic-scheduling" class="hash-link" aria-label="Direct link to Benefits of Dynamic Scheduling" title="Direct link to Benefits of Dynamic Scheduling" translate="no">​</a></h4>
<p><strong>Performance Optimization:</strong></p>
<ul>
<li class="">Avoids redundant operations (e.g., pool creation when pool already exists)</li>
<li class="">Reduces network overhead by checking local state first</li>
<li class="">Enables intelligent routing based on runtime conditions</li>
</ul>
<p><strong>Cache Optimization Pattern:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Check local cache first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exec_mode </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ExecMode</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kDynamicSchedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">LocalCacheHas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">resource_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Local</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Found locally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Need to fetch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Normal execution with optimized routing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> resource </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">GetResource</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">resource_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>State-Dependent Routing:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Route based on runtime conditions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">exec_mode </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ExecMode</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kDynamicSchedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">ShouldExecuteDistributed</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Local</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementation-guidelines">Implementation Guidelines<a href="#implementation-guidelines" class="hash-link" aria-label="Direct link to Implementation Guidelines" title="Direct link to Implementation Guidelines" translate="no">​</a></h4>
<p><strong>DO:</strong></p>
<ul>
<li class="">✅ Check <code>rctx.exec_mode</code> at the start of your method</li>
<li class="">✅ Return early after modifying <code>pool_query_</code> in dynamic mode</li>
<li class="">✅ Keep dynamic scheduling logic lightweight (fast checks only)</li>
<li class="">✅ Use dynamic scheduling for cache optimization patterns</li>
</ul>
<p><strong>DON&#x27;T:</strong></p>
<ul>
<li class="">❌ Perform expensive operations in dynamic scheduling mode</li>
<li class="">❌ Modify task output parameters in dynamic scheduling mode</li>
<li class="">❌ Call <code>Wait()</code> or spawn subtasks in dynamic scheduling mode</li>
<li class="">❌ Use dynamic scheduling for simple operations that don&#x27;t need routing optimization</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="worker-implementation-details">Worker Implementation Details<a href="#worker-implementation-details" class="hash-link" aria-label="Direct link to Worker Implementation Details" title="Direct link to Worker Implementation Details" translate="no">​</a></h4>
<p>The worker automatically handles dynamic scheduling:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Worker::ExecTask() logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">run_ctx</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">exec_mode </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> ExecMode</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kDynamicSchedule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// After task returns, call RerouteDynamicTask instead of EndTask</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">RerouteDynamicTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> run_ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Normal mode - end task after execution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">EndTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> run_ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p>The <code>RerouteDynamicTask()</code> method:</p>
<ol>
<li class="">Resets task flags (<code>TASK_STARTED</code>, <code>TASK_ROUTED</code>)</li>
<li class="">Re-routes task using updated <code>pool_query_</code></li>
<li class="">Sets <code>exec_mode = kExec</code> for next execution</li>
<li class="">Schedules task for execution again</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-and-code-generation">Configuration and Code Generation<a href="#configuration-and-code-generation" class="hash-link" aria-label="Direct link to Configuration and Code Generation" title="Direct link to Configuration and Code Generation" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview-1">Overview<a href="#overview-1" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h3>
<p>Chimaera uses a two-level configuration system with automated code generation:</p>
<ol>
<li class=""><strong>chimaera_repo.yaml</strong>: Repository-wide configuration (namespace, version, etc.)</li>
<li class=""><strong>chimaera_mod.yaml</strong>: Module-specific configuration (method IDs, metadata)</li>
<li class=""><strong>chi_refresh_repo</strong>: Utility script that generates autogen files from YAML configurations</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chimaera_repoyaml">chimaera_repo.yaml<a href="#chimaera_repoyaml" class="hash-link" aria-label="Direct link to chimaera_repo.yaml" title="Direct link to chimaera_repo.yaml" translate="no">​</a></h3>
<p>Located at <code>chimods/chimaera_repo.yaml</code>, this file defines repository-wide settings:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Repository Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chimaera        </span><span class="token comment" style="color:rgb(106, 153, 85)"># MUST match namespace in all chimaera_mod.yaml files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> 1.0.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">description</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Chimaera Runtime ChiMod Repository&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Module discovery - directories to scan for ChiMods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">modules</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> MOD_NAME</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> admin  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> bdev</span><br></span></code></pre></div></div>
<p><strong>Key Requirements:</strong></p>
<ul>
<li class="">The <code>namespace</code> field MUST be identical in both chimaera_repo.yaml and all chimaera_mod.yaml files</li>
<li class="">Used by build system for CMake package generation and installation paths</li>
<li class="">Determines export target names: <code>${namespace}::${module}_runtime</code>, <code>${namespace}::${module}_client</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chimaera_modyaml">chimaera_mod.yaml<a href="#chimaera_modyaml" class="hash-link" aria-label="Direct link to chimaera_mod.yaml" title="Direct link to chimaera_mod.yaml" translate="no">​</a></h3>
<p>Each ChiMod must have its own configuration file specifying methods and metadata:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># MOD_NAME ChiMod Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">module_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> MOD_NAME</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chimaera        </span><span class="token comment" style="color:rgb(106, 153, 85)"># MUST match chimaera_repo.yaml namespace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> 1.0.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Inherited Methods (fixed IDs)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># Container creation (required)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kDestroy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)"># Container destruction (required)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kNodeFailure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">-1</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># Not implemented (-1 means disabled)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kRecover</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">-1</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)"># Not implemented </span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kMigrate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">-1</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)"># Not implemented</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kUpgrade</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">-1</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)"># Not implemented</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Custom Methods (start from 10, use sequential IDs)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kCustom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)"># Custom operation method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kCoMutexTest</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># CoMutex synchronization testing method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kCoRwLockTest</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># CoRwLock reader-writer synchronization testing method</span><br></span></code></pre></div></div>
<p><strong>Method ID Assignment Rules:</strong></p>
<ul>
<li class=""><strong>0-9</strong>: Reserved for system methods (kCreate=0, kDestroy=1, etc.)</li>
<li class=""><strong>10+</strong>: Custom methods (assign sequential IDs starting from 10)</li>
<li class=""><strong>Disabled methods</strong>: Use -1 to disable inherited methods not implemented</li>
<li class=""><strong>Consistency</strong>: Once assigned, never change method IDs (breaks compatibility)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chi_refresh_repo-utility">chi_refresh_repo Utility<a href="#chi_refresh_repo-utility" class="hash-link" aria-label="Direct link to chi_refresh_repo Utility" title="Direct link to chi_refresh_repo Utility" translate="no">​</a></h3>
<p>The <code>chi_refresh_repo</code> utility automatically generates autogen files from YAML configurations.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># From project root, regenerate all autogen files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">./build/bin/chi_refresh_repo chimods</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># The utility will:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 1. Read chimaera_repo.yaml for global settings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 2. Scan each module&#x27;s chimaera_mod.yaml </span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 3. Generate MOD_NAME_methods.h with method constants</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 4. Generate MOD_NAME_lib_exec.cc with virtual method dispatch</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="generated-files">Generated Files<a href="#generated-files" class="hash-link" aria-label="Direct link to Generated Files" title="Direct link to Generated Files" translate="no">​</a></h4>
<p>For each ChiMod, the utility generates:</p>
<ol>
<li class="">
<p><strong><code>include/[namespace]/MOD_NAME/autogen/MOD_NAME_methods.h</code></strong>:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> Method </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kCreate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kDestroy </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kCustom </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kCoMutexTest </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace Method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong><code>src/autogen/MOD_NAME_lib_exec.cc</code></strong>:</p>
<ul>
<li class="">Virtual method dispatch (Runtime::Run, etc.)</li>
<li class="">Task serialization support (SaveIn/Out, LoadIn/Out)</li>
<li class="">Memory management (Del, NewCopy, Aggregate)</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-run-chi_refresh_repo">When to Run chi_refresh_repo<a href="#when-to-run-chi_refresh_repo" class="hash-link" aria-label="Direct link to When to Run chi_refresh_repo" title="Direct link to When to Run chi_refresh_repo" translate="no">​</a></h4>
<p><strong>ALWAYS</strong> run chi_refresh_repo when:</p>
<ul>
<li class="">Adding new methods to chimaera_mod.yaml</li>
<li class="">Changing method IDs or names</li>
<li class="">Adding new ChiMods to the repository</li>
<li class="">Modifying namespace or version information</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="important-notes">Important Notes<a href="#important-notes" class="hash-link" aria-label="Direct link to Important Notes" title="Direct link to Important Notes" translate="no">​</a></h4>
<ul>
<li class=""><strong>Never manually edit autogen files</strong> - they are overwritten by chi_refresh_repo</li>
<li class=""><strong>Run chi_refresh_repo before building</strong> after YAML changes</li>
<li class=""><strong>Commit autogen files to git</strong> so other developers don&#x27;t need to regenerate</li>
<li class=""><strong>Method IDs are permanent</strong> - changing them breaks binary compatibility</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-summary">Workflow Summary<a href="#workflow-summary" class="hash-link" aria-label="Direct link to Workflow Summary" title="Direct link to Workflow Summary" translate="no">​</a></h3>
<ol>
<li class="">Define methods in <code>chimaera_mod.yaml</code> with sequential IDs</li>
<li class="">Implement corresponding methods in <code>MOD_NAME_runtime.h/cc</code></li>
<li class="">Run <code>./build/bin/chi_refresh_repo chimods</code> to generate autogen files</li>
<li class="">Build project with <code>make</code> - autogen files provide the dispatch logic</li>
<li class="">Autogen files handle virtual method routing, serialization, and memory management</li>
</ol>
<p>This automated approach ensures consistency across all ChiMods and reduces boilerplate code maintenance.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-development">Task Development<a href="#task-development" class="hash-link" aria-label="Direct link to Task Development" title="Direct link to Task Development" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-requirements">Task Requirements<a href="#task-requirements" class="hash-link" aria-label="Direct link to Task Requirements" title="Direct link to Task Requirements" translate="no">​</a></h3>
<ol>
<li class=""><strong>Inherit from chi::Task</strong>: All tasks must inherit the base Task class</li>
<li class=""><strong>Two Constructors</strong>: SHM and emplace constructors are mandatory</li>
<li class=""><strong>Serializable Types</strong>: Use HSHM types (chi::string, chi::vector, etc.) for member variables</li>
<li class=""><strong>Method Assignment</strong>: Set the method_ field to identify the operation</li>
<li class=""><strong>FullPtr Usage</strong>: All task method signatures use <code>hipc::FullPtr&lt;TaskType&gt;</code> instead of raw pointers</li>
<li class=""><strong>Copy Method</strong>: Optional - implement for tasks that need to be replicated across nodes</li>
<li class=""><strong>Aggregate Method</strong>: Optional - implement for tasks that need to combine results from replicas</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="optional-task-methods-copy-and-aggregate">Optional Task Methods: Copy and Aggregate<a href="#optional-task-methods-copy-and-aggregate" class="hash-link" aria-label="Direct link to Optional Task Methods: Copy and Aggregate" title="Direct link to Optional Task Methods: Copy and Aggregate" translate="no">​</a></h3>
<p>For tasks that will be distributed across multiple nodes or need to combine results from multiple executions, you can optionally implement <code>Copy()</code> and <code>Aggregate()</code> methods.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="copy-method">Copy Method<a href="#copy-method" class="hash-link" aria-label="Direct link to Copy Method" title="Direct link to Copy Method" translate="no">​</a></h4>
<p>The <code>Copy()</code> method is used to create a deep copy of a task, typically when distributing work across multiple nodes. This is useful for:</p>
<ul>
<li class="">Remote task execution via networking</li>
<li class="">Task replication for fault tolerance</li>
<li class="">Creating independent task replicas with separate data</li>
</ul>
<p><strong>Signature:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">YourTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Implementation Pattern:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">WriteTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN Block block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN size_t length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 bytes_written_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Copy from another WriteTask (assumes this task is already constructed)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * @param other Pointer to the source task to copy from</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">WriteTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Copy task-specific fields only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Base Task fields are copied automatically by NewCopy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    block_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    data_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    length_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    bytes_written_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">bytes_written_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Key Points:</strong></p>
<ul>
<li class=""><strong>DO NOT</strong> call <code>chi::Task::Copy()</code> - base fields are copied automatically by autogenerated NewCopy</li>
<li class="">Copy only task-specific fields from the source task</li>
<li class="">The destination task (<code>this</code>) is already constructed - don&#x27;t call constructors</li>
<li class="">For pointer fields, decide if you need deep or shallow copy based on ownership</li>
<li class="">NewCopy in autogen code handles calling base Task::Copy before your Copy method</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="aggregate-method">Aggregate Method<a href="#aggregate-method" class="hash-link" aria-label="Direct link to Aggregate Method" title="Direct link to Aggregate Method" translate="no">​</a></h4>
<p>The <code>Aggregate()</code> method combines results from multiple task replicas into a single result. This is commonly used for:</p>
<ul>
<li class="">Combining results from distributed task execution</li>
<li class="">Merging partial results from parallel operations</li>
<li class="">Accumulating metrics from multiple nodes</li>
</ul>
<p><strong>Signature:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">YourTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Implementation Patterns:</strong></p>
<p><strong>Pattern 1: Last-Writer-Wins (Simple Override)</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">WriteTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN Block block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 bytes_written_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Aggregate results from another WriteTask</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * For write operations, we typically just copy the result from the completed replica</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">WriteTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Simply copy the result - last writer wins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Pattern 2: Accumulation (Sum/Max/Min)</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">GetStatsTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 total_bytes_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 operation_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 max_latency_us_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Aggregate statistics from multiple replicas</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Accumulate totals and find maximum values</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">GetStatsTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Sum cumulative metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    total_bytes_ </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">total_bytes_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    operation_count_ </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">operation_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Take maximum for latency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    max_latency_us_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">max_latency_us_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">max_latency_us_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Pattern 3: List/Vector Merging</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">AllocateBlocksTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Block</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> blocks_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Aggregate block allocations from multiple replicas</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Combine all allocated blocks into a single list</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">AllocateBlocksTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Append blocks from other task to this task&#x27;s list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    blocks_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">blocks_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">end</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                   other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">blocks_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">begin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                   other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">blocks_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">end</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Pattern 4: Custom Logic</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">QueryTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Result</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> results_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 error_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Aggregate query results with custom deduplication</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">QueryTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Merge results with deduplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">result </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">results_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token function" style="color:rgb(220, 220, 170)">ContainsResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">results_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        results_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">push_back</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Accumulate error counts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    error_count_ </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">error_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ContainsResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Result</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> Result </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Custom deduplication logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">begin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">end</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">end</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-implement-copy-and-aggregate">When to Implement Copy and Aggregate<a href="#when-to-implement-copy-and-aggregate" class="hash-link" aria-label="Direct link to When to Implement Copy and Aggregate" title="Direct link to When to Implement Copy and Aggregate" translate="no">​</a></h4>
<p><strong>Implement Copy when:</strong></p>
<ul>
<li class="">Your task will be sent to remote nodes for execution</li>
<li class="">Task data needs to be replicated for fault tolerance</li>
<li class="">You need independent copies with separate data ownership</li>
</ul>
<p><strong>Implement Aggregate when:</strong></p>
<ul>
<li class="">Your task returns results that can be combined (sums, lists, statistics)</li>
<li class="">You&#x27;re using distributed execution patterns (e.g., map-reduce)</li>
<li class="">Multiple replicas produce partial results that need merging</li>
</ul>
<p><strong>Skip Copy and Aggregate when:</strong></p>
<ul>
<li class="">Tasks are only executed locally on a single node</li>
<li class="">Results don&#x27;t need to be combined across executions</li>
<li class="">Tasks have no output parameters (side-effects only)</li>
<li class="">Default shallow copy behavior is sufficient</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="copyaggregate-usage-in-networking">Copy/Aggregate Usage in Networking<a href="#copyaggregate-usage-in-networking" class="hash-link" aria-label="Direct link to Copy/Aggregate Usage in Networking" title="Direct link to Copy/Aggregate Usage in Networking" translate="no">​</a></h4>
<p>When tasks are sent across nodes using Send/Recv:</p>
<ol>
<li class="">
<p><strong>Send Phase</strong>: The <code>Copy()</code> method creates a replica of the origin task</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> replica</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">container</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">NewCopy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">method_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> origin_task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> replica</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* replica_flag */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Internally calls task-&gt;Copy(origin_task)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Recv Phase</strong>: The <code>Aggregate()</code> method combines replica results back into the origin</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">container</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">method_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> origin_task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> replica</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Internally calls origin_task-&gt;Aggregate(replica)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Autogeneration</strong>: The code generator creates dispatcher methods that call your Copy/Aggregate implementations:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// In autogen/MOD_NAME_lib_exec.cc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">NewCopy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Runtime</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">             hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> orig_task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">             hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> new_task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">             </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> deep_copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kWrite</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> orig </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> orig_task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">WriteTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      new_task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> CHI_IPC</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">WriteTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      new_task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">WriteTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">orig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Runtime</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">replica</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kWrite</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">WriteTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">replica</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">WriteTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-example-readtask-with-copy-and-aggregate">Complete Example: ReadTask with Copy and Aggregate<a href="#complete-example-readtask-with-copy-and-aggregate" class="hash-link" aria-label="Direct link to Complete Example: ReadTask with Copy and Aggregate" title="Direct link to Complete Example: ReadTask with Copy and Aggregate" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ReadTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN Block block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT size_t length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** SHM constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">TaskId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> Block </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">block</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    size_t length</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">block</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    method_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kRead</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Clear</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Copy from another ReadTask</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Used when creating replicas for remote execution</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ReadTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Copy task-specific fields only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Base Task fields are copied automatically by NewCopy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    block_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    data_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    length_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    bytes_read_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * Aggregate results from replica</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   * For read operations, simply copy the data from the completed replica</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ReadTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// For reads, we just take the result from the replica</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-naming-conventions">Task Naming Conventions<a href="#task-naming-conventions" class="hash-link" aria-label="Direct link to Task Naming Conventions" title="Direct link to Task Naming Conventions" translate="no">​</a></h3>
<p><strong>CRITICAL</strong>: All task names MUST follow consistent naming patterns to ensure proper code generation and maintenance.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="required-naming-pattern">Required Naming Pattern<a href="#required-naming-pattern" class="hash-link" aria-label="Direct link to Required Naming Pattern" title="Direct link to Required Naming Pattern" translate="no">​</a></h4>
<p>The naming convention enforces consistency across function names, task types, and method constants:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">Function Name → Task Name → Method Constant</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FunctionName()  → FunctionNameTask  → kFunctionName</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples" translate="no">​</a></h4>
<p><strong>Correct Naming:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Function: GetStats() and AsyncGetStats()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Task: GetStatsTask  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Method: kGetStats</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// In bdev_client.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">PerfMetrics </span><span class="token function" style="color:rgb(220, 220, 170)">GetStats</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> remaining_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">GetStatsTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncGetStats</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// In bdev_tasks.h  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">GetStatsTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT PerfMetrics metrics_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 remaining_size_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... constructors and methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// In chimaera_mod.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">kGetStats</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token plain">    # Get performance statistics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// In bdev_runtime.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">GetStats</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">GetStatsTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Incorrect Naming Examples:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: Function and task names don&#x27;t match</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">PerfMetrics </span><span class="token function" style="color:rgb(220, 220, 170)">GetStats</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">           </span><span class="token comment" style="color:rgb(106, 153, 85)">// Function name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">StatTask</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">// Task name doesn&#x27;t match function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: Method constant doesn&#x27;t match function  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kStat </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Method doesn&#x27;t match function name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: Runtime method doesn&#x27;t match function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Stat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">StatTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Runtime method doesn&#x27;t match</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="naming-rules">Naming Rules<a href="#naming-rules" class="hash-link" aria-label="Direct link to Naming Rules" title="Direct link to Naming Rules" translate="no">​</a></h4>
<ol>
<li class=""><strong>Function Names</strong>: Use descriptive verbs (e.g., <code>GetStats</code>, <code>AllocateBlocks</code>, <code>WriteData</code>)</li>
<li class=""><strong>Task Names</strong>: Always append &quot;Task&quot; to the function name (e.g., <code>GetStatsTask</code>, <code>AllocateBlocksTask</code>)</li>
<li class=""><strong>Method Constants</strong>: Prefix with &quot;k&quot; and match the function name exactly (e.g., <code>kGetStats</code>, <code>kAllocateBlocks</code>)</li>
<li class=""><strong>Runtime Methods</strong>: Must match the function name exactly (e.g., <code>GetStats()</code>)</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="backward-compatibility">Backward Compatibility<a href="#backward-compatibility" class="hash-link" aria-label="Direct link to Backward Compatibility" title="Direct link to Backward Compatibility" translate="no">​</a></h4>
<p>When renaming tasks, provide backward compatibility aliases:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// In bdev_tasks.h - provide alias for old name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> StatTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> GetStatsTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Backward compatibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// In autogen/bdev_methods.h - provide constant alias</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kGetStats </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kStat </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> kGetStats</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Backward compatibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// In bdev_runtime.h - provide wrapper methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">GetStats</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">GetStatsTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Primary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Stat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">StatTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// Wrapper</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">GetStats</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="benefits-of-consistent-naming">Benefits of Consistent Naming<a href="#benefits-of-consistent-naming" class="hash-link" aria-label="Direct link to Benefits of Consistent Naming" title="Direct link to Benefits of Consistent Naming" translate="no">​</a></h4>
<ol>
<li class=""><strong>Code Generation</strong>: Automated tools can reliably generate method dispatch code</li>
<li class=""><strong>Maintenance</strong>: Clear correlation between client functions and runtime implementations</li>
<li class=""><strong>Documentation</strong>: Self-documenting code with predictable naming patterns</li>
<li class=""><strong>Debugging</strong>: Easy to trace from client calls to runtime execution</li>
<li class=""><strong>Testing</strong>: Consistent patterns make it easier to write comprehensive tests</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="method-system-and-auto-generated-files">Method System and Auto-Generated Files<a href="#method-system-and-auto-generated-files" class="hash-link" aria-label="Direct link to Method System and Auto-Generated Files" title="Direct link to Method System and Auto-Generated Files" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="method-definitions-autogenmod_name_methodsh">Method Definitions (autogen/MOD_NAME_methods.h)<a href="#method-definitions-autogenmod_name_methodsh" class="hash-link" aria-label="Direct link to Method Definitions (autogen/MOD_NAME_methods.h)" title="Direct link to Method Definitions (autogen/MOD_NAME_methods.h)" translate="no">​</a></h4>
<p>Method IDs are now defined as namespace constants instead of enum class values. This eliminates the need for static casting:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">MOD_NAME_AUTOGEN_METHODS_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">MOD_NAME_AUTOGEN_METHODS_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> Method </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Inherited methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kCreate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kDestroy </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kNodeFailure </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kRecover </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kMigrate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kUpgrade </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Module-specific methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kCustom </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token macro property"> </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">// MOD_NAME_AUTOGEN_METHODS_H_</span><br></span></code></pre></div></div>
<p><strong>Key Changes:</strong></p>
<ul>
<li class=""><strong>Namespace instead of enum class</strong>: Use <code>Method::kMethodName</code> directly</li>
<li class=""><strong>GLOBAL_CONST values</strong>: No more static casting required</li>
<li class=""><strong>Include chimaera.h</strong>: Required for GLOBAL_CONST macro</li>
<li class=""><strong>Direct assignment</strong>: <code>method_ = Method::kCreate;</code> (no casting)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basecreatetask-template-system">BaseCreateTask Template System<a href="#basecreatetask-template-system" class="hash-link" aria-label="Direct link to BaseCreateTask Template System" title="Direct link to BaseCreateTask Template System" translate="no">​</a></h4>
<p>For modules that need container creation functionality, use the BaseCreateTask template instead of implementing custom CreateTask. However, there are different approaches depending on whether your module is the admin module or a regular ChiMod:</p>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="getorcreatepooltask-vs-basecreatetask-usage">GetOrCreatePoolTask vs BaseCreateTask Usage<a href="#getorcreatepooltask-vs-basecreatetask-usage" class="hash-link" aria-label="Direct link to GetOrCreatePoolTask vs BaseCreateTask Usage" title="Direct link to GetOrCreatePoolTask vs BaseCreateTask Usage" translate="no">​</a></h5>
<p><strong>For Non-Admin Modules (Recommended Pattern):</strong></p>
<p>All non-admin ChiMods should use <code>GetOrCreatePoolTask</code> which is a specialized version of BaseCreateTask designed for external pool creation:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/admin/admin_tasks.h&gt;</span><span class="token macro property">  </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">// Include admin templates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * CreateParams for MOD_NAME container creation</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Module-specific configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string config_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Required: chimod library name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> chimod_lib_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;chimaera_MOD_NAME&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Constructors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> config_data </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">               chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 worker_count </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">config_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">worker_count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Cereal serialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">serialize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * CreateTask - Non-admin modules should use GetOrCreatePoolTask</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * This uses Method::kGetOrCreatePool and is designed for external pool creation</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">GetOrCreatePoolTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateParams</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><br></span></code></pre></div></div>
<p><strong>For Admin Module Only:</strong></p>
<p>The admin module itself uses BaseCreateTask directly with Method::kCreate:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * CreateTask - Admin uses BaseCreateTask with Method::kCreate and IS_ADMIN=true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> BaseCreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::admin</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basecreatetask-template-parameters">BaseCreateTask Template Parameters<a href="#basecreatetask-template-parameters" class="hash-link" aria-label="Direct link to BaseCreateTask Template Parameters" title="Direct link to BaseCreateTask Template Parameters" translate="no">​</a></h4>
<p>The BaseCreateTask template has three parameters with smart defaults:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParamsT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 MethodId </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kGetOrCreatePool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> IS_ADMIN </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">BaseCreateTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><br></span></code></pre></div></div>
<p><strong>Template Parameters:</strong></p>
<ol>
<li class=""><strong>CreateParamsT</strong>: Your module&#x27;s parameter structure (required)</li>
<li class=""><strong>MethodId</strong>: Method ID for the task (default: <code>kGetOrCreatePool</code>)</li>
<li class=""><strong>IS_ADMIN</strong>: Whether this is an admin operation (default: <code>false</code>)</li>
</ol>
<p><strong>GetOrCreatePoolTask Template:</strong></p>
<p>The <code>GetOrCreatePoolTask</code> template is a convenient alias that uses the optimal defaults for non-admin modules:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParamsT</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> GetOrCreatePoolTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> BaseCreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateParamsT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kGetOrCreatePool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>When to Use Each Pattern:</strong></p>
<ul>
<li class=""><strong>GetOrCreatePoolTask</strong>: For all non-admin ChiMods (recommended)</li>
<li class=""><strong>BaseCreateTask with Method::kCreate</strong>: Only for admin module internal operations</li>
<li class=""><strong>BaseCreateTask with Method::kGetOrCreatePool</strong>: Same as GetOrCreatePoolTask (not typically used directly)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basecreatetask-structure">BaseCreateTask Structure<a href="#basecreatetask-structure" class="hash-link" aria-label="Direct link to BaseCreateTask Structure" title="Direct link to BaseCreateTask Structure" translate="no">​</a></h4>
<p>BaseCreateTask provides a unified structure for container creation and pool operations:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParamsT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 MethodId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> IS_ADMIN</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">BaseCreateTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Pool operation parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string chimod_name_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// ChiMod name for loading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string pool_name_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">          </span><span class="token comment" style="color:rgb(106, 153, 85)">// Target pool name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string chimod_params_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">// Serialized CreateParamsT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">          </span><span class="token comment" style="color:rgb(106, 153, 85)">// Input: requested ID, Output: actual ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 result_code_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">           </span><span class="token comment" style="color:rgb(106, 153, 85)">// 0 = success, non-zero = error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string error_message_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// Error description if failed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Runtime flag set by template parameter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">volatile</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> is_admin_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">// Set to IS_ADMIN template value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Serialization methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Args</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SetParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Args </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  CreateParamsT </span><span class="token function" style="color:rgb(220, 220, 170)">GetParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Key Features:</strong></p>
<ul>
<li class=""><strong>Single pool_id</strong>: Serves as both input (requested) and output (result)</li>
<li class=""><strong>Serialized parameters</strong>: <code>chimod_params_</code> stores serialized CreateParamsT</li>
<li class=""><strong>Error checking</strong>: Use <code>result_code_ != 0</code> to check for failures</li>
<li class=""><strong>Template-driven behavior</strong>: IS_ADMIN template parameter sets volatile variable</li>
<li class=""><strong>No static casting</strong>: Direct method assignment using namespace constants</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="usage-examples">Usage Examples<a href="#usage-examples" class="hash-link" aria-label="Direct link to Usage Examples" title="Direct link to Usage Examples" translate="no">​</a></h4>
<p><strong>Non-Admin ChiMod Container Creation (Recommended):</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Use GetOrCreatePoolTask for all non-admin modules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">GetOrCreatePoolTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">MyCreateParams</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Admin Module Container Creation:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Admin module uses BaseCreateTask with Method::kCreate and IS_ADMIN=true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">BaseCreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">AdminCreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Alternative (Not Recommended):</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Direct BaseCreateTask usage - GetOrCreatePoolTask is cleaner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">BaseCreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">MyCreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kGetOrCreatePool</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="migration-from-custom-createtask">Migration from Custom CreateTask<a href="#migration-from-custom-createtask" class="hash-link" aria-label="Direct link to Migration from Custom CreateTask" title="Direct link to Migration from Custom CreateTask" translate="no">​</a></h4>
<p>If you have existing custom CreateTask implementations, migrate to BaseCreateTask:</p>
<p><strong>Before (Custom Implementation):</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Custom constructor implementations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">CreateTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">TaskId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    method_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Static casting required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... initialization code ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>After (GetOrCreatePoolTask - Recommended for Non-Admin Modules):</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Create params structure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> chimod_lib_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;chimaera_mymodule&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... other params ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">serialize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* ... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Simple type alias using GetOrCreatePoolTask - no custom implementation needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">GetOrCreatePoolTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateParams</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Benefits of Migration:</strong></p>
<ul>
<li class=""><strong>No static casting</strong>: Direct use of <code>Method::kCreate</code></li>
<li class=""><strong>Standardized structure</strong>: Consistent across all modules</li>
<li class=""><strong>Built-in serialization</strong>: SetParams/GetParams methods included</li>
<li class=""><strong>Error handling</strong>: Standardized result_code and error_message</li>
<li class=""><strong>Less boilerplate</strong>: No need to implement constructors manually</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="data-annotations">Data Annotations<a href="#data-annotations" class="hash-link" aria-label="Direct link to Data Annotations" title="Direct link to Data Annotations" translate="no">​</a></h3>
<ul>
<li class=""><code>IN</code>: Input-only parameters (read by runtime)</li>
<li class=""><code>OUT</code>: Output-only parameters (written by runtime)</li>
<li class=""><code>INOUT</code>: Bidirectional parameters</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-lifecycle">Task Lifecycle<a href="#task-lifecycle" class="hash-link" aria-label="Direct link to Task Lifecycle" title="Direct link to Task Lifecycle" translate="no">​</a></h3>
<ol>
<li class="">Client allocates task in shared memory using <code>ipc_manager-&gt;NewTask()</code></li>
<li class="">Client enqueues task pointer to IPC queue</li>
<li class="">Worker dequeues and executes task</li>
<li class="">Framework calls <code>ipc_manager-&gt;DelTask()</code> to deallocate task from shared memory</li>
<li class="">Task memory is properly reclaimed from the appropriate memory segment</li>
</ol>
<p><strong>Note</strong>: Individual <code>DelTaskType</code> methods are no longer required. The framework&#x27;s autogenerated Del dispatcher automatically calls <code>ipc_manager-&gt;DelTask()</code> for proper shared memory deallocation.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="framework-del-implementation">Framework Del Implementation<a href="#framework-del-implementation" class="hash-link" aria-label="Direct link to Framework Del Implementation" title="Direct link to Framework Del Implementation" translate="no">​</a></h3>
<p>The autogenerated Del dispatcher handles task cleanup:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">inline</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Del</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Runtime</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> ipc_manager </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> CHI_IPC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Method method_enum </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:rgb(220, 220, 170)">static_cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">Method</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">method_enum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCreate</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCustom</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CustomTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<p>This ensures proper shared memory deallocation without requiring module-specific cleanup code.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="synchronization-primitives">Synchronization Primitives<a href="#synchronization-primitives" class="hash-link" aria-label="Direct link to Synchronization Primitives" title="Direct link to Synchronization Primitives" translate="no">​</a></h2>
<p>Chimaera provides specialized cooperative synchronization primitives designed for the runtime&#x27;s task-based architecture. <strong>These should be used instead of standard synchronization primitives</strong> like <code>std::mutex</code>, <code>std::shared_mutex</code>, or <code>pthread_mutex</code> when synchronizing access to module data structures.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-use-chimaera-synchronization-primitives">Why Use Chimaera Synchronization Primitives?<a href="#why-use-chimaera-synchronization-primitives" class="hash-link" aria-label="Direct link to Why Use Chimaera Synchronization Primitives?" title="Direct link to Why Use Chimaera Synchronization Primitives?" translate="no">​</a></h3>
<p><strong>Critical: Always use CoMutex and CoRwLock for module synchronization:</strong></p>
<ol>
<li class=""><strong>Cooperative Design</strong>: Compatible with Chimaera&#x27;s fiber-based task execution</li>
<li class=""><strong>TaskId Grouping</strong>: Tasks sharing the same TaskId can proceed together (bypassing locks)</li>
<li class=""><strong>Deadlock Prevention</strong>: Designed to prevent deadlocks in the runtime environment</li>
<li class=""><strong>Runtime Integration</strong>: Automatically integrate with CHI_CUR_WORKER and task context</li>
<li class=""><strong>Performance</strong>: Optimized for the runtime&#x27;s execution model</li>
</ol>
<p><strong>Do NOT use these standard synchronization primitives in module code:</strong></p>
<ul>
<li class="">❌ <code>std::mutex</code> - Can cause fiber blocking issues</li>
<li class="">❌ <code>std::shared_mutex</code> - Not compatible with task execution model</li>
<li class="">❌ <code>pthread_mutex_t</code> - Can deadlock with runtime scheduling</li>
<li class="">❌ <code>std::condition_variable</code> - Incompatible with cooperative scheduling</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="comutex-cooperative-mutual-exclusion">CoMutex: Cooperative Mutual Exclusion<a href="#comutex-cooperative-mutual-exclusion" class="hash-link" aria-label="Direct link to CoMutex: Cooperative Mutual Exclusion" title="Direct link to CoMutex: Cooperative Mutual Exclusion" translate="no">​</a></h3>
<p>CoMutex provides mutual exclusion with TaskId grouping support. Tasks sharing the same TaskId can bypass the lock and execute concurrently.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-usage">Basic Usage<a href="#basic-usage" class="hash-link" aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/comutex.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Static member for shared synchronization across all container instances</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex shared_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Instance member for per-container synchronization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex instance_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SomeTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">SomeTaskType</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Manual lock/unlock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    shared_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... critical section ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    shared_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Unlock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// OR use RAII scoped lock (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoMutex </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">instance_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... critical section ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Automatically unlocks when leaving scope</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Static member definition (required)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">shared_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-features">Key Features<a href="#key-features" class="hash-link" aria-label="Direct link to Key Features" title="Direct link to Key Features" translate="no">​</a></h4>
<ol>
<li class=""><strong>Automatic Task Context</strong>: Uses CHI_CUR_WORKER internally - no task parameters needed</li>
<li class=""><strong>TaskId Grouping</strong>: Tasks with the same TaskId bypass the mutex</li>
<li class=""><strong>RAII Support</strong>: ScopedCoMutex for automatic lock management</li>
<li class=""><strong>Try-Lock Support</strong>: Non-blocking lock attempts</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="api-reference">API Reference<a href="#api-reference" class="hash-link" aria-label="Direct link to API Reference" title="Direct link to API Reference" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chi </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CoMutex</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Blocking operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Block until lock acquired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Unlock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Release the lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">TryLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                 </span><span class="token comment" style="color:rgb(106, 153, 85)">// Non-blocking lock attempt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// No task parameters needed - uses CHI_CUR_WORKER automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// RAII wrapper (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ScopedCoMutex</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ScopedCoMutex</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CoMutex</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mutex</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Locks in constructor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">~</span><span class="token function" style="color:rgb(220, 220, 170)">ScopedCoMutex</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Unlocks in destructor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="corwlock-cooperative-reader-writer-lock">CoRwLock: Cooperative Reader-Writer Lock<a href="#corwlock-cooperative-reader-writer-lock" class="hash-link" aria-label="Direct link to CoRwLock: Cooperative Reader-Writer Lock" title="Direct link to CoRwLock: Cooperative Reader-Writer Lock" translate="no">​</a></h3>
<p>CoRwLock provides reader-writer semantics with TaskId grouping. Multiple readers can proceed concurrently, but writers have exclusive access.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-usage-1">Basic Usage<a href="#basic-usage-1" class="hash-link" aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/corwlock.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Protect shared data structures</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ReadTaskType</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Manual reader lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... read operations ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ReadUnlock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// OR use RAII scoped reader lock (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwReadLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... read operations ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Automatically unlocks when leaving scope</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">WriteTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">WriteTaskType</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// RAII scoped writer lock (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwWriteLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... write operations ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Automatically unlocks when leaving scope</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Static member definition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-features-1">Key Features<a href="#key-features-1" class="hash-link" aria-label="Direct link to Key Features" title="Direct link to Key Features" translate="no">​</a></h4>
<ol>
<li class=""><strong>Multiple Readers</strong>: Concurrent read access when no writers are active</li>
<li class=""><strong>Exclusive Writers</strong>: Writers get exclusive access, blocking all other operations</li>
<li class=""><strong>TaskId Grouping</strong>: Tasks with same TaskId can bypass reader locks</li>
<li class=""><strong>Automatic Context</strong>: Uses CHI_CUR_WORKER for task identification</li>
<li class=""><strong>RAII Support</strong>: Scoped locks for both readers and writers</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="api-reference-1">API Reference<a href="#api-reference-1" class="hash-link" aria-label="Direct link to API Reference" title="Direct link to API Reference" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chi </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CoRwLock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Reader operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">// Acquire reader lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadUnlock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">              </span><span class="token comment" style="color:rgb(106, 153, 85)">// Release reader lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">TryReadLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">// Non-blocking reader lock attempt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Writer operations  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">WriteLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">               </span><span class="token comment" style="color:rgb(106, 153, 85)">// Acquire exclusive writer lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">WriteUnlock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">// Release writer lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">TryWriteLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Non-blocking writer lock attempt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// RAII wrappers (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ScopedCoRwReadLock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ScopedCoRwReadLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CoRwLock</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Acquire read lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">~</span><span class="token function" style="color:rgb(220, 220, 170)">ScopedCoRwReadLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Release read lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ScopedCoRwWriteLock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ScopedCoRwWriteLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CoRwLock</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Acquire write lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">~</span><span class="token function" style="color:rgb(220, 220, 170)">ScopedCoRwWriteLock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                       </span><span class="token comment" style="color:rgb(106, 153, 85)">// Release write lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="taskid-grouping-behavior">TaskId Grouping Behavior<a href="#taskid-grouping-behavior" class="hash-link" aria-label="Direct link to TaskId Grouping Behavior" title="Direct link to TaskId Grouping Behavior" translate="no">​</a></h3>
<p>Both CoMutex and CoRwLock support TaskId grouping, which allows related tasks to bypass synchronization:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Tasks created with the same TaskId can proceed together</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// These tasks share the same TaskId - they can bypass CoMutex/CoRwLock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task1 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">Task1</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task2 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">Task2</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// This task has a different TaskId - must respect locks normally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task3 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">Task3</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Key Points:</strong></p>
<ul>
<li class="">Tasks with the same TaskId are considered &quot;grouped&quot; and can bypass locks</li>
<li class="">Use TaskId grouping for logically related operations that don&#x27;t need mutual exclusion</li>
<li class="">Different TaskIds must respect normal lock semantics</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h3>
<ol>
<li class=""><strong>Use RAII Wrappers</strong>: Always prefer <code>ScopedCoMutex</code> and <code>ScopedCoRw*Lock</code> over manual lock/unlock</li>
<li class=""><strong>Static vs Instance</strong>: Use static members for cross-container synchronization, instance members for per-container data</li>
<li class=""><strong>Member Definition</strong>: Don&#x27;t forget to define static members in your .cc file</li>
<li class=""><strong>Choose Appropriate Lock</strong>: Use CoRwLock for read-heavy workloads, CoMutex for simple mutual exclusion</li>
<li class=""><strong>Minimal Critical Sections</strong>: Keep locked sections as small as possible</li>
<li class=""><strong>TaskId Design</strong>: Group related tasks that can safely bypass locks</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-module-with-synchronized-data-structure">Example: Module with Synchronized Data Structure<a href="#example-module-with-synchronized-data-structure" class="hash-link" aria-label="Direct link to Example: Module with Synchronized Data Structure" title="Direct link to Example: Module with Synchronized Data Structure" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// In MOD_NAME_runtime.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Synchronized data structure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">hash_map</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ModuleData</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Synchronization primitives</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// For data_map_ access</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex operation_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">// For exclusive operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ReadDataTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">WriteData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">WriteDataTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ExclusiveOperation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ExclusiveTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// In MOD_NAME_runtime.cc  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">operation_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">ReadData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ReadDataTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwReadLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Multiple readers allowed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Safe to read data_map_ concurrently</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> it </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">key_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">it </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">end</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_data_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> it</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">second</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Success</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Not found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">WriteData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">WriteDataTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwWriteLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Exclusive writer access</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Safe to modify data_map_ exclusively</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">key_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Success</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">ExclusiveOperation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ExclusiveTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoMutex </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">operation_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Exclusive operation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Perform operation that requires complete exclusivity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... complex operation ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Success</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<p>This synchronization model ensures thread-safe access to module data structures while maintaining compatibility with Chimaera&#x27;s cooperative task execution system.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pool-query-and-task-routing">Pool Query and Task Routing<a href="#pool-query-and-task-routing" class="hash-link" aria-label="Direct link to Pool Query and Task Routing" title="Direct link to Pool Query and Task Routing" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview-of-poolquery">Overview of PoolQuery<a href="#overview-of-poolquery" class="hash-link" aria-label="Direct link to Overview of PoolQuery" title="Direct link to Overview of PoolQuery" translate="no">​</a></h3>
<p>PoolQuery is a fundamental component of Chimaera&#x27;s task routing system that determines where and how tasks are executed across the distributed runtime. It provides flexible routing strategies for load balancing, locality optimization, and distributed execution patterns.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="poolquery-types">PoolQuery Types<a href="#poolquery-types" class="hash-link" aria-label="Direct link to PoolQuery Types" title="Direct link to PoolQuery Types" translate="no">​</a></h3>
<p>The <code>chi::PoolQuery</code> class provides six different routing modes through static factory methods:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-local-mode">1. Local Mode<a href="#1-local-mode" class="hash-link" aria-label="Direct link to 1. Local Mode" title="Direct link to 1. Local Mode" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Local</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>Purpose</strong>: Routes tasks to the local node only</li>
<li class=""><strong>Use Case</strong>: Operations that must execute on the calling node</li>
<li class=""><strong>Example</strong>: MPI-based container creation, node-specific diagnostics</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Client usage in MPI environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Local</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_pool&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-direct-id-mode">2. Direct ID Mode<a href="#2-direct-id-mode" class="hash-link" aria-label="Direct link to 2. Direct ID Mode" title="Direct link to 2. Direct ID Mode" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">DirectId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ContainerId container_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>Purpose</strong>: Routes to a specific container by its unique ID</li>
<li class=""><strong>Use Case</strong>: Targeted operations on known containers</li>
<li class=""><strong>Example</strong>: Container-specific configuration changes</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Route to container with ID 42</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">DirectId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">ContainerId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">42</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">UpdateConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> new_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-direct-hash-mode">3. Direct Hash Mode<a href="#3-direct-hash-mode" class="hash-link" aria-label="Direct link to 3. Direct Hash Mode" title="Direct link to 3. Direct Hash Mode" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">DirectHash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">u32 hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>Purpose</strong>: Routes using consistent hash-based load balancing</li>
<li class=""><strong>Use Case</strong>: Distributing operations across containers deterministically</li>
<li class=""><strong>Example</strong>: Key-value store operations where keys map to specific containers</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Hash-based routing for a key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">u32 hash </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">hash</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">DirectHash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Put</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-range-mode">4. Range Mode<a href="#4-range-mode" class="hash-link" aria-label="Direct link to 4. Range Mode" title="Direct link to 4. Range Mode" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Range</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">u32 offset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> u32 count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>Purpose</strong>: Routes to a range of containers</li>
<li class=""><strong>Use Case</strong>: Batch operations across multiple containers</li>
<li class=""><strong>Example</strong>: Parallel scan operations, bulk updates</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Process containers 10-19 (10 containers starting at offset 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Range</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">BulkUpdate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> update_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-broadcast-mode">5. Broadcast Mode<a href="#5-broadcast-mode" class="hash-link" aria-label="Direct link to 5. Broadcast Mode" title="Direct link to 5. Broadcast Mode" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>Purpose</strong>: Routes to all containers in the pool</li>
<li class=""><strong>Use Case</strong>: Global operations affecting all containers</li>
<li class=""><strong>Example</strong>: Configuration updates, global cache invalidation</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Broadcast configuration change to all containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">InvalidateCache</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-physical-mode">6. Physical Mode<a href="#6-physical-mode" class="hash-link" aria-label="Direct link to 6. Physical Mode" title="Direct link to 6. Physical Mode" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Physical</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">u32 node_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>Purpose</strong>: Routes to a specific physical node by ID</li>
<li class=""><strong>Use Case</strong>: Node-specific operations in distributed deployments</li>
<li class=""><strong>Example</strong>: Remote node administration, cross-node data migration</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Execute on physical node 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Physical</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">NodeDiagnostics</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-dynamic-mode-recommended-for-create-operations">7. Dynamic Mode (Recommended for Create Operations)<a href="#7-dynamic-mode-recommended-for-create-operations" class="hash-link" aria-label="Direct link to 7. Dynamic Mode (Recommended for Create Operations)" title="Direct link to 7. Dynamic Mode (Recommended for Create Operations)" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Dynamic</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>Purpose</strong>: Intelligent routing with automatic caching optimization</li>
<li class=""><strong>Use Case</strong>: Create operations that benefit from local cache checking</li>
<li class=""><strong>Behavior</strong>: Uses dynamic scheduling (ExecMode::kDynamicSchedule) for cache optimization<!-- -->
<ol>
<li class="">Check if pool exists locally using PoolManager</li>
<li class="">If pool exists: change pool_query to Local (execute locally using existing pool)</li>
<li class="">If pool doesn&#x27;t exist: change pool_query to Broadcast (create pool on all nodes)</li>
</ol>
</li>
<li class=""><strong>Benefits</strong>:<!-- -->
<ul>
<li class="">Avoids redundant pool creation attempts</li>
<li class="">Eliminates unnecessary network overhead for existing pools</li>
<li class="">Automatic fallback to broadcast creation when needed</li>
</ul>
</li>
<li class=""><strong>Example</strong>: Container creation with automatic caching</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Recommended: Use Dynamic() for Create operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Dynamic</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_pool&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Dynamic scheduling will:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// - Check local cache for &quot;my_pool&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// - If found: switch to Local mode (fast path)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// - If not found: switch to Broadcast mode (creation path)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="poolquery-usage-guidelines">PoolQuery Usage Guidelines<a href="#poolquery-usage-guidelines" class="hash-link" aria-label="Direct link to PoolQuery Usage Guidelines" title="Direct link to PoolQuery Usage Guidelines" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-1">Best Practices<a href="#best-practices-1" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h4>
<ol>
<li class=""><strong>Never use null queries</strong>: Always specify an explicit PoolQuery type</li>
<li class=""><strong>Default to Dynamic for Create</strong>: Use <code>PoolQuery::Dynamic()</code> for container creation to enable automatic caching optimization</li>
<li class=""><strong>Alternative: Use Broadcast or Local explicitly</strong>:<!-- -->
<ul>
<li class="">Use <code>Broadcast()</code> when you want to force distributed creation regardless of cache</li>
<li class="">Use <code>Local()</code> in MPI jobs when you want node-local containers only</li>
</ul>
</li>
<li class=""><strong>Consider locality</strong>: Prefer local execution to minimize network overhead for regular operations</li>
<li class=""><strong>Use appropriate granularity</strong>: Match routing mode to operation scope</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-patterns">Common Patterns<a href="#common-patterns" class="hash-link" aria-label="Direct link to Common Patterns" title="Direct link to Common Patterns" translate="no">​</a></h4>
<p><strong>Container Creation Pattern (Recommended)</strong>:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Recommended: Use Dynamic for automatic cache optimization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// This checks local cache first and falls back to broadcast creation if needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Dynamic</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_pool_name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Container Creation Pattern (Explicit Broadcast)</strong>:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Alternative: Use Broadcast to force distributed creation regardless of cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// This ensures the container is created across all nodes in distributed environments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_pool_name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Container Creation Pattern (MPI Environments)</strong>:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// In MPI jobs, Local may be more efficient for node-local containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Use Local when you want node-local containers only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Local</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_pool_name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Load-Balanced Operations</strong>:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Use hash-based routing for even distribution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> item </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  u32 hash </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ComputeHash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">item</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">DirectHash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Process</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<p><strong>Batch Processing</strong>:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Process containers in chunks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> u32 total_containers </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pool_info</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">num_containers_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> u32 batch_size </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">u32 offset </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> offset </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> total_containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> offset </span><span class="token operator" style="color:rgb(212, 212, 212)">+=</span><span class="token plain"> batch_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  u32 count </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">min</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> total_containers </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> offset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Range</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">offset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">BatchProcess</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> batch_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-routing-implementation">Runtime Routing Implementation<a href="#runtime-routing-implementation" class="hash-link" aria-label="Direct link to Runtime Routing Implementation" title="Direct link to Runtime Routing Implementation" translate="no">​</a></h3>
<p>The runtime uses PoolQuery to determine task routing through several stages:</p>
<ol>
<li class=""><strong>Query Validation</strong>: Ensures the query parameters are valid</li>
<li class=""><strong>Container Resolution</strong>: Maps query to specific container(s)</li>
<li class=""><strong>Task Distribution</strong>: Routes task to appropriate worker queues</li>
<li class=""><strong>Load Balancing</strong>: Applies distribution strategies for multi-container queries</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="poolquery-in-task-definitions">PoolQuery in Task Definitions<a href="#poolquery-in-task-definitions" class="hash-link" aria-label="Direct link to PoolQuery in Task Definitions" title="Direct link to PoolQuery in Task Definitions" translate="no">​</a></h3>
<p>Tasks must include PoolQuery in their constructors:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CustomTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">CustomTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Allocator </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">             </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">TaskId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">             </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">             </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Required parameter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">/* custom parameters */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> task_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> method_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Task initialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-poolquery-features">Advanced PoolQuery Features<a href="#advanced-poolquery-features" class="hash-link" aria-label="Direct link to Advanced PoolQuery Features" title="Direct link to Advanced PoolQuery Features" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="query-introspection">Query Introspection<a href="#query-introspection" class="hash-link" aria-label="Direct link to Query Introspection" title="Direct link to Query Introspection" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">PoolQuery query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Range</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Check routing mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">IsRangeMode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  u32 offset </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetRangeOffset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  u32 count </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetRangeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Process range parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Get routing mode enum</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">RoutingMode mode </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">GetRoutingMode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> RoutingMode</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Local</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Handle local routing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> RoutingMode</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Broadcast</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Handle broadcast</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... other cases</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="combining-with-task-priorities">Combining with Task Priorities<a href="#combining-with-task-priorities" class="hash-link" aria-label="Direct link to Combining with Task Priorities" title="Direct link to Combining with Task Priorities" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// High-priority broadcast</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">UpdateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    update_data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Enqueue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kHighPriority</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting-poolquery-issues">Troubleshooting PoolQuery Issues<a href="#troubleshooting-poolquery-issues" class="hash-link" aria-label="Direct link to Troubleshooting PoolQuery Issues" title="Direct link to Troubleshooting PoolQuery Issues" translate="no">​</a></h3>
<p><strong>Common Errors</strong>:</p>
<ol>
<li class="">
<p><strong>Null Query Error</strong>: &quot;NEVER use a null pool query&quot;</p>
<ul>
<li class="">Solution: Always use a factory method like <code>PoolQuery::Local()</code></li>
</ul>
</li>
<li class="">
<p><strong>Invalid Container ID</strong>: Container not found for DirectId query</p>
<ul>
<li class="">Solution: Verify container exists before using DirectId</li>
</ul>
</li>
<li class="">
<p><strong>Range Out of Bounds</strong>: Range exceeds available containers</p>
<ul>
<li class="">Solution: Check pool size before creating Range queries</li>
</ul>
</li>
<li class="">
<p><strong>Node ID Invalid</strong>: Physical node ID doesn&#x27;t exist</p>
<ul>
<li class="">Solution: Validate node IDs against cluster configuration</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="client-server-communication">Client-Server Communication<a href="#client-server-communication" class="hash-link" aria-label="Direct link to Client-Server Communication" title="Direct link to Client-Server Communication" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="client-implementation-patterns">Client Implementation Patterns<a href="#client-implementation-patterns" class="hash-link" aria-label="Direct link to Client Implementation Patterns" title="Direct link to Client Implementation Patterns" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="critical-pool-id-update-pattern">Critical Pool ID Update Pattern<a href="#critical-pool-id-update-pattern" class="hash-link" aria-label="Direct link to Critical Pool ID Update Pattern" title="Direct link to Critical Pool ID Update Pattern" translate="no">​</a></h4>
<p><strong>IMPORTANT</strong>: All ChiMod clients that implement Create methods MUST update their <code>pool_id_</code> field with the actual pool ID returned from completed CreateTask operations. This is essential because:</p>
<ol>
<li class="">CreateTask operations may return a different pool ID than initially specified</li>
<li class="">Pool creation may reuse existing pools with different IDs</li>
<li class="">Subsequent client operations depend on the correct pool ID</li>
</ol>
<p><strong>Required Pattern for All Client Create Methods:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">/* other module-specific parameters */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* other params */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Wait</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// CRITICAL: Update client pool_id_ with the actual pool ID from the task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CHI_IPC</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<p><strong>Required Parameters for All Create Methods:</strong></p>
<ol>
<li class=""><strong>mctx</strong>: Memory context for shared memory allocations</li>
<li class=""><strong>pool_query</strong>: Task routing strategy (use <code>Broadcast()</code> for non-MPI, <code>Local()</code> for MPI)</li>
<li class=""><strong>pool_name</strong>: User-provided name for the pool (must be unique, used as file path for file-based modules)</li>
<li class=""><strong>custom_pool_id</strong>: Explicit pool ID for the container being created (must not be null)</li>
<li class=""><strong>Module-specific parameters</strong>: Additional parameters specific to the ChiMod (e.g., BDev type, size)</li>
</ol>
<p><strong>Why This Is Required:</strong></p>
<ul>
<li class=""><strong>Pool Reuse</strong>: CreateTask is actually a GetOrCreatePoolTask that may return an existing pool</li>
<li class=""><strong>ID Assignment</strong>: The admin ChiMod may assign a different pool ID than requested</li>
<li class=""><strong>Client Consistency</strong>: All subsequent operations must use the correct pool ID</li>
<li class=""><strong>Distributed Operation</strong>: Pool IDs must be consistent across all client instances</li>
</ul>
<p><strong>Examples of Correct Implementation:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Admin client Create method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Wait</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// CRITICAL: Update client pool_id_ with the actual pool ID from the task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> ipc_manager </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> CHI_IPC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// BDev client Create method (with module-specific parameters)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            BdevType bdev_type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 total_size </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 io_depth </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">128</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 alignment </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4096</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                           bdev_type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> total_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> io_depth</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> alignment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Wait</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// CRITICAL: Update client pool_id_ with the actual pool ID from the task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CHI_IPC</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// MOD_NAME client Create method (simple case)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Wait</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// CRITICAL: Update client pool_id_ with the actual pool ID from the task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CHI_IPC</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<p><strong>Common Mistakes to Avoid:</strong></p>
<ul>
<li class="">❌ <strong>Using null PoolId for custom_pool_id</strong>: Create operations REQUIRE explicit, non-null pool IDs</li>
<li class="">❌ <strong>Forgetting to update pool_id_</strong>: Leads to incorrect pool ID for subsequent operations</li>
<li class="">❌ <strong>Using original pool_id_</strong>: The task may return a different pool ID than initially specified</li>
<li class="">❌ <strong>Updating before task completion</strong>: Always wait for task completion before reading new_pool_id_</li>
<li class="">❌ <strong>Not implementing this pattern</strong>: All synchronous Create methods must follow this pattern</li>
<li class="">❌ <strong>Using Local instead of Broadcast</strong>: In non-MPI environments, use <code>Broadcast()</code> for distributed container creation</li>
</ul>
<p><strong>Critical Validation:</strong></p>
<p>The runtime validates that <code>custom_pool_id</code> is not null during Create operations. If a null PoolId is provided, the Create operation will fail with an error:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG - This will fail with error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId null_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Null pool ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_pool&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> null_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Error: &quot;Cannot create pool with null PoolId. Explicit pool IDs are required.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// CORRECT - Always provide explicit pool IDs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Broadcast</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_pool&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> custom_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p>This pattern is mandatory for all ChiMod clients and ensures correct pool ID management throughout the client lifecycle.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="memory-segments">Memory Segments<a href="#memory-segments" class="hash-link" aria-label="Direct link to Memory Segments" title="Direct link to Memory Segments" translate="no">​</a></h3>
<p>Three shared memory segments are used:</p>
<ol>
<li class=""><strong>Main Segment</strong>: Tasks and control structures</li>
<li class=""><strong>Client Data Segment</strong>: User data buffers</li>
<li class=""><strong>Runtime Data Segment</strong>: Runtime-only data</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ipc-queue">IPC Queue<a href="#ipc-queue" class="hash-link" aria-label="Direct link to IPC Queue" title="Direct link to IPC Queue" translate="no">​</a></h3>
<p>Tasks are submitted via a lock-free multi-producer single-consumer queue:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Client side</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CustomTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Enqueue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Server side</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer task_ptr </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Dequeue</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kLowLatency</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="memory-management">Memory Management<a href="#memory-management" class="hash-link" aria-label="Direct link to Memory Management" title="Direct link to Memory Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="allocator-usage">Allocator Usage<a href="#allocator-usage" class="hash-link" aria-label="Direct link to Allocator Usage" title="Direct link to Allocator Usage" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Get context allocator for current segment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ctx_alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> allocator</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Allocate serializable string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string </span><span class="token function" style="color:rgb(220, 220, 170)">my_string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ctx_alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;initial value&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Allocate vector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">u32</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">my_vector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ctx_alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">my_vector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">resize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-2">Best Practices<a href="#best-practices-2" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h3>
<ol>
<li class="">Always use HSHM types for shared data</li>
<li class="">Pass CtxAllocator to constructors</li>
<li class="">Use FullPtr for cross-process references</li>
<li class="">Let framework handle task cleanup via <code>ipc_manager-&gt;DelTask()</code></li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-allocation-and-deallocation-pattern">Task Allocation and Deallocation Pattern<a href="#task-allocation-and-deallocation-pattern" class="hash-link" aria-label="Direct link to Task Allocation and Deallocation Pattern" title="Direct link to Task Allocation and Deallocation Pattern" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Client side - allocation (NewTask uses main allocator automatically)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CustomTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    input_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    operation_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Client side - cleanup (after task completion)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Runtime side - automatic cleanup (no code needed)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Framework Del dispatcher calls ipc_manager-&gt;DelTask() automatically</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chi_ipc-buffer-allocation">CHI_IPC Buffer Allocation<a href="#chi_ipc-buffer-allocation" class="hash-link" aria-label="Direct link to CHI_IPC Buffer Allocation" title="Direct link to CHI_IPC Buffer Allocation" translate="no">​</a></h3>
<p>The <code>CHI_IPC</code> singleton provides centralized buffer allocation for shared memory operations in client code. Use this for allocating temporary buffers that need to be shared between client and runtime processes.</p>
<p><strong>Important</strong>: <code>AllocateBuffer</code> returns <code>hipc::FullPtr&lt;char&gt;</code>, not <code>hipc::Pointer</code>. It is NOT a template function.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-usage-2">Basic Usage<a href="#basic-usage-2" class="hash-link" aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Get the IPC manager singleton</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> ipc_manager </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> CHI_IPC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Allocate a buffer in shared memory (returns FullPtr&lt;char&gt;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">size_t buffer_size </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1024</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> buffer_ptr </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">AllocateBuffer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">buffer_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Use the buffer (example: copy data into it)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> buffer_data </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> buffer_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ptr_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">memcpy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">buffer_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> source_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> data_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Alternative: Use directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">strncpy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">buffer_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">ptr_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;example data&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> buffer_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// The buffer will be automatically freed when buffer_ptr goes out of scope</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// or when explicitly deallocated by the framework</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="use-cases-for-chi_ipc-buffers">Use Cases for CHI_IPC Buffers<a href="#use-cases-for-chi_ipc-buffers" class="hash-link" aria-label="Direct link to Use Cases for CHI_IPC Buffers" title="Direct link to Use Cases for CHI_IPC Buffers" translate="no">​</a></h4>
<ul>
<li class=""><strong>Temporary data transfer</strong>: When passing large data to tasks</li>
<li class=""><strong>Intermediate storage</strong>: For computations that need shared memory</li>
<li class=""><strong>I/O operations</strong>: Reading/writing data that needs to be accessible by runtime</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-3">Best Practices<a href="#best-practices-3" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// ✅ Good: Use CHI_IPC for temporary shared buffers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> ipc_manager </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> CHI_IPC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> temp_buffer </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">AllocateBuffer</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// ✅ Good: Use chi::ipc types for persistent task data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string </span><span class="token function" style="color:rgb(220, 220, 170)">task_string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ctx_alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;persistent data&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// ❌ Avoid: Don&#x27;t use CHI_IPC for small, simple task parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Use chi::ipc types directly in task definitions instead</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shared-memory-compatible-data-structures">Shared-Memory Compatible Data Structures<a href="#shared-memory-compatible-data-structures" class="hash-link" aria-label="Direct link to Shared-Memory Compatible Data Structures" title="Direct link to Shared-Memory Compatible Data Structures" translate="no">​</a></h3>
<p>For task definitions and any data that needs to be shared between client and runtime processes, always use shared-memory compatible types instead of standard C++ containers.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="chiipcstring">chi::ipc::string<a href="#chiipcstring" class="hash-link" aria-label="Direct link to chi::ipc::string" title="Direct link to chi::ipc::string" translate="no">​</a></h4>
<p>Use <code>chi::ipc::string</code> or <code>hipc::string</code> instead of <code>std::string</code> in task definitions:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/types.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Task definition using shared-memory string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CustomTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string input_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// Shared-memory compatible string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string output_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Results stored in shared memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">CustomTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">             </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">input_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Initialize from std::string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">output_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">          </span><span class="token comment" style="color:rgb(106, 153, 85)">// Empty initialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Conversion to std::string when needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string </span><span class="token function" style="color:rgb(220, 220, 170)">getResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">output_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> output_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="chiipcvector">chi::ipc::vector<a href="#chiipcvector" class="hash-link" aria-label="Direct link to chi::ipc::vector" title="Direct link to chi::ipc::vector" translate="no">​</a></h4>
<p>Use <code>chi::ipc::vector</code> instead of <code>std::vector</code> for arrays in task definitions:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Task definition using shared-memory vector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ProcessArrayTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> data_array_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">f32</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> result_array_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">ProcessArrayTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                   </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">data_array_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">result_array_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Copy from std::vector to shared-memory vector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    data_array_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">resize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">input_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">input_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">begin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> input_data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">end</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> data_array_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">begin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-use-each-type">When to Use Each Type<a href="#when-to-use-each-type" class="hash-link" aria-label="Direct link to When to Use Each Type" title="Direct link to When to Use Each Type" translate="no">​</a></h4>
<p><strong>Use shared-memory types (chi::ipc::string, hipc::string, chi::ipc::vector, etc.) for:</strong></p>
<ul>
<li class="">Task input/output parameters</li>
<li class="">Data that persists across task execution</li>
<li class="">Any data structure that needs serialization</li>
<li class="">Data shared between client and runtime</li>
</ul>
<p><strong>Use std::string/vector for:</strong></p>
<ul>
<li class="">Local variables in client code</li>
<li class="">Temporary computations</li>
<li class="">Converting to/from shared-memory types</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="type-conversion-examples">Type Conversion Examples<a href="#type-conversion-examples" class="hash-link" aria-label="Direct link to Type Conversion Examples" title="Direct link to Type Conversion Examples" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Converting between std::string and shared-memory string types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string std_str </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;example data&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string </span><span class="token function" style="color:rgb(220, 220, 170)">shm_str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ctx_alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> std_str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">          </span><span class="token comment" style="color:rgb(106, 153, 85)">// std -&gt; shared memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string result </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">shm_str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// shared memory -&gt; std</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Converting between std::vector and shared-memory vector types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> std_vec </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">shm_vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ctx_alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">shm_vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">assign</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">std_vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">begin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> std_vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">end</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// std -&gt; shared memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">result_vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">shm_vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">begin</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> shm_vec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">end</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// shared memory -&gt; std</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="serialization-support">Serialization Support<a href="#serialization-support" class="hash-link" aria-label="Direct link to Serialization Support" title="Direct link to Serialization Support" translate="no">​</a></h4>
<p>Both <code>chi::ipc::string</code> and <code>chi::ipc::vector</code> automatically support serialization for task communication:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Task definition - no manual serialization needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">SerializableTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string message_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> timestamps_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Cereal automatically handles chi::ipc types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">serialize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> timestamps_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Works automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="bulk-transfer-support-with-arbulk">Bulk Transfer Support with ar.bulk<a href="#bulk-transfer-support-with-arbulk" class="hash-link" aria-label="Direct link to Bulk Transfer Support with ar.bulk" title="Direct link to Bulk Transfer Support with ar.bulk" translate="no">​</a></h3>
<p>For tasks that involve large data transfers (such as I/O operations), Chimaera provides <code>ar.bulk()</code> for efficient bulk data serialization. This feature integrates with the Lightbeam networking layer to enable zero-copy data transfer and RDMA optimization.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview-2">Overview<a href="#overview-2" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h4>
<p>The <code>ar.bulk()</code> method marks data pointers for bulk transfer during task serialization. This is essential for:</p>
<ul>
<li class=""><strong>Large I/O Operations</strong>: Read/write tasks with multi-megabyte payloads</li>
<li class=""><strong>Zero-Copy Transfer</strong>: Avoiding unnecessary data copies during serialization</li>
<li class=""><strong>RDMA Optimization</strong>: Preparing data for remote direct memory access</li>
<li class=""><strong>Distributed Execution</strong>: Sending tasks with large data buffers across nodes</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="bulk-transfer-flags">Bulk Transfer Flags<a href="#bulk-transfer-flags" class="hash-link" aria-label="Direct link to Bulk Transfer Flags" title="Direct link to Bulk Transfer Flags" translate="no">​</a></h4>
<p>Two flags control bulk transfer behavior:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Defined in hermes_shm/lightbeam/lightbeam.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">BULK_EXPOSE</span><span class="token macro property">  </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">// Metadata only - no data transfer (receiver allocates)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">BULK_XFER</span><span class="token macro property">    </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">// Marks bulk for actual data transmission</span><br></span></code></pre></div></div>
<p><strong>Flag Usage:</strong></p>
<ul>
<li class=""><strong>BULK_EXPOSE</strong>: Sender exposes metadata (size, pointer info) but doesn&#x27;t transfer data<!-- -->
<ul>
<li class="">Receiver sees the bulk size and allocates local buffer</li>
<li class="">Useful when receiver will write data (e.g., Read operations)</li>
</ul>
</li>
<li class=""><strong>BULK_XFER</strong>: Marks bulk for actual data transmission<!-- -->
<ul>
<li class="">Data is transferred over network</li>
<li class="">Used when sender has data to send (e.g., Write operations)</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-usage-pattern">Basic Usage Pattern<a href="#basic-usage-pattern" class="hash-link" aria-label="Direct link to Basic Usage Pattern" title="Direct link to Basic Usage Pattern" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="write-operation-sender-has-data">Write Operation (Sender Has Data)<a href="#write-operation-sender-has-data" class="hash-link" aria-label="Direct link to Write Operation (Sender Has Data)" title="Direct link to Write Operation (Sender Has Data)" translate="no">​</a></h5>
<p>For write operations, the sender has data to transfer:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">WriteTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN Block block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">              </span><span class="token comment" style="color:rgb(106, 153, 85)">// Block to write to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)">// Data buffer pointer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN size_t length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Data length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 bytes_written_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Serialize IN and INOUT parameters */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SerializeIn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Use BULK_XFER to transfer data from sender to receiver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bulk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> BULK_XFER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Serialize OUT and INOUT parameters */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SerializeOut</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">bytes_written_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// No bulk transfer needed for output (just metadata)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Workflow:</strong></p>
<ol>
<li class=""><strong>Client Side (SerializeIn)</strong>:<!-- -->
<ul>
<li class="">Serializes <code>block_</code> and <code>length_</code> metadata</li>
<li class="">Marks <code>data_</code> buffer with <code>BULK_XFER</code> flag</li>
<li class="">Lightbeam transmits the data buffer to receiver</li>
</ul>
</li>
<li class=""><strong>Runtime Side (Execute)</strong>:<!-- -->
<ul>
<li class="">Receives metadata and data buffer</li>
<li class="">Executes write operation using transferred data</li>
<li class="">Sets <code>bytes_written_</code> result</li>
</ul>
</li>
<li class=""><strong>Client Side (SerializeOut)</strong>:<!-- -->
<ul>
<li class="">Receives <code>bytes_written_</code> result</li>
<li class="">No bulk transfer needed for small output values</li>
</ul>
</li>
</ol>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="read-operation-receiver-needs-data">Read Operation (Receiver Needs Data)<a href="#read-operation-receiver-needs-data" class="hash-link" aria-label="Direct link to Read Operation (Receiver Needs Data)" title="Direct link to Read Operation (Receiver Needs Data)" translate="no">​</a></h5>
<p>For read operations, the receiver allocates buffer for incoming data:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ReadTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN Block block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">              </span><span class="token comment" style="color:rgb(106, 153, 85)">// Block to read from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Data buffer pointer (allocated by receiver)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT size_t length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// Requested/actual length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// Result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Serialize IN and INOUT parameters */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SerializeIn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Use BULK_EXPOSE - metadata only, receiver will allocate buffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bulk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> BULK_EXPOSE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Serialize OUT and INOUT parameters */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SerializeOut</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Use BULK_XFER to transfer read data back to client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bulk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> BULK_XFER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Workflow:</strong></p>
<ol>
<li class=""><strong>Client Side (SerializeIn)</strong>:<!-- -->
<ul>
<li class="">Serializes <code>block_</code> and <code>length_</code> metadata</li>
<li class="">Marks <code>data_</code> with <code>BULK_EXPOSE</code> (no data sent yet)</li>
<li class="">Receiver sees buffer size needed</li>
</ul>
</li>
<li class=""><strong>Runtime Side (Execute)</strong>:<!-- -->
<ul>
<li class="">Receives metadata including buffer size</li>
<li class="">Allocates local buffer for <code>data_</code></li>
<li class="">Executes read operation filling the buffer</li>
<li class="">Sets <code>length_</code> and <code>bytes_read_</code> results</li>
</ul>
</li>
<li class=""><strong>Client Side (SerializeOut)</strong>:<!-- -->
<ul>
<li class="">Marks <code>data_</code> with <code>BULK_XFER</code> flag</li>
<li class="">Lightbeam transfers read data back to client</li>
<li class="">Client receives <code>length_</code>, <code>bytes_read_</code>, and data buffer</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="api-reference-2">API Reference<a href="#api-reference-2" class="hash-link" aria-label="Direct link to API Reference" title="Direct link to API Reference" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bulk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> size_t size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">uint32_t</span><span class="token plain"> flags</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>ptr</code>: Pointer to data buffer (<code>hipc::Pointer</code>, <code>hipc::FullPtr</code>, or raw pointer)</li>
<li class=""><code>size</code>: Size of data in bytes</li>
<li class=""><code>flags</code>: Transfer flags (<code>BULK_EXPOSE</code> or <code>BULK_XFER</code>)</li>
</ul>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Records bulk transfer metadata in the archive</li>
<li class="">For <code>BULK_XFER</code>: Prepares data for network transmission</li>
<li class="">For <code>BULK_EXPOSE</code>: Records metadata only (size and pointer info)</li>
<li class="">Integrates with Lightbeam networking for actual data transfer</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-pattern-bidirectional-transfer">Advanced Pattern: Bidirectional Transfer<a href="#advanced-pattern-bidirectional-transfer" class="hash-link" aria-label="Direct link to Advanced Pattern: Bidirectional Transfer" title="Direct link to Advanced Pattern: Bidirectional Transfer" translate="no">​</a></h4>
<p>Some operations require data transfer in both directions:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ProcessTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Data buffer (modified in-place)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT size_t length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// Buffer length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Serialize IN and INOUT parameters */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SerializeIn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Send input data to runtime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bulk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> BULK_XFER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Serialize OUT and INOUT parameters */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SerializeOut</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Send modified data back to client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bulk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> BULK_XFER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="integration-with-lightbeam">Integration with Lightbeam<a href="#integration-with-lightbeam" class="hash-link" aria-label="Direct link to Integration with Lightbeam" title="Direct link to Integration with Lightbeam" translate="no">​</a></h4>
<p>The <code>ar.bulk()</code> calls integrate seamlessly with the Lightbeam networking layer:</p>
<ol>
<li class="">
<p><strong>Archive Records Bulks</strong>:</p>
<ul>
<li class="">TaskOutputArchive stores bulk metadata in <code>bulk_transfers_</code> vector</li>
<li class="">Each bulk includes pointer, size, and flags</li>
</ul>
</li>
<li class="">
<p><strong>Lightbeam Transmission</strong>:</p>
<ul>
<li class="">Bulks marked <code>BULK_XFER</code> are transmitted via <code>Send()</code> and <code>RecvBulks()</code></li>
<li class="">Bulks marked <code>BULK_EXPOSE</code> provide metadata only</li>
<li class="">Receiver inspects all bulks to determine buffer sizes</li>
</ul>
</li>
<li class="">
<p><strong>Zero-Copy Optimization</strong>:</p>
<ul>
<li class="">Data stays in original buffers during serialization</li>
<li class="">Only pointers and metadata are serialized</li>
<li class="">Actual data transfer handled separately by Lightbeam</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-example-bdev-read-task">Complete Example: BDev Read Task<a href="#complete-example-bdev-read-task" class="hash-link" aria-label="Direct link to Complete Example: BDev Read Task" title="Direct link to Complete Example: BDev Read Task" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">ReadTask</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  IN Block block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">              </span><span class="token comment" style="color:rgb(106, 153, 85)">// Block descriptor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Data buffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INOUT size_t length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">         </span><span class="token comment" style="color:rgb(106, 153, 85)">// Buffer length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  OUT chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// Bytes actually read</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** SHM constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Emplace constructor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">explicit</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CtxAllocator</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CHI_MAIN_ALLOC_T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">TaskId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">task_node</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> Block </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">block</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Pointer data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    size_t length</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alloc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">block</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task_node</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    method_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kRead</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task_flags_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Clear</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_query_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Serialize IN and INOUT parameters */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SerializeIn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// BULK_EXPOSE: Tell receiver the buffer size, but don&#x27;t send data yet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Receiver will allocate local buffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bulk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> BULK_EXPOSE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Serialize OUT and INOUT parameters */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Archive</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SerializeOut</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Archive </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// BULK_XFER: Transfer the read data back to client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bulk</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> BULK_XFER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Copy from another ReadTask */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ReadTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Copy task-specific fields only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Base Task fields are copied automatically by NewCopy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    block_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">block_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    data_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    length_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">length_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    bytes_read_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> other</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">bytes_read_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">/** Aggregate results from replica */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Aggregate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ReadTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// For reads, just copy the result from the replica</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">Copy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-4">Best Practices<a href="#best-practices-4" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h4>
<p><strong>DO:</strong></p>
<ul>
<li class="">✅ Use <code>BULK_XFER</code> when sender has data to transmit (Write operations)</li>
<li class="">✅ Use <code>BULK_EXPOSE</code> when receiver needs to allocate buffer (Read operations)</li>
<li class="">✅ Always specify both <code>SerializeIn()</code> and <code>SerializeOut()</code> for consistency</li>
<li class="">✅ Use <code>ar.bulk()</code> for data buffers larger than a few KB</li>
<li class="">✅ Ensure data buffer lifetime extends until serialization completes</li>
</ul>
<p><strong>DON&#x27;T:</strong></p>
<ul>
<li class="">❌ Don&#x27;t use <code>ar.bulk()</code> for small data (&lt; 4KB) - serialize directly instead</li>
<li class="">❌ Don&#x27;t forget to specify bulk size - it determines receiver buffer allocation</li>
<li class="">❌ Don&#x27;t mix <code>ar()</code> and <code>ar.bulk()</code> for the same data - choose one approach</li>
<li class="">❌ Don&#x27;t use <code>BULK_EXPOSE</code> for write operations (sender has data to send)</li>
<li class="">❌ Don&#x27;t use <code>BULK_XFER</code> in SerializeIn for read operations (no data to send yet)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-considerations">Performance Considerations<a href="#performance-considerations" class="hash-link" aria-label="Direct link to Performance Considerations" title="Direct link to Performance Considerations" translate="no">​</a></h4>
<ol>
<li class=""><strong>Buffer Alignment</strong>: Ensure buffers are properly aligned (typically 4KB for I/O operations)</li>
<li class=""><strong>Size Thresholds</strong>: Use bulk transfer for data &gt; 4KB; use regular serialization for smaller data</li>
<li class=""><strong>Zero-Copy</strong>: Lightbeam can use zero-copy techniques when data is in shared memory</li>
<li class=""><strong>RDMA Ready</strong>: The bulk transfer API is designed for future RDMA transport integration</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h4>
<p><strong>Common Issues:</strong></p>
<ol>
<li class="">
<p><strong>Missing Data Transfer</strong>:</p>
<ul>
<li class="">Ensure <code>BULK_XFER</code> flag is used when data should be transmitted</li>
<li class="">Check that SerializeOut uses <code>BULK_XFER</code> for read operations</li>
</ul>
</li>
<li class="">
<p><strong>Buffer Size Mismatch</strong>:</p>
<ul>
<li class="">Verify <code>length_</code> parameter matches actual buffer size</li>
<li class="">Ensure receiver allocates buffer matching the exposed size</li>
</ul>
</li>
<li class="">
<p><strong>Serialization Order</strong>:</p>
<ul>
<li class="">Serialize metadata (block, length) before <code>ar.bulk()</code> call</li>
<li class="">This ensures receiver knows buffer size before allocating</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chiunordered_map_ll---lock-free-unordered-map">chi::unordered_map_ll - Lock-Free Unordered Map<a href="#chiunordered_map_ll---lock-free-unordered-map" class="hash-link" aria-label="Direct link to chi::unordered_map_ll - Lock-Free Unordered Map" title="Direct link to chi::unordered_map_ll - Lock-Free Unordered Map" translate="no">​</a></h3>
<p>The <code>chi::unordered_map_ll</code> is a hash map implementation using a vector of lists design that provides efficient concurrent access when combined with external locking. This container is specifically designed for runtime module data structures that require external synchronization control.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview-3">Overview<a href="#overview-3" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h4>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li class=""><strong>Vector of Lists Design</strong>: Uses a vector of buckets, each containing a list of key-value pairs</li>
<li class=""><strong>External Locking Required</strong>: No internal mutexes - users must provide synchronization</li>
<li class=""><strong>Bucket Partitioning</strong>: Hash space is partitioned across multiple buckets for better cache locality</li>
<li class=""><strong>Standard API</strong>: Compatible with <code>std::unordered_map</code> interface</li>
<li class=""><strong>NOT Shared-Memory Compatible</strong>: For runtime-only data structures, not task parameters</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-usage-3">Basic Usage<a href="#basic-usage-3" class="hash-link" aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/unordered_map_ll.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Runtime data structure with external locking</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ModuleData</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// External synchronization using CoRwLock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">Runtime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// 32 buckets for hash partitioning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ReadData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ReadTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwReadLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Safe to access data_map_ with external lock held</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> value </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">key_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">WriteData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">WriteTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwWriteLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Safe to modify data_map_ with exclusive lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert_or_assign</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">key_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Static member definition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="constructor">Constructor<a href="#constructor" class="hash-link" aria-label="Direct link to Constructor" title="Direct link to Constructor" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Create map with specified bucket count (determines max useful concurrency)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> T</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">max_concurrency</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Example: 32 buckets provides good distribution for most workloads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><code>max_concurrency</code>: Number of buckets (default: 16)<!-- -->
<ul>
<li class="">Higher values = better distribution, more memory overhead</li>
<li class="">Typical values: 16-64 for most use cases</li>
<li class="">Should be power of 2 for optimal hash distribution</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="api-reference-3">API Reference<a href="#api-reference-3" class="hash-link" aria-label="Direct link to API Reference" title="Direct link to API Reference" translate="no">​</a></h4>
<p>The container provides a <code>std::unordered_map</code>-compatible interface:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Insertion operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">inserted</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> value_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">          </span><span class="token comment" style="color:rgb(106, 153, 85)">// Insert if not exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">inserted</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> value_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert_or_assign</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Insert or update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">T</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ref </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                                            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Insert default if missing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Lookup operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">T</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> ptr </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Returns nullptr if not found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> T</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> ptr </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Const version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">T</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ref </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Throws if not found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> exists </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">contains</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">           </span><span class="token comment" style="color:rgb(106, 153, 85)">// Check existence</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">size_t count </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">             </span><span class="token comment" style="color:rgb(106, 153, 85)">// Returns 0 or 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Removal operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">size_t erased </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">erase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Returns number of elements erased</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">clear</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                          </span><span class="token comment" style="color:rgb(106, 153, 85)">// Remove all elements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Size operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">size_t size </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Total element count</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> empty </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">empty</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Check if empty</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">size_t buckets </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">bucket_count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)">// Number of buckets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Iteration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">for_each</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> Key</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> T</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Process each element</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Note: External lock must be held during iteration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="return-value-semantics">Return Value Semantics<a href="#return-value-semantics" class="hash-link" aria-label="Direct link to Return Value Semantics" title="Direct link to Return Value Semantics" translate="no">​</a></h4>
<p>Insert operations return <code>std::pair&lt;bool, T*&gt;</code>:</p>
<ul>
<li class=""><code>first</code>: <code>true</code> if insertion occurred, <code>false</code> if key already exists</li>
<li class=""><code>second</code>: Pointer to the value (existing or newly inserted)</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">inserted</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> value_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">42</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;hello&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">inserted</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// New element was inserted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Inserted: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">value_ptr </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Key already existed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Existing: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">value_ptr </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-locking-patterns">External Locking Patterns<a href="#external-locking-patterns" class="hash-link" aria-label="Direct link to External Locking Patterns" title="Direct link to External Locking Patterns" translate="no">​</a></h4>
<p><strong>Pattern 1: CoRwLock for Read-Heavy Workloads</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> CachedData</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> cache_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock cache_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">LookupCache</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">LookupTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwReadLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">cache_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Multiple readers allowed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> data </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> cache_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">cache_key_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">found_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">found_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">UpdateCache</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">UpdateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwWriteLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">cache_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Exclusive writer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    cache_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert_or_assign</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">cache_key_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">cache_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Pattern 2: CoMutex for Write-Heavy Workloads</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> RequestCounter</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> counters_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex counters_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">IncrementCounter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">IncrementTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoMutex </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">counters_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">inserted</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> counter_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> counters_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">counter_name_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> RequestCounter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    counter_ptr</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">count</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_count_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> counter_ptr</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">counters_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Pattern 3: Instance-Level Locking</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Per-container instance data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> TaskState</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> active_tasks_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex instance_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Instance member, not static</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">RegisterTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">RegisterTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoMutex </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">instance_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Lock this container instance only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    active_tasks_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">task_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> TaskState</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">start_time_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-use-chiunordered_map_ll">When to Use chi::unordered_map_ll<a href="#when-to-use-chiunordered_map_ll" class="hash-link" aria-label="Direct link to When to Use chi::unordered_map_ll" title="Direct link to When to Use chi::unordered_map_ll" translate="no">​</a></h4>
<p><strong>✅ Use chi::unordered_map_ll for:</strong></p>
<ul>
<li class="">Runtime container data structures (caches, registries, counters)</li>
<li class="">Module-internal state management</li>
<li class="">Lookup tables for fast key-value access</li>
<li class="">Data structures protected by CoMutex/CoRwLock</li>
<li class="">Non-shared memory data (runtime process only)</li>
</ul>
<p><strong>❌ Do NOT use chi::unordered_map_ll for:</strong></p>
<ul>
<li class="">Task input/output parameters (use <code>chi::ipc::</code> types instead)</li>
<li class="">Shared-memory data structures (not compatible with HSHM allocators)</li>
<li class="">Client-side code (use <code>std::unordered_map</code> instead)</li>
<li class="">Data that needs to be serialized (use <code>std::unordered_map</code> with cereal)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-considerations-1">Performance Considerations<a href="#performance-considerations-1" class="hash-link" aria-label="Direct link to Performance Considerations" title="Direct link to Performance Considerations" translate="no">​</a></h4>
<p><strong>Bucket Count Selection:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Small datasets (&lt; 100 elements): 16 buckets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Value</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">small_map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Medium datasets (100-10000 elements): 32-64 buckets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Value</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">medium_map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Large datasets (&gt; 10000 elements): 64-128 buckets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Value</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">large_map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">64</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Very large datasets or high concurrency: 128+ buckets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Value</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">huge_map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">128</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Iteration Performance:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Iteration requires external lock for entire duration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ProcessAllEntries</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwReadLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Hold lock during entire iteration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  size_t count </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  data_map_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">for_each</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> Key</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Value</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Process entry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    count</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">processed_count_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Lock released when scope exits</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-example-request-tracking-module">Complete Example: Request Tracking Module<a href="#complete-example-request-tracking-module" class="hash-link" aria-label="Direct link to Complete Example: Request Tracking Module" title="Direct link to Complete Example: Request Tracking Module" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// In MOD_NAME_runtime.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/unordered_map_ll.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/corwlock.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">private</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Request tracking data structure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">RequestInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 start_time_us_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64 bytes_processed_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 status_code_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Map of active requests (external locking required)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> RequestInfo</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> active_requests_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Completed request statistics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">unordered_map_ll</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> status_counts_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Synchronization primitives</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock requests_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex stats_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">Runtime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">active_requests_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">64</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">// 64 buckets for active requests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">status_counts_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">// 16 buckets for status codes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">StartRequest</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">StartRequestTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwWriteLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">requests_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    RequestInfo info</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">start_time_us_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">timestamp_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">bytes_processed_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">status_code_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    active_requests_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">request_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> info</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">CompleteRequest</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CompleteRequestTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Update active requests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwWriteLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">requests_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> info </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> active_requests_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">find</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">request_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">duration_us_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">end_time_ </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> info</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">start_time_us_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">bytes_processed_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> info</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">bytes_processed_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Update statistics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoMutex </span><span class="token function" style="color:rgb(220, 220, 170)">stats_lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">stats_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">inserted</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> count_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> status_counts_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">insert_or_assign</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            info</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">status_code_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">count_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        active_requests_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">erase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">request_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">GetStatistics</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">GetStatsTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Read statistics with read lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoRwReadLock </span><span class="token function" style="color:rgb(220, 220, 170)">lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">requests_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">active_count_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> active_requests_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Get status code distribution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ScopedCoMutex </span><span class="token function" style="color:rgb(220, 220, 170)">stats_lock</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">stats_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    status_counts_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">for_each</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> status</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u64</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">status_distribution_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">push_back</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">status</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Static member definitions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoRwLock Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">requests_lock_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CoMutex Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">stats_mutex_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-differences-from-stdunordered_map">Key Differences from std::unordered_map<a href="#key-differences-from-stdunordered_map" class="hash-link" aria-label="Direct link to Key Differences from std::unordered_map" title="Direct link to Key Differences from std::unordered_map" translate="no">​</a></h4>
<table><thead><tr><th>Feature</th><th>std::unordered_map</th><th>chi::unordered_map_ll</th></tr></thead><tbody><tr><td>Thread Safety</td><td>None (external locking required)</td><td>None (external locking required)</td></tr><tr><td>Internal Structure</td><td>Implementation-defined</td><td>Vector of lists (explicit)</td></tr><tr><td>Bucket Count</td><td>Dynamic rehashing</td><td>Fixed at construction</td></tr><tr><td>Iterator Stability</td><td>Unstable across insertions</td><td>Stable (list-based)</td></tr><tr><td>Shared Memory</td><td>Not compatible</td><td>Not compatible</td></tr><tr><td>Return Values</td><td>Iterators</td><td>Pointers to values</td></tr><tr><td>Use Case</td><td>General purpose</td><td>Runtime data structures</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h4>
<p><code>chi::unordered_map_ll</code> provides a specialized hash map implementation optimized for Chimaera runtime modules:</p>
<ol>
<li class=""><strong>External Locking</strong>: Must be protected by CoMutex or CoRwLock</li>
<li class=""><strong>Fixed Buckets</strong>: Bucket count set at construction (no rehashing)</li>
<li class=""><strong>Pointer Interface</strong>: Operations return pointers instead of iterators</li>
<li class=""><strong>Runtime Only</strong>: Not for shared-memory or task parameters</li>
<li class=""><strong>Efficient Lookup</strong>: O(1) average case for find/insert/erase operations</li>
</ol>
<p>For runtime container data structures requiring fast key-value access with external synchronization, <code>chi::unordered_map_ll</code> provides an efficient and predictable solution.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="build-system-integration">Build System Integration<a href="#build-system-integration" class="hash-link" aria-label="Direct link to Build System Integration" title="Direct link to Build System Integration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cmakeliststxt-template">CMakeLists.txt Template<a href="#cmakeliststxt-template" class="hash-link" aria-label="Direct link to CMakeLists.txt Template" title="Direct link to CMakeLists.txt Template" translate="no">​</a></h3>
<p>ChiMod CMakeLists.txt files should use the standardized ChimaeraCommon.cmake functions for consistency and proper configuration:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">cmake_minimum_required(VERSION 3.10)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Create both client and runtime libraries for your module</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># This creates targets: ${NAMESPACE}_${CHIMOD_NAME}_runtime and ${NAMESPACE}_${CHIMOD_NAME}_client</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># CMake aliases: ${NAMESPACE}::${CHIMOD_NAME}_runtime and ${NAMESPACE}::${CHIMOD_NAME}_client</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_client(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  CHIMOD_NAME YOUR_MODULE_NAME</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES src/YOUR_MODULE_NAME_client.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_runtime(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  CHIMOD_NAME YOUR_MODULE_NAME</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES src/YOUR_MODULE_NAME_runtime.cc src/autogen/YOUR_MODULE_NAME_lib_exec.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Installation is automatic - no separate install_chimod() call required</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cmakeliststxt-guidelines">CMakeLists.txt Guidelines<a href="#cmakeliststxt-guidelines" class="hash-link" aria-label="Direct link to CMakeLists.txt Guidelines" title="Direct link to CMakeLists.txt Guidelines" translate="no">​</a></h3>
<p><strong>DO:</strong></p>
<ul>
<li class="">Use <code>add_chimod_client()</code> and <code>add_chimod_runtime()</code> utility functions (installation is automatic)</li>
<li class="">Set <code>CHIMOD_NAME</code> to your module&#x27;s name</li>
<li class="">List source files explicitly in <code>SOURCES</code> parameters</li>
<li class="">Include autogen source files in runtime <code>SOURCES</code></li>
<li class="">Keep the CMakeLists.txt minimal and consistent</li>
</ul>
<p><strong>DON&#x27;T:</strong></p>
<ul>
<li class="">Use manual <code>add_library()</code> calls - use the utilities instead</li>
<li class="">Call <code>install_chimod()</code> separately - it&#x27;s handled automatically</li>
<li class="">Include relative paths like <code>../include/*</code> - use proper include directories</li>
<li class="">Set custom compile definitions - the utilities handle this</li>
<li class="">Manually configure target properties - the utilities provide standard settings</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chimod-build-functions-reference">ChiMod Build Functions Reference<a href="#chimod-build-functions-reference" class="hash-link" aria-label="Direct link to ChiMod Build Functions Reference" title="Direct link to ChiMod Build Functions Reference" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="add_chimod_client-function"><code>add_chimod_client()</code> Function<a href="#add_chimod_client-function" class="hash-link" aria-label="Direct link to add_chimod_client-function" title="Direct link to add_chimod_client-function" translate="no">​</a></h4>
<p>Creates a ChiMod client library target with automatic dependency management.</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_client(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES source_file1.cc source_file2.cc ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [COMPILE_DEFINITIONS definition1 definition2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [LINK_LIBRARIES library1 library2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [LINK_DIRECTORIES directory1 directory2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [INCLUDE_LIBRARIES target1 target2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [INCLUDE_DIRECTORIES directory1 directory2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><strong><code>SOURCES</code></strong> (required): List of source files for the client library</li>
<li class=""><strong><code>COMPILE_DEFINITIONS</code></strong> (optional): Additional preprocessor definitions beyond automatic ones</li>
<li class=""><strong><code>LINK_LIBRARIES</code></strong> (optional): Additional libraries to link beyond automatic dependencies</li>
<li class=""><strong><code>LINK_DIRECTORIES</code></strong> (optional): Additional library search directories</li>
<li class=""><strong><code>INCLUDE_LIBRARIES</code></strong> (optional): Target libraries whose include directories should be inherited</li>
<li class=""><strong><code>INCLUDE_DIRECTORIES</code></strong> (optional): Additional include directories beyond automatic ones</li>
</ul>
<p><strong>Automatic Behavior:</strong></p>
<ul>
<li class="">Creates target: <code>${NAMESPACE}_${CHIMOD_NAME}_client</code></li>
<li class="">Creates alias: <code>${NAMESPACE}::${CHIMOD_NAME}_client</code></li>
<li class="">Automatically links core Chimaera library (<code>chimaera::cxx</code> or <code>hermes_shm::cxx</code>)</li>
<li class="">For non-admin ChiMods: automatically links <code>chimaera_admin_client</code></li>
<li class="">Automatically includes module headers from <code>include/</code> directory</li>
<li class="">Installs library and headers with proper CMake export configuration</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_client(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES src/my_module_client.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  COMPILE_DEFINITIONS MY_MODULE_DEBUG=1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  LINK_LIBRARIES additional_lib</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INCLUDE_DIRECTORIES ${EXTERNAL_INCLUDE_DIR}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="add_chimod_runtime-function"><code>add_chimod_runtime()</code> Function<a href="#add_chimod_runtime-function" class="hash-link" aria-label="Direct link to add_chimod_runtime-function" title="Direct link to add_chimod_runtime-function" translate="no">​</a></h4>
<p>Creates a ChiMod runtime library target with automatic dependency management.</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_runtime(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES source_file1.cc source_file2.cc ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [COMPILE_DEFINITIONS definition1 definition2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [LINK_LIBRARIES library1 library2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [LINK_DIRECTORIES directory1 directory2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [INCLUDE_LIBRARIES target1 target2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  [INCLUDE_DIRECTORIES directory1 directory2 ...]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span></code></pre></div></div>
<p><strong>Parameters:</strong></p>
<ul>
<li class=""><strong><code>SOURCES</code></strong> (required): List of source files for the runtime library (include autogen files)</li>
<li class=""><strong><code>COMPILE_DEFINITIONS</code></strong> (optional): Additional preprocessor definitions beyond automatic ones</li>
<li class=""><strong><code>LINK_LIBRARIES</code></strong> (optional): Additional libraries to link beyond automatic dependencies</li>
<li class=""><strong><code>LINK_DIRECTORIES</code></strong> (optional): Additional library search directories</li>
<li class=""><strong><code>INCLUDE_LIBRARIES</code></strong> (optional): Target libraries whose include directories should be inherited</li>
<li class=""><strong><code>INCLUDE_DIRECTORIES</code></strong> (optional): Additional include directories beyond automatic ones</li>
</ul>
<p><strong>Automatic Behavior:</strong></p>
<ul>
<li class="">Creates target: <code>${NAMESPACE}_${CHIMOD_NAME}_runtime</code></li>
<li class="">Creates alias: <code>${NAMESPACE}::${CHIMOD_NAME}_runtime</code></li>
<li class="">Automatically defines <code>CHIMAERA_RUNTIME=1</code> for runtime code</li>
<li class="">Automatically links core Chimaera library (<code>chimaera::cxx</code> or <code>hermes_shm::cxx</code>)</li>
<li class="">Automatically links <code>rt</code> library for POSIX real-time support</li>
<li class="">For non-admin ChiMods: automatically links both <code>chimaera_admin_runtime</code> and <code>chimaera_admin_client</code></li>
<li class="">Automatically includes module headers from <code>include/</code> directory</li>
<li class="">Links to client library if it exists</li>
<li class="">Installs library and headers with proper CMake export configuration</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_runtime(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    src/my_module_runtime.cc </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    src/autogen/my_module_lib_exec.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  COMPILE_DEFINITIONS MY_MODULE_RUNTIME_DEBUG=1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  LINK_LIBRARIES libaio</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  INCLUDE_DIRECTORIES ${LIBAIO_INCLUDE_DIR}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-requirements">Configuration Requirements<a href="#configuration-requirements" class="hash-link" aria-label="Direct link to Configuration Requirements" title="Direct link to Configuration Requirements" translate="no">​</a></h4>
<p>Before using these functions, ensure your ChiMod directory contains:</p>
<ol>
<li class="">
<p><strong><code>chimaera_mod.yaml</code></strong>: Module configuration file defining the module name</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">module_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> my_module</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Include structure</strong>: Headers organized as <code>include/[namespace]/[module_name]/</code></p>
</li>
<li class="">
<p><strong>Source files</strong>: Client and runtime implementations with autogen files for runtime</p>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="typical-usage-pattern">Typical Usage Pattern<a href="#typical-usage-pattern" class="hash-link" aria-label="Direct link to Typical Usage Pattern" title="Direct link to Typical Usage Pattern" translate="no">​</a></h4>
<p>Most ChiMods use both functions together:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Create client library</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_client(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES src/my_module_client.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Create runtime library</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_runtime(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    src/my_module_runtime.cc </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    src/autogen/my_module_lib_exec.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span></code></pre></div></div>
<p><strong>Function Dependencies:</strong>
Both functions automatically handle common dependencies:</p>
<ul>
<li class=""><strong>Core Library</strong>: Automatically links appropriate Chimaera core library</li>
<li class=""><strong>Runtime Libraries</strong>: <code>add_chimod_runtime()</code> automatically links <code>rt</code> library for async I/O operations</li>
<li class=""><strong>Admin ChiMod Integration</strong>: For non-admin chimods, both functions automatically link admin libraries and include admin headers</li>
<li class=""><strong>Client-Runtime Linking</strong>: Runtime automatically links to client library when both exist</li>
</ul>
<p>This eliminates the need for manual dependency configuration in individual ChiMod CMakeLists.txt files.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="target-naming-and-linking">Target Naming and Linking<a href="#target-naming-and-linking" class="hash-link" aria-label="Direct link to Target Naming and Linking" title="Direct link to Target Naming and Linking" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="target-format">Target Format<a href="#target-format" class="hash-link" aria-label="Direct link to Target Format" title="Direct link to Target Format" translate="no">​</a></h4>
<p>The system uses underscore-based target names for consistency with CMake conventions:</p>
<p><strong>Target Names:</strong></p>
<ul>
<li class=""><strong>Runtime</strong>: <code>${NAMESPACE}_${CHIMOD_NAME}_runtime</code> (e.g., <code>chimaera_admin_runtime</code>)</li>
<li class=""><strong>Client</strong>: <code>${NAMESPACE}_${CHIMOD_NAME}_client</code> (e.g., <code>chimaera_admin_client</code>)</li>
</ul>
<p><strong>CMake Aliases (Recommended):</strong></p>
<ul>
<li class=""><strong>Runtime</strong>: <code>${NAMESPACE}::${CHIMOD_NAME}_runtime</code> (e.g., <code>chimaera::admin_runtime</code>)</li>
<li class=""><strong>Client</strong>: <code>${NAMESPACE}::${CHIMOD_NAME}_client</code> (e.g., <code>chimaera::admin_client</code>)</li>
</ul>
<p><strong>Package Names:</strong></p>
<ul>
<li class="">Format: <code>${NAMESPACE}_${CHIMOD_NAME}</code> (e.g., <code>chimaera_admin</code>)</li>
<li class="">Used with: <code>find_package(chimaera_admin REQUIRED)</code></li>
<li class="">Core package: <code>chimaera</code> (automatically included by <code>find_package(chimaera)</code>)</li>
</ul>
<p><strong>External Application Linking (Based on test/unit/external/CMakeLists.txt):</strong></p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># External applications typically only need ChiMod client libraries</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Core library dependencies are automatically included</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">find_package(chimaera REQUIRED)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">find_package(chimaera_admin REQUIRED)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">target_link_libraries(my_external_app</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chimaera::admin_client            # Admin client (includes all dependencies)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ${CMAKE_THREAD_LIBS_INIT}         # Threading support</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Note: chimaera::cxx is automatically included by ChiMod client libraries</span><br></span></code></pre></div></div>
<p><strong>Internal Development Linking:</strong></p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># For internal development within the Chimaera project</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">target_link_libraries(internal_app</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chimaera::admin_client            # ChiMod client</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chimaera::bdev_client             # BDev client </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  # Core dependencies are automatically linked by ChiMod libraries</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="automatic-dependencies">Automatic Dependencies<a href="#automatic-dependencies" class="hash-link" aria-label="Direct link to Automatic Dependencies" title="Direct link to Automatic Dependencies" translate="no">​</a></h3>
<p>The ChiMod build functions automatically handle common dependencies:</p>
<p><strong>For Runtime Code:</strong></p>
<ul>
<li class=""><strong>rt library</strong>: Automatically linked for POSIX real-time library support (async I/O operations)</li>
<li class=""><strong>Admin ChiMod</strong>: Automatically linked for all non-admin ChiMods (both runtime and client)</li>
<li class=""><strong>Admin includes</strong>: Automatically added to include directories for non-admin ChiMods</li>
</ul>
<p><strong>For All ChiMods:</strong></p>
<ul>
<li class="">Creates both client and runtime shared libraries</li>
<li class="">Sets proper include directories (include/, <code>${CMAKE_SOURCE_DIR}</code>/include)</li>
<li class="">Automatically links core Chimaera dependencies</li>
<li class="">Sets required compile definitions (CHI_CHIMOD_NAME, CHI_NAMESPACE)</li>
<li class="">Configures proper build flags and settings</li>
</ul>
<p><strong>Simplified Development:</strong>
ChiMod developers no longer need to manually specify:</p>
<ul>
<li class=""><code>rt</code> library dependencies</li>
<li class="">Admin ChiMod dependencies (<code>chimaera_admin_runtime</code>, <code>chimaera_admin_client</code>)</li>
<li class="">Admin include directories</li>
<li class="">Core Chimaera library dependencies</li>
<li class="">Common linking patterns</li>
</ul>
<p><strong>Important Note for External Applications:</strong>
External applications linking against ChiMod libraries receive all necessary dependencies automatically. The ChiMod client libraries include the core Chimaera library as a transitive dependency.</p>
<p><strong>Automatic Installation:</strong>
The ChiMod build functions automatically handle installation:</p>
<ul>
<li class="">Installs libraries to the correct destination</li>
<li class="">Sets up proper runtime paths</li>
<li class="">Configures installation properties</li>
<li class="">Includes automatic dependencies in exported CMake packages</li>
<li class="">No separate <code>install_chimod()</code> call required</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="targets-created-by-chimod-functions">Targets Created by ChiMod Functions<a href="#targets-created-by-chimod-functions" class="hash-link" aria-label="Direct link to Targets Created by ChiMod Functions" title="Direct link to Targets Created by ChiMod Functions" translate="no">​</a></h3>
<p>When you call <code>add_chimod_client()</code> and <code>add_chimod_runtime()</code> with <code>CHIMOD_NAME YOUR_MODULE_NAME</code>, they create the following CMake targets using the underscore-based naming format:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="target-naming-system">Target Naming System<a href="#target-naming-system" class="hash-link" aria-label="Direct link to Target Naming System" title="Direct link to Target Naming System" translate="no">​</a></h4>
<ul>
<li class=""><strong>Actual Target Names</strong>: <code>${NAMESPACE}_${CHIMOD_NAME}_runtime</code> and <code>${NAMESPACE}_${CHIMOD_NAME}_client</code></li>
<li class=""><strong>CMake Aliases</strong>: <code>${NAMESPACE}::${CHIMOD_NAME}_runtime</code> and <code>${NAMESPACE}::${CHIMOD_NAME}_client</code> (<strong>recommended</strong>)</li>
<li class=""><strong>Package Names</strong>: <code>${NAMESPACE}_${CHIMOD_NAME}</code> (for <code>find_package()</code>)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-target-namespace_chimod_name_runtime">Runtime Target: <code>${NAMESPACE}_${CHIMOD_NAME}_runtime</code><a href="#runtime-target-namespace_chimod_name_runtime" class="hash-link" aria-label="Direct link to runtime-target-namespace_chimod_name_runtime" title="Direct link to runtime-target-namespace_chimod_name_runtime" translate="no">​</a></h4>
<ul>
<li class=""><strong>Target Name</strong>: <code>chimaera_YOUR_MODULE_NAME_runtime</code> (e.g., <code>chimaera_admin_runtime</code>, <code>chimaera_MOD_NAME_runtime</code>)</li>
<li class=""><strong>CMake Alias</strong>: <code>chimaera::YOUR_MODULE_NAME_runtime</code> (e.g., <code>chimaera::admin_runtime</code>) - <strong>recommended for linking</strong></li>
<li class=""><strong>Type</strong>: Shared library (<code>.so</code> file)</li>
<li class=""><strong>Purpose</strong>: Contains server-side execution logic, runs in the Chimaera runtime process</li>
<li class=""><strong>Compile Definitions</strong>:<!-- -->
<ul>
<li class=""><code>CHI_CHIMOD_NAME=&quot;${CHIMOD_NAME}&quot;</code> - Module name for runtime identification</li>
<li class=""><code>CHI_NAMESPACE=&quot;${NAMESPACE}&quot;</code> - Project namespace</li>
</ul>
</li>
<li class=""><strong>Include Directories</strong>:<!-- -->
<ul>
<li class=""><code>include/</code> - Local module headers</li>
<li class=""><code>${CMAKE_SOURCE_DIR}/include</code> - Chimaera framework headers</li>
</ul>
</li>
<li class=""><strong>Dependencies</strong>: Links against <code>chimaera</code> library, rt library (automatic), admin dependencies (automatic)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="client-target-namespace_chimod_name_client">Client Target: <code>${NAMESPACE}_${CHIMOD_NAME}_client</code><a href="#client-target-namespace_chimod_name_client" class="hash-link" aria-label="Direct link to client-target-namespace_chimod_name_client" title="Direct link to client-target-namespace_chimod_name_client" translate="no">​</a></h4>
<ul>
<li class=""><strong>Target Name</strong>: <code>chimaera_YOUR_MODULE_NAME_client</code> (e.g., <code>chimaera_admin_client</code>, <code>chimaera_MOD_NAME_client</code>)</li>
<li class=""><strong>CMake Alias</strong>: <code>chimaera::YOUR_MODULE_NAME_client</code> (e.g., <code>chimaera::admin_client</code>) - <strong>recommended for linking</strong></li>
<li class=""><strong>Type</strong>: Shared library (<code>.so</code> file)</li>
<li class=""><strong>Purpose</strong>: Contains client-side API, runs in user processes</li>
<li class=""><strong>Compile Definitions</strong>:<!-- -->
<ul>
<li class=""><code>CHI_CHIMOD_NAME=&quot;${CHIMOD_NAME}&quot;</code> - Module name for client identification</li>
<li class=""><code>CHI_NAMESPACE=&quot;${NAMESPACE}&quot;</code> - Project namespace</li>
</ul>
</li>
<li class=""><strong>Include Directories</strong>:<!-- -->
<ul>
<li class=""><code>include/</code> - Local module headers</li>
<li class=""><code>${CMAKE_SOURCE_DIR}/include</code> - Chimaera framework headers</li>
</ul>
</li>
<li class=""><strong>Dependencies</strong>: Links against <code>chimaera</code> library, admin dependencies (automatic)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="namespace-configuration">Namespace Configuration<a href="#namespace-configuration" class="hash-link" aria-label="Direct link to Namespace Configuration" title="Direct link to Namespace Configuration" translate="no">​</a></h4>
<p>The namespace is automatically read from <code>chimaera_repo.yaml</code> files. The system searches up the directory tree from the CMakeLists.txt location to find the first <code>chimaera_repo.yaml</code> file:</p>
<p><strong>Main project <code>chimaera_repo.yaml</code>:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chimaera  </span><span class="token comment" style="color:rgb(106, 153, 85)"># Main project namespace</span><br></span></code></pre></div></div>
<p><strong>Module repository <code>chimods/chimaera_repo.yaml</code>:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chimods   </span><span class="token comment" style="color:rgb(106, 153, 85)"># Modules get this namespace</span><br></span></code></pre></div></div>
<p>This means modules in the <code>chimods/</code> directory will use the &quot;chimods&quot; namespace, creating targets like <code>chimods_admin_runtime</code>, while other components use the main project namespace.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-output-files">Example Output Files<a href="#example-output-files" class="hash-link" aria-label="Direct link to Example Output Files" title="Direct link to Example Output Files" translate="no">​</a></h4>
<p>For a module named &quot;admin&quot; with namespace &quot;chimods&quot; (from <code>chimods/chimaera_repo.yaml</code>), the build produces:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">build/bin/libchimods_admin_runtime.so    # Runtime library  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">build/bin/libchimods_admin_client.so     # Client library</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-the-targets">Using the Targets<a href="#using-the-targets" class="hash-link" aria-label="Direct link to Using the Targets" title="Direct link to Using the Targets" translate="no">​</a></h4>
<p>You can reference these targets in your CMakeLists.txt using the full target name:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Add custom properties to the runtime target</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">set_target_properties(chimaera_${CHIMOD_NAME}_runtime PROPERTIES</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  VERSION 1.0.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOVERSION 1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Add additional dependencies if needed</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">target_link_libraries(chimaera_${CHIMOD_NAME}_runtime PRIVATE some_external_lib)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Or use the global property to get the actual target name</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">get_property(RUNTIME_TARGET GLOBAL PROPERTY ${CHIMOD_NAME}_RUNTIME_TARGET)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">target_link_libraries(${RUNTIME_TARGET} PRIVATE some_external_lib)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="module-configuration-chimaera_modyaml">Module Configuration (chimaera_mod.yaml)<a href="#module-configuration-chimaera_modyaml" class="hash-link" aria-label="Direct link to Module Configuration (chimaera_mod.yaml)" title="Direct link to Module Configuration (chimaera_mod.yaml)" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> MOD_NAME</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> 1.0.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">description</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Module description&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">author</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Author Name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">methods</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> kCreate</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> kCustom</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">dependencies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="auto-generated-method-files">Auto-Generated Method Files<a href="#auto-generated-method-files" class="hash-link" aria-label="Direct link to Auto-Generated Method Files" title="Direct link to Auto-Generated Method Files" translate="no">​</a></h3>
<p>Each module requires an auto-generated methods file at <code>include/[namespace]/MOD_NAME/autogen/MOD_NAME_methods.h</code>. This file must:</p>
<ol>
<li class=""><strong>Include chimaera.h</strong>: Required for GLOBAL_CONST macro</li>
<li class=""><strong>Use namespace constants</strong>: Define methods as <code>GLOBAL_CONST chi::u32</code> values</li>
<li class=""><strong>Follow naming convention</strong>: Method names should start with <code>k</code> (e.g., <code>kCreate</code>, <code>kCustom</code>)</li>
</ol>
<p><strong>Required Template:</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">MOD_NAME_AUTOGEN_METHODS_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">define</span><span class="token macro property"> </span><span class="token macro property macro-name">MOD_NAME_AUTOGEN_METHODS_H_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> Method </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Standard inherited methods (always include these)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kCreate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kDestroy </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kNodeFailure </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kRecover </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kMigrate </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kUpgrade </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Module-specific methods (customize these)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  GLOBAL_CONST chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 kCustom </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Add more module-specific methods starting from 10+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">endif</span><span class="token macro property"> </span><span class="token macro property comment" style="color:rgb(106, 153, 85)">// MOD_NAME_AUTOGEN_METHODS_H_</span><br></span></code></pre></div></div>
<p><strong>Important Notes:</strong></p>
<ul>
<li class=""><strong>GLOBAL_CONST is required</strong>: Do not use <code>const</code> or <code>constexpr</code> - use <code>GLOBAL_CONST</code></li>
<li class=""><strong>Include chimaera.h</strong>: This header defines the GLOBAL_CONST macro</li>
<li class=""><strong>Standard methods 0-5</strong>: Always include the inherited methods (kCreate through kUpgrade)</li>
<li class=""><strong>Custom methods 10+</strong>: Start custom methods from ID 10 to avoid conflicts</li>
<li class=""><strong>No static casting needed</strong>: Use method values directly (e.g., <code>method_ = Method::kCreate;</code>)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-entry-points">Runtime Entry Points<a href="#runtime-entry-points" class="hash-link" aria-label="Direct link to Runtime Entry Points" title="Direct link to Runtime Entry Points" translate="no">​</a></h3>
<p>Use the <code>CHI_TASK_CC</code> macro to define module entry points:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// At the end of your runtime source file (_runtime.cc)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">CHI_TASK_CC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">your_namespace</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">YourContainerClass</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<p>This macro automatically generates all required extern &quot;C&quot; functions and gets the module name from <code>YourContainerClass::CreateParams::chimod_lib_name</code>:</p>
<ul>
<li class=""><code>alloc_chimod()</code> - Creates container instance</li>
<li class=""><code>new_chimod()</code> - Creates and initializes container</li>
<li class=""><code>get_chimod_name()</code> - Returns module name</li>
<li class=""><code>destroy_chimod()</code> - Destroys container instance</li>
</ul>
<p><strong>Requirements for CHI_TASK_CC to work:</strong></p>
<ol>
<li class="">Your runtime class must define a public typedef: <code>using CreateParams = your_namespace::CreateParams;</code></li>
<li class="">Your CreateParams struct must have: <code>static constexpr const char* chimod_lib_name = &quot;your_module_name&quot;;</code></li>
</ol>
<p><strong>IMPORTANT:</strong> The <code>chimod_lib_name</code> should <strong>NOT</strong> include the <code>_runtime</code> suffix. The module manager automatically appends <code>_runtime</code> when loading the library. For example, use <code>&quot;chimaera_mymodule&quot;</code> not <code>&quot;chimaera_mymodule_runtime&quot;</code>.</p>
<p>Example:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">your_module </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> chimod_lib_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;chimaera_your_module&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... other parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateParams </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">your_module</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Required for CHI_TASK_CC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... rest of class</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::your_module</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>is_chimaera_chimod_</code> - Module identification flag</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="auto-generated-code-pattern">Auto-Generated Code Pattern<a href="#auto-generated-code-pattern" class="hash-link" aria-label="Direct link to Auto-Generated Code Pattern" title="Direct link to Auto-Generated Code Pattern" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview-4">Overview<a href="#overview-4" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h3>
<p>ChiMods use auto-generated source files to implement the Container virtual APIs (Run, Monitor, Del, SaveIn, LoadIn, SaveOut, LoadOut, NewCopy). This approach provides consistent dispatch logic and reduces boilerplate code.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="new-pattern-auto-generated-source-files">New Pattern: Auto-Generated Source Files<a href="#new-pattern-auto-generated-source-files" class="hash-link" aria-label="Direct link to New Pattern: Auto-Generated Source Files" title="Direct link to New Pattern: Auto-Generated Source Files" translate="no">​</a></h3>
<p>Instead of using inline functions in headers, ChiMods now use auto-generated <code>.cc</code> source files that implement the virtual methods directly. This pattern:</p>
<ul>
<li class=""><strong>Eliminates inline dispatchers</strong>: Virtual methods are implemented directly in auto-generated source</li>
<li class=""><strong>Reduces header dependencies</strong>: No need to include autogen headers in runtime files</li>
<li class=""><strong>Improves compilation</strong>: Source files compile once, not in every including file</li>
<li class=""><strong>Maintains consistency</strong>: All ChiMods use the same dispatch pattern</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="file-structure">File Structure<a href="#file-structure" class="hash-link" aria-label="Direct link to File Structure" title="Direct link to File Structure" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">src/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└── autogen/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    └── MOD_NAME_lib_exec.cc    # Auto-generated virtual method implementations</span><br></span></code></pre></div></div>
<p>The auto-generated source file contains:</p>
<ul>
<li class="">Container virtual method implementations (Run, Del, etc.)</li>
<li class="">Switch-case dispatch based on method IDs</li>
<li class="">Proper task type casting and method invocation</li>
<li class="">IPC manager integration for task lifecycle management</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="auto-generated-source-template">Auto-Generated Source Template<a href="#auto-generated-source-template" class="hash-link" aria-label="Direct link to Auto-Generated Source Template" title="Direct link to Auto-Generated Source Template" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Auto-generated execution implementation for MOD_NAME ChiMod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Implements Container virtual APIs directly using switch-case dispatch</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * This file is autogenerated - do not edit manually.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Changes should be made to the autogen tool or the YAML configuration.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/MOD_NAME/MOD_NAME_runtime.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/MOD_NAME/autogen/MOD_NAME_methods.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//==============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Runtime Virtual API Implementations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//==============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Run</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCreate</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kDestroy</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">Destroy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">DestroyTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCustom</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">Custom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CustomTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// Unknown method - do nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Del</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Use IPC manager to deallocate task from shared memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> ipc_manager </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> CHI_IPC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCreate</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kDestroy</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">DestroyTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">case</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCustom</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">Cast</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CustomTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// For unknown methods, still try to delete from main segment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">DelTask</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">break</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// SaveIn, LoadIn, SaveOut, LoadOut, and NewCopy follow similar patterns...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace chimaera::MOD_NAME</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-implementation-changes">Runtime Implementation Changes<a href="#runtime-implementation-changes" class="hash-link" aria-label="Direct link to Runtime Implementation Changes" title="Direct link to Runtime Implementation Changes" translate="no">​</a></h3>
<p>With the new autogen pattern, runtime source files (<code>MOD_NAME_runtime.cc</code>) no longer include autogen headers or implement dispatcher methods:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="before-old-pattern">Before (Old Pattern):<a href="#before-old-pattern" class="hash-link" aria-label="Direct link to Before (Old Pattern):" title="Direct link to Before (Old Pattern):" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// No autogen header includes needed with new pattern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Run</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Task</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Dispatch to the appropriate method handler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">MOD_NAME</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Run</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">this</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> task_ptr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> rctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Similar dispatcher implementations for Del, SaveIn, LoadIn, SaveOut, LoadOut, NewCopy...</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="after-new-pattern">After (New Pattern):<a href="#after-new-pattern" class="hash-link" aria-label="Direct link to After (New Pattern):" title="Direct link to After (New Pattern):" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// No autogen header includes needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// No dispatcher method implementations needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Virtual method implementations are now in src/autogen/MOD_NAME_lib_exec.cc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Runtime source focuses only on business logic methods like Create(), Custom(), etc.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cmake-integration">CMake Integration<a href="#cmake-integration" class="hash-link" aria-label="Direct link to CMake Integration" title="Direct link to CMake Integration" translate="no">​</a></h3>
<p>The auto-generated source file must be included in the <code>RUNTIME_SOURCES</code>:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_client(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  CHIMOD_NAME MOD_NAME</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES src/MOD_NAME_client.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_runtime(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  CHIMOD_NAME MOD_NAME</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES src/MOD_NAME_runtime.cc src/autogen/MOD_NAME_lib_exec.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="benefits-of-the-new-pattern">Benefits of the New Pattern<a href="#benefits-of-the-new-pattern" class="hash-link" aria-label="Direct link to Benefits of the New Pattern" title="Direct link to Benefits of the New Pattern" translate="no">​</a></h3>
<ol>
<li class=""><strong>Cleaner Runtime Code</strong>: Runtime implementations focus on business logic, not dispatching</li>
<li class=""><strong>Better Compilation</strong>: Source files compile once instead of being inlined in every header include</li>
<li class=""><strong>Consistent Pattern</strong>: All ChiMods use identical dispatch logic</li>
<li class=""><strong>Header Simplification</strong>: No need to include complex autogen headers</li>
<li class=""><strong>Better IDE Support</strong>: Proper source files work better with IDEs than inline templates</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="migration-guide">Migration Guide<a href="#migration-guide" class="hash-link" aria-label="Direct link to Migration Guide" title="Direct link to Migration Guide" translate="no">​</a></h3>
<p>To migrate from the old inline header pattern to the new source pattern:</p>
<ol>
<li class=""><strong>Create autogen source directory</strong>: <code>mkdir -p src/autogen/</code></li>
<li class=""><strong>Generate new autogen source</strong>: Create <code>src/autogen/MOD_NAME_lib_exec.cc</code> with virtual method implementations</li>
<li class=""><strong>Remove autogen header includes</strong>: Delete <code>#include &lt;[namespace]/MOD_NAME/autogen/MOD_NAME_lib_exec.h&gt;</code> from runtime source (replaced by .cc files)</li>
<li class=""><strong>Remove dispatcher methods</strong>: Delete all virtual method implementations from runtime source (Run, Del, etc.)</li>
<li class=""><strong>Update CMakeLists.txt</strong>: Add autogen source to <code>RUNTIME_SOURCES</code></li>
<li class=""><strong>Keep business logic</strong>: Retain the actual task processing methods (Create, Custom, etc.)</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="important-notes-1">Important Notes<a href="#important-notes-1" class="hash-link" aria-label="Direct link to Important Notes" title="Direct link to Important Notes" translate="no">​</a></h3>
<ul>
<li class=""><strong>Auto-generated files</strong>: These files should be generated by tools, not hand-written</li>
<li class=""><strong>Do not edit</strong>: Manual changes to autogen files will be lost when regenerated</li>
<li class=""><strong>Template consistency</strong>: All ChiMods should follow the same autogen template pattern</li>
<li class=""><strong>Build integration</strong>: Autogen source files must be included in CMake build</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-chimod-development">External ChiMod Development<a href="#external-chimod-development" class="hash-link" aria-label="Direct link to External ChiMod Development" title="Direct link to External ChiMod Development" translate="no">​</a></h2>
<p>When developing ChiMods in external repositories (outside the main Chimaera project), you need to link against the installed Chimaera libraries and use the CMake package discovery system.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h3>
<p>Before developing external ChiMods, ensure Chimaera is properly installed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Configure and build Chimaera</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cmake </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--preset</span><span class="token plain"> debug</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cmake </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--build</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Install Chimaera libraries and CMake configs  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cmake </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--install</span><span class="token plain"> build </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--prefix</span><span class="token plain"> /usr/local</span><br></span></code></pre></div></div>
<p>This installs:</p>
<ul>
<li class="">Core Chimaera library (<code>libcxx.so</code>)</li>
<li class="">ChiMod libraries (<code>libchimaera_admin_runtime.so</code>, <code>libchimaera_admin_client.so</code>, etc.)</li>
<li class="">CMake package configuration files for external discovery</li>
<li class="">Header files for development</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-chimod-repository-structure">External ChiMod Repository Structure<a href="#external-chimod-repository-structure" class="hash-link" aria-label="Direct link to External ChiMod Repository Structure" title="Direct link to External ChiMod Repository Structure" translate="no">​</a></h3>
<p>Your external ChiMod repository should follow this structure:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">my_external_chimod/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── chimaera_repo.yaml          # Repository namespace configuration</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── CMakeLists.txt              # Root CMake configuration</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">├── modules/                    # ChiMod modules directory (name is flexible)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   └── my_module/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       ├── chimaera_mod.yaml   # Module configuration</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       ├── CMakeLists.txt      # Module build configuration  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       ├── include/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       │   └── [namespace]/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       │       └── my_module/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       │           ├── my_module_client.h</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       │           ├── my_module_runtime.h</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       │           ├── my_module_tasks.h</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       │           └── autogen/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       │               └── my_module_methods.h</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│       └── src/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│           ├── my_module_client.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│           ├── my_module_runtime.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│           └── autogen/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│               └── my_module_lib_exec.cc</span><br></span></code></pre></div></div>
<p><strong>Note</strong>: The directory name for modules (shown here as <code>modules/</code>) is flexible. You can use <code>chimods/</code>, <code>components/</code>, <code>plugins/</code>, or any other name that fits your project structure. The directory name doesn&#x27;t need to match the namespace.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="repository-configuration-chimaera_repoyaml">Repository Configuration (chimaera_repo.yaml)<a href="#repository-configuration-chimaera_repoyaml" class="hash-link" aria-label="Direct link to Repository Configuration (chimaera_repo.yaml)" title="Direct link to Repository Configuration (chimaera_repo.yaml)" translate="no">​</a></h3>
<p>Create a <code>chimaera_repo.yaml</code> file in your repository root to define the namespace:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Repository-level configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> myproject      </span><span class="token comment" style="color:rgb(106, 153, 85)"># Your custom namespace (replaces &quot;chimaera&quot;)</span><br></span></code></pre></div></div>
<p>This namespace will be used for:</p>
<ul>
<li class="">CMake target names: <code>myproject_my_module_runtime</code>, <code>myproject_my_module_client</code></li>
<li class="">Library file names: <code>libmyproject_my_module_runtime.so</code>, <code>libmyproject_my_module_client.so</code></li>
<li class="">C++ namespaces: <code>myproject::my_module</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="root-cmakeliststxt">Root CMakeLists.txt<a href="#root-cmakeliststxt" class="hash-link" aria-label="Direct link to Root CMakeLists.txt" title="Direct link to Root CMakeLists.txt" translate="no">​</a></h3>
<p>Your repository&#x27;s root <code>CMakeLists.txt</code> must find and link to the installed Chimaera packages:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">cmake_minimum_required(VERSION 3.20)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">project(my_external_chimod)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">set(CMAKE_CXX_STANDARD 17)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">set(CMAKE_CXX_STANDARD_REQUIRED ON)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Find required Chimaera packages</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># These packages are installed by &#x27;cmake --install build --prefix /usr/local&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">find_package(chimaera REQUIRED)              # Core Chimaera (automatically includes ChimaeraCommon.cmake)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">find_package(chimaera_admin REQUIRED)        # Admin ChiMod (often required)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Set CMAKE_PREFIX_PATH if Chimaera is installed in a custom location</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># set(CMAKE_PREFIX_PATH &quot;/path/to/[namespace]/install&quot; ${CMAKE_PREFIX_PATH})</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># ChimaeraCommon.cmake utilities are automatically included by find_package(chimaera)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># This provides add_chimod_client(), add_chimod_runtime(), and other build functions</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Add subdirectories containing your ChiMods</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_subdirectory(modules/my_module)  # Use your actual directory name</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chimod-cmakeliststxt">ChiMod CMakeLists.txt<a href="#chimod-cmakeliststxt" class="hash-link" aria-label="Direct link to ChiMod CMakeLists.txt" title="Direct link to ChiMod CMakeLists.txt" translate="no">​</a></h3>
<p>Each ChiMod&#x27;s <code>CMakeLists.txt</code> uses the standard Chimaera build utilities:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">cmake_minimum_required(VERSION 3.20)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Create both client and runtime libraries using standard Chimaera utilities</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># These functions are provided by ChimaeraCommon.cmake (automatically included via find_package(chimaera))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Creates targets: my_namespace_my_module_client, my_namespace_my_module_runtime</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Creates aliases: my_namespace::my_module_client, my_namespace::my_module_runtime</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_client(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  CHIMOD_NAME my_module</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES src/my_module_client.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">add_chimod_runtime(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  CHIMOD_NAME my_module</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  SOURCES</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    src/my_module_runtime.cc </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    src/autogen/my_module_lib_exec.cc</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Installation is automatic - no separate install_chimod() call required</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Package name: my_namespace_my_module (for find_package)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Optional: Add additional dependencies if your ChiMod needs external libraries</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># get_property(RUNTIME_TARGET GLOBAL PROPERTY my_module_RUNTIME_TARGET)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># get_property(CLIENT_TARGET GLOBAL PROPERTY my_module_CLIENT_TARGET)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># target_link_libraries(${RUNTIME_TARGET} PRIVATE some_external_lib)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># target_link_libraries(${CLIENT_TARGET} PRIVATE some_external_lib)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-applications-using-your-chimod">External Applications Using Your ChiMod<a href="#external-applications-using-your-chimod" class="hash-link" aria-label="Direct link to External Applications Using Your ChiMod" title="Direct link to External Applications Using Your ChiMod" translate="no">​</a></h3>
<p>Once installed, external applications can find and link to your ChiMod. Based on our external unit test patterns (see test/unit/external-chimod/CMakeLists.txt):</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># External application CMakeLists.txt</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">find_package(my_namespace_my_module REQUIRED)  # Your ChiMod package</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">find_package(chimaera REQUIRED)                # Core Chimaera (automatically includes utilities)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">find_package(chimaera_admin REQUIRED)          # Admin ChiMod (often required)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Simple linking pattern - ChiMod libraries include all dependencies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">target_link_libraries(my_external_app</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  my_namespace::my_module_client    # Your ChiMod client</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chimaera::admin_client            # Admin client (if needed)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  ${CMAKE_THREAD_LIBS_INIT}         # Threading support</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># Core Chimaera library is automatically included by ChiMod dependencies</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-chimod-implementation">External ChiMod Implementation<a href="#external-chimod-implementation" class="hash-link" aria-label="Direct link to External ChiMod Implementation" title="Direct link to External ChiMod Implementation" translate="no">​</a></h3>
<p>Your external ChiMod implementation follows the same patterns as internal ChiMods:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="createparams-configuration">CreateParams Configuration<a href="#createparams-configuration" class="hash-link" aria-label="Direct link to CreateParams Configuration" title="Direct link to CreateParams Configuration" translate="no">​</a></h4>
<p>In your <code>my_module_tasks.h</code>, the <code>CreateParams</code> must reference your custom namespace:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Your module-specific parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string config_data_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">u32 worker_count_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// CRITICAL: Library name must match your namespace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> chimod_lib_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;myproject_my_module&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Constructors and serialization...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="c-namespace">C++ Namespace<a href="#c-namespace" class="hash-link" aria-label="Direct link to C++ Namespace" title="Direct link to C++ Namespace" translate="no">​</a></h4>
<p>Use your custom namespace throughout your implementation:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// In all header and source files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> myproject</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">my_module </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Your ChiMod implementation...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Implementation...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Client</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">ContainerClient</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Implementation...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace myproject::my_module</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-external-chimods">Building External ChiMods<a href="#building-external-chimods" class="hash-link" aria-label="Direct link to Building External ChiMods" title="Direct link to Building External ChiMods" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># Configure your external ChiMod project</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">mkdir</span><span class="token plain"> build </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">cmake </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Build your ChiMods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Optional: Install your ChiMods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">make</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">install</span><br></span></code></pre></div></div>
<p>The build system will automatically:</p>
<ul>
<li class="">Link all necessary core Chimaera dependencies</li>
<li class="">Link against <code>chimaera::admin_client</code> and <code>chimaera::admin_runtime</code> (for non-admin modules)</li>
<li class="">Generate libraries with your custom namespace: <code>libmyproject_my_module_runtime.so</code></li>
<li class="">Configure proper include paths and dependencies</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usage-in-applications">Usage in Applications<a href="#usage-in-applications" class="hash-link" aria-label="Direct link to Usage in Applications" title="Direct link to Usage in Applications" translate="no">​</a></h3>
<p>Applications using your external ChiMod would reference it as:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/my_module/my_module_client.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/admin/admin_client.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Initialize Chimaera client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CHIMAERA_CLIENT_INIT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Create your ChiMod client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId pool_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">PoolId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  myproject</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">my_module</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Client </span><span class="token function" style="color:rgb(220, 220, 170)">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Use your ChiMod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> pool_query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Local</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chimaera_runtime_init-for-testing-and-benchmarks">CHIMAERA_RUNTIME_INIT for Testing and Benchmarks<a href="#chimaera_runtime_init-for-testing-and-benchmarks" class="hash-link" aria-label="Direct link to CHIMAERA_RUNTIME_INIT for Testing and Benchmarks" title="Direct link to CHIMAERA_RUNTIME_INIT for Testing and Benchmarks" translate="no">​</a></h3>
<p>For simple unit tests and benchmarks, Chimaera provides <code>CHIMAERA_RUNTIME_INIT()</code> as a convenience function that initializes both the client and runtime in a single process. This is an alternative to using <code>CHIMAERA_CLIENT_INIT()</code> when you need both components initialized together.</p>
<p><strong>Important Notes:</strong></p>
<ul>
<li class=""><strong>Primary Use Case</strong>: Unit tests and benchmarks only</li>
<li class=""><strong>Not for Production</strong>: Should NOT be used in main production applications</li>
<li class=""><strong>Single Process</strong>: Initializes both client and runtime in the same process</li>
<li class=""><strong>Simplified Testing</strong>: Eliminates need for separate runtime and client processes during testing</li>
</ul>
<p><strong>Usage Example (Unit Tests/Benchmarks):</strong></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;chimaera/chimaera.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;[namespace]/my_module/my_module_client.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">TEST</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">MyModuleTest</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> BasicOperation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Initialize both client and runtime in single process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CHIMAERA_RUNTIME_INIT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Create your ChiMod client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId pool_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">PoolId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  myproject</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">my_module</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Client </span><span class="token function" style="color:rgb(220, 220, 170)">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Test your ChiMod functionality</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> pool_query </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">PoolQuery</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Local</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">HSHM_MCTX</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;test_pool&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Assertions and test logic...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<p><strong>When to Use Each:</strong></p>
<ul>
<li class=""><strong>CHIMAERA_CLIENT_INIT()</strong>: Production applications connecting to existing runtime</li>
<li class=""><strong>CHIMAERA_RUNTIME_INIT()</strong>: Unit tests, benchmarks, and simple testing scenarios</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dependencies-and-installation-paths">Dependencies and Installation Paths<a href="#dependencies-and-installation-paths" class="hash-link" aria-label="Direct link to Dependencies and Installation Paths" title="Direct link to Dependencies and Installation Paths" translate="no">​</a></h3>
<p>External ChiMod development requires these components to be installed:</p>
<ol>
<li class=""><strong>Core Package</strong>: <code>chimaera</code> (includes main library and ChimaeraCommon.cmake utilities)</li>
<li class=""><strong>Admin ChiMod</strong>: <code>chimaera::admin_client</code> and <code>chimaera::admin_runtime</code> (required for most modules)</li>
<li class=""><strong>CMake Configs</strong>: Package discovery files (automatically installed with packages)</li>
<li class=""><strong>Headers</strong>: All Chimaera framework headers (installed with packages)</li>
</ol>
<p>All build utilities (<code>add_chimod_client()</code>, <code>add_chimod_runtime()</code>) are automatically available via <code>find_package(chimaera)</code>.</p>
<p>If Chimaera is installed in a custom location, set <code>CMAKE_PREFIX_PATH</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token builtin class-name" style="color:rgb(78, 201, 176)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CMAKE_PREFIX_PATH</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;/path/to/[namespace]/install:</span><span class="token string variable" style="color:rgb(156, 220, 254)">$CMAKE_PREFIX_PATH</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-external-development-issues">Common External Development Issues<a href="#common-external-development-issues" class="hash-link" aria-label="Direct link to Common External Development Issues" title="Direct link to Common External Development Issues" translate="no">​</a></h3>
<p><strong>ChimaeraCommon.cmake Not Found:</strong></p>
<ul>
<li class="">Ensure Chimaera was installed with <code>cmake --install build --prefix &lt;path&gt;</code></li>
<li class="">Verify <code>CMAKE_PREFIX_PATH</code> includes the Chimaera installation directory</li>
<li class="">Check that <code>find_package(chimaera REQUIRED)</code> succeeded (ChimaeraCommon.cmake is included automatically)</li>
</ul>
<p><strong>Library Name Mismatch:</strong></p>
<ul>
<li class="">Ensure <code>CreateParams::chimod_lib_name</code> exactly matches your namespace and module name</li>
<li class="">For namespace &quot;myproject&quot; and module &quot;my_module&quot;: <code>chimod_lib_name = &quot;myproject_my_module&quot;</code></li>
<li class="">The system automatically appends &quot;_runtime&quot; to find the runtime library</li>
<li class="">Target names use format: <code>myproject_my_module_runtime</code> and <code>myproject_my_module_client</code></li>
</ul>
<p><strong>Missing Dependencies:</strong></p>
<ul>
<li class="">The ChiMod build functions automatically link admin and rt library dependencies</li>
<li class="">Ensure all external dependencies (Boost, MPI, etc.) are available in your build environment</li>
<li class="">Use the same dependency versions that Chimaera was built with</li>
<li class="">For runtime code, rt library is automatically included for async I/O support</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-chimod-checklist">External ChiMod Checklist<a href="#external-chimod-checklist" class="hash-link" aria-label="Direct link to External ChiMod Checklist" title="Direct link to External ChiMod Checklist" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Repository Configuration</strong>: <code>chimaera_repo.yaml</code> with custom namespace</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>CMake Setup</strong>: Root CMakeLists.txt finds <code>chimaera</code> package</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>ChiMod Configuration</strong>: <code>chimaera_mod.yaml</code> with method definitions</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Library Name</strong>: <code>CreateParams::chimod_lib_name</code> matches namespace pattern</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>C++ Namespace</strong>: All code uses custom namespace consistently</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Build Integration</strong>: ChiMod CMakeLists.txt uses <code>add_chimod_client()</code> and <code>add_chimod_runtime()</code> (installation is automatic)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Dependencies</strong>: All required external libraries available at build time</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Automatic Linking</strong>: Rely on ChiMod build functions for rt and admin dependencies</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-module">Example Module<a href="#example-module" class="hash-link" aria-label="Direct link to Example Module" title="Direct link to Example Module" translate="no">​</a></h2>
<p>See the <code>chimods/MOD_NAME</code> directory for a complete working example that demonstrates:</p>
<ul>
<li class="">Task definition with proper constructors</li>
<li class="">Client API with sync/async methods</li>
<li class="">Runtime container with execution logic</li>
<li class="">Build system integration</li>
<li class="">YAML configuration</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="creating-a-new-module">Creating a New Module<a href="#creating-a-new-module" class="hash-link" aria-label="Direct link to Creating a New Module" title="Direct link to Creating a New Module" translate="no">​</a></h3>
<ol>
<li class="">Copy the MOD_NAME template directory</li>
<li class="">Rename all MOD_NAME occurrences to your module name</li>
<li class="">Update the chimaera_mod.yaml configuration</li>
<li class="">Define your tasks in the _tasks.h file</li>
<li class="">Implement client API in _client.h/cc</li>
<li class="">Implement runtime logic in _runtime.h/cc</li>
<li class="">Add <code>CHI_TASK_CC(YourContainerClass)</code> at the end of runtime source</li>
<li class="">Add to the build system</li>
<li class="">Test with client and runtime</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="recent-changes-and-best-practices">Recent Changes and Best Practices<a href="#recent-changes-and-best-practices" class="hash-link" aria-label="Direct link to Recent Changes and Best Practices" title="Direct link to Recent Changes and Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="container-initialization-pattern">Container Initialization Pattern<a href="#container-initialization-pattern" class="hash-link" aria-label="Direct link to Container Initialization Pattern" title="Direct link to Container Initialization Pattern" translate="no">​</a></h3>
<p>Starting with the latest version, container initialization has been simplified:</p>
<ol>
<li class=""><strong>No Separate Init Method</strong>: The <code>Init</code> method has been merged with <code>Create</code></li>
<li class=""><strong>Create Does Everything</strong>: The <code>Create</code> method now handles both container creation and initialization</li>
<li class=""><strong>Access to Task Data</strong>: Since <code>Create</code> receives the CreateTask, you have access to pool_id and pool_query from the task</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="framework-managed-task-cleanup">Framework-Managed Task Cleanup<a href="#framework-managed-task-cleanup" class="hash-link" aria-label="Direct link to Framework-Managed Task Cleanup" title="Direct link to Framework-Managed Task Cleanup" translate="no">​</a></h3>
<p>Task cleanup is handled by the framework using the IPC manager:</p>
<ol>
<li class=""><strong>No Custom Del Methods Required</strong>: Individual <code>DelTaskType</code> methods are no longer needed</li>
<li class=""><strong>IPC Manager Handles Cleanup</strong>: The framework automatically calls <code>ipc_manager-&gt;DelTask()</code> to deallocate tasks from shared memory</li>
<li class=""><strong>Memory Segment Deallocation</strong>: Tasks are properly removed from their respective memory segments (typically <code>kMainSegment</code>)</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="simplified-chimod-entry-points">Simplified ChiMod Entry Points<a href="#simplified-chimod-entry-points" class="hash-link" aria-label="Direct link to Simplified ChiMod Entry Points" title="Direct link to Simplified ChiMod Entry Points" translate="no">​</a></h3>
<p>ChiMod entry points are now hidden behind the <code>CHI_TASK_CC</code> macro:</p>
<ol>
<li class=""><strong>Single Macro Call</strong>: Replace complex extern &quot;C&quot; blocks with one macro</li>
<li class=""><strong>Automatic Container Integration</strong>: Works seamlessly with <code>chi::Container</code> base class</li>
<li class=""><strong>Cleaner Module Code</strong>: Eliminates boilerplate entry point code</li>
</ol>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Old approach (complex extern &quot;C&quot; block)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">extern</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;C&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ChiContainer</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">alloc_chimod</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* ... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">ChiContainer</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">new_chimod</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">/*...*/</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* ... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">get_chimod_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* ... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">destroy_chimod</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">/*...*/</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* ... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> is_chimaera_chimod_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// New approach (simple macro)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">CHI_TASK_CC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MOD_NAME</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Container is already initialized via Init() before Create is called</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Do NOT call Init() here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Container-specific initialization logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// All tasks will be routed through the external queue lanes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// which are automatically mapped to workers at runtime startup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Container is now ready for operation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fullptr-parameter-pattern">FullPtr Parameter Pattern<a href="#fullptr-parameter-pattern" class="hash-link" aria-label="Direct link to FullPtr Parameter Pattern" title="Direct link to FullPtr Parameter Pattern" translate="no">​</a></h3>
<p>All runtime methods now use <code>hipc::FullPtr&lt;TaskType&gt;</code> instead of raw pointers:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Old pattern (deprecated)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Custom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">CustomTask</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// New pattern (current)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Custom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CustomTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<p><strong>Benefits of FullPtr:</strong></p>
<ul>
<li class=""><strong>Shared Memory Safety</strong>: Provides safe access across process boundaries</li>
<li class=""><strong>Automatic Dereferencing</strong>: Use <code>task-&gt;field</code> just like raw pointers</li>
<li class=""><strong>Memory Management</strong>: Framework handles allocation/deallocation</li>
<li class=""><strong>Null Checking</strong>: Use <code>task.IsNull()</code> to check validity</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="migration-guide-1">Migration Guide<a href="#migration-guide-1" class="hash-link" aria-label="Direct link to Migration Guide" title="Direct link to Migration Guide" translate="no">​</a></h3>
<p>When updating existing modules:</p>
<ol>
<li class=""><strong>Remove Init Override</strong>: Delete custom <code>Init</code> method implementations</li>
<li class=""><strong>Update Create Method</strong>: Move initialization logic from <code>Init</code> to <code>Create</code></li>
<li class=""><strong>Change Method Signatures</strong>: Replace <code>TaskType*</code> with <code>hipc::FullPtr&lt;TaskType&gt;</code></li>
<li class=""><strong>Update Monitor Methods</strong>: Ensure all monitoring methods use FullPtr</li>
<li class=""><strong>Implement kLocalSchedule</strong>: Every Monitor method MUST implement <code>kLocalSchedule</code> mode</li>
<li class=""><strong>Remove Del Methods</strong>: Delete all <code>DelTaskType</code> methods - framework calls <code>ipc_manager-&gt;DelTask()</code> automatically</li>
<li class=""><strong>Update Autogen Files</strong>: Ensure Del dispatcher calls <code>ipc_manager-&gt;DelTask()</code> instead of custom Del methods</li>
<li class=""><strong>Replace Entry Points</strong>: Replace extern &quot;C&quot; blocks with <code>CHI_TASK_CC(ClassName)</code> macro</li>
<li class=""><strong>Remove Completion Calls</strong>: Framework handles task completion automatically</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-namespace-configuration">Custom Namespace Configuration<a href="#custom-namespace-configuration" class="hash-link" aria-label="Direct link to Custom Namespace Configuration" title="Direct link to Custom Namespace Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview-5">Overview<a href="#overview-5" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h3>
<p>While the default namespace is <code>chimaera</code>, you can customize the namespace for your ChiMod modules. This is useful for:</p>
<ul>
<li class=""><strong>Project Branding</strong>: Use your own project or company namespace</li>
<li class=""><strong>Avoiding Conflicts</strong>: Prevent naming conflicts with other ChiMod collections</li>
<li class=""><strong>Module Organization</strong>: Group related modules under a custom namespace</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuring-custom-namespace">Configuring Custom Namespace<a href="#configuring-custom-namespace" class="hash-link" aria-label="Direct link to Configuring Custom Namespace" title="Direct link to Configuring Custom Namespace" translate="no">​</a></h3>
<p>The namespace is controlled by the <code>chimaera_repo.yaml</code> file in your project root:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> your_custom_namespace</span><br></span></code></pre></div></div>
<p>For example:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> mycompany</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="required-changes-for-custom-namespace">Required Changes for Custom Namespace<a href="#required-changes-for-custom-namespace" class="hash-link" aria-label="Direct link to Required Changes for Custom Namespace" title="Direct link to Required Changes for Custom Namespace" translate="no">​</a></h3>
<p>When using a custom namespace, you must update several components:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-createparams-chimod_lib_name">1. <strong>CreateParams chimod_lib_name</strong><a href="#1-createparams-chimod_lib_name" class="hash-link" aria-label="Direct link to 1-createparams-chimod_lib_name" title="Direct link to 1-createparams-chimod_lib_name" translate="no">​</a></h4>
<p>The most critical change is updating the <code>chimod_lib_name</code> in your CreateParams:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Default chimaera namespace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> chimod_lib_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;chimaera_your_module&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Custom namespace example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> chimod_lib_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;mycompany_your_module&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-module-namespace-declaration">2. <strong>Module Namespace Declaration</strong><a href="#2-module-namespace-declaration" class="hash-link" aria-label="Direct link to 2-module-namespace-declaration" title="Direct link to 2-module-namespace-declaration" translate="no">​</a></h4>
<p>Update your module&#x27;s C++ namespace:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">your_module </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// module code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Custom</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> mycompany</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">your_module </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// module code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-cmake-library-names">3. <strong>CMake Library Names</strong><a href="#3-cmake-library-names" class="hash-link" aria-label="Direct link to 3-cmake-library-names" title="Direct link to 3-cmake-library-names" translate="no">​</a></h4>
<p>The CMake system automatically uses your custom namespace. Libraries will be named:</p>
<ul>
<li class="">Default: <code>libchimaera_module_runtime.so</code>, <code>libchimaera_module_client.so</code></li>
<li class="">Custom: <code>libmycompany_module_runtime.so</code>, <code>libmycompany_module_client.so</code></li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-runtime-integration">4. <strong>Runtime Integration</strong><a href="#4-runtime-integration" class="hash-link" aria-label="Direct link to 4-runtime-integration" title="Direct link to 4-runtime-integration" translate="no">​</a></h4>
<p>If your runtime code references the admin module or other system modules, update the references:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Default admin module reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> admin_chimod </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> module_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">GetChiMod</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;chimaera_admin&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Custom namespace admin module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> admin_chimod </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> module_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">GetChiMod</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;mycompany_admin&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="checklist-for-custom-namespace">Checklist for Custom Namespace<a href="#checklist-for-custom-namespace" class="hash-link" aria-label="Direct link to Checklist for Custom Namespace" title="Direct link to Checklist for Custom Namespace" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Update chimaera_repo.yaml</strong> with your custom namespace</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Update CreateParams::chimod_lib_name</strong> to use custom namespace prefix</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Update C++ namespace declarations</strong> in all module files</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Update runtime references</strong> to admin module and other system modules</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Update any hardcoded module names</strong> in configuration or startup code</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Rebuild all modules</strong> after namespace changes</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Update library search paths</strong> if needed for deployment</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-complete-custom-namespace-module">Example: Complete Custom Namespace Module<a href="#example-complete-custom-namespace-module" class="hash-link" aria-label="Direct link to Example: Complete Custom Namespace Module" title="Direct link to Example: Complete Custom Namespace Module" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># chimaera_repo.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> mycompany</span><br></span></code></pre></div></div>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// mymodule_tasks.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> mycompany</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">mymodule </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">CreateParams</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> chimod_lib_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;mycompany_mymodule&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... other parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateTask </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">admin</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">BaseCreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Method</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kCreate</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace mycompany::mymodule</span><br></span></code></pre></div></div>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// mymodule_runtime.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">namespace</span><span class="token plain"> mycompany</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">mymodule </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Runtime</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">Container</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">using</span><span class="token plain"> CreateParams </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> mycompany</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">mymodule</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">CreateParams</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Required for CHI_TASK_CC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... rest of class</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace mycompany::mymodule</span><br></span></code></pre></div></div>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// mymodule_runtime.cc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">CHI_TASK_CC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mycompany</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">mymodule</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="important-notes-2">Important Notes<a href="#important-notes-2" class="hash-link" aria-label="Direct link to Important Notes" title="Direct link to Important Notes" translate="no">​</a></h3>
<ul>
<li class=""><strong>Library Name Consistency</strong>: The <code>chimod_lib_name</code> must exactly match what the CMake system generates</li>
<li class=""><strong>Admin Module</strong>: If you customize the namespace, you may also want to rebuild the admin module with your custom namespace</li>
<li class=""><strong>Backward Compatibility</strong>: Changing namespace breaks compatibility with existing deployments using default namespace</li>
<li class=""><strong>Documentation</strong>: Update any module-specific documentation to reflect the new namespace</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-topics">Advanced Topics<a href="#advanced-topics" class="hash-link" aria-label="Direct link to Advanced Topics" title="Direct link to Advanced Topics" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-scheduling">Task Scheduling<a href="#task-scheduling" class="hash-link" aria-label="Direct link to Task Scheduling" title="Direct link to Task Scheduling" translate="no">​</a></h3>
<p>Tasks can be scheduled with different priorities:</p>
<ul>
<li class=""><code>kLowLatency</code>: For time-critical operations</li>
<li class=""><code>kHighLatency</code>: For batch processing</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="automatic-routing-architecture">Automatic Routing Architecture<a href="#automatic-routing-architecture" class="hash-link" aria-label="Direct link to Automatic Routing Architecture" title="Direct link to Automatic Routing Architecture" translate="no">​</a></h3>
<p>The framework handles all task routing automatically:</p>
<ol>
<li class="">
<p><strong>Client-Side Enqueuing</strong>:</p>
<ul>
<li class="">Tasks are enqueued via <code>IpcManager::Enqueue()</code> from client code</li>
<li class="">Lane selection uses PID+TID hash for automatic distribution across lanes</li>
<li class="">Formula: <code>lane_id = hash(PID, TID) % num_lanes</code></li>
</ul>
</li>
<li class="">
<p><strong>Worker-Lane Mapping</strong> (1:1 Direct Mapping):</p>
<ul>
<li class="">Number of lanes automatically equals number of sched workers (default: 8)</li>
<li class="">Each worker assigned exactly one lane: worker i → lane i</li>
<li class="">No round-robin needed - perfect 1:1 correspondence</li>
<li class="">Lane headers track assigned worker ID</li>
</ul>
</li>
<li class="">
<p><strong>No Configuration Required</strong>:</p>
<ul>
<li class="">Lane count automatically matches sched worker count from config</li>
<li class="">No separate <code>task_queue_lanes</code> configuration needed</li>
<li class="">Change worker count → lane count adjusts automatically</li>
</ul>
</li>
</ol>
<p><strong>Example</strong>: With 8 sched workers (default):</p>
<ul>
<li class="">8 lanes created automatically in external queue</li>
<li class="">Worker 0 → Lane 0, Worker 1 → Lane 1, ..., Worker 7 → Lane 7</li>
<li class="">Client tasks distributed via hash to lanes 0-7</li>
<li class="">Each worker processes tasks from its dedicated lane</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-handling">Error Handling<a href="#error-handling" class="hash-link" aria-label="Direct link to Error Handling" title="Direct link to Error Handling" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Custom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CustomTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">RunContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Operation logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_code_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">exception</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">result_code_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">data_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">main_allocator_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">what</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Framework handles task completion automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="debugging-tips">Debugging Tips<a href="#debugging-tips" class="hash-link" aria-label="Direct link to Debugging Tips" title="Direct link to Debugging Tips" translate="no">​</a></h2>
<ol>
<li class=""><strong>Check Shared Memory</strong>: Use <code>ipcs -m</code> to view segments</li>
<li class=""><strong>Verify Task State</strong>: Check task completion status</li>
<li class=""><strong>Monitor Queue Depth</strong>: Use GetProcessQueue() to inspect queues</li>
<li class=""><strong>Enable Debug Logging</strong>: Set CHI_DEBUG environment variable</li>
<li class=""><strong>Use GDB</strong>: Attach to runtime process for debugging</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-issues-and-solutions">Common Issues and Solutions<a href="#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions" translate="no">​</a></h3>
<p><strong>Tasks Not Being Executed:</strong></p>
<ul>
<li class=""><strong>Cause</strong>: Tasks not being routed to worker queues</li>
<li class=""><strong>Solution</strong>: Verify task pool_query is set correctly and pool exists</li>
<li class=""><strong>Debug</strong>: Add logging in task execution methods to verify they&#x27;re being called</li>
</ul>
<p><strong>Queue Overflow or Deadlocks:</strong></p>
<ul>
<li class=""><strong>Cause</strong>: Tasks being enqueued but not dequeued from lanes</li>
<li class=""><strong>Solution</strong>: Verify lane creation in Create() method and proper task routing</li>
<li class=""><strong>Debug</strong>: Check lane sizes with <code>lane-&gt;Size()</code> and <code>lane-&gt;IsEmpty()</code></li>
</ul>
<p><strong>Memory Leaks in Shared Memory:</strong></p>
<ul>
<li class=""><strong>Cause</strong>: Tasks not being properly cleaned up</li>
<li class=""><strong>Solution</strong>: Ensure framework Del dispatcher is working correctly</li>
<li class=""><strong>Debug</strong>: Monitor shared memory usage with <code>ipcs -m</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-considerations-2">Performance Considerations<a href="#performance-considerations-2" class="hash-link" aria-label="Direct link to Performance Considerations" title="Direct link to Performance Considerations" translate="no">​</a></h2>
<ol>
<li class=""><strong>Minimize Allocations</strong>: Reuse buffers when possible</li>
<li class=""><strong>Batch Operations</strong>: Submit multiple tasks together</li>
<li class=""><strong>Use Appropriate Segments</strong>: Put large data in client_data_segment</li>
<li class=""><strong>Avoid Blocking</strong>: Use async operations when possible</li>
<li class=""><strong>Profile First</strong>: Measure before optimizing</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="unit-testing">Unit Testing<a href="#unit-testing" class="hash-link" aria-label="Direct link to Unit Testing" title="Direct link to Unit Testing" translate="no">​</a></h2>
<p>Unit testing for ChiMods is covered in the separate <a class="" href="/docs/sdk/module_test_guide.md">Module Test Guide</a>. This guide provides comprehensive information on:</p>
<ul>
<li class="">Test environment setup and configuration</li>
<li class="">Environment variables and module discovery</li>
<li class="">Test framework integration patterns</li>
<li class="">Complete test examples with fixtures</li>
<li class="">CMake integration and build setup</li>
<li class="">Best practices for ChiMod testing</li>
</ul>
<p>The test guide demonstrates how to test both runtime and client components in the same process, enabling comprehensive integration testing without complex multi-process coordination.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-reference-checklist">Quick Reference Checklist<a href="#quick-reference-checklist" class="hash-link" aria-label="Direct link to Quick Reference Checklist" title="Direct link to Quick Reference Checklist" translate="no">​</a></h2>
<p>When creating a new Chimaera module, ensure you have:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-definition-checklist-_tasksh">Task Definition Checklist (<code>_tasks.h</code>)<a href="#task-definition-checklist-_tasksh" class="hash-link" aria-label="Direct link to task-definition-checklist-_tasksh" title="Direct link to task-definition-checklist-_tasksh" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Tasks inherit from <code>chi::Task</code> or use GetOrCreatePoolTask template (recommended for non-admin modules)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Use GetOrCreatePoolTask</strong>: For non-admin modules instead of BaseCreateTask directly</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Use BaseCreateTask with IS_ADMIN=true</strong>: Only for admin module</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->SHM constructor with CtxAllocator parameter (if custom task)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Emplace constructor with all required parameters (if custom task)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Uses HSHM serializable types (chi::string, chi::vector, etc.)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Method constant assigned in constructor (e.g., <code>method_ = Method::kCreate;</code>)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>No static casting</strong>: Use Method namespace constants directly</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Include auto-generated methods file for Method constants</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-container-checklist-_runtimehcc">Runtime Container Checklist (<code>_runtime.h/cc</code>)<a href="#runtime-container-checklist-_runtimehcc" class="hash-link" aria-label="Direct link to runtime-container-checklist-_runtimehcc" title="Direct link to runtime-container-checklist-_runtimehcc" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Inherits from <code>chi::Container</code></li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Init() method overridden</strong> - calls base class Init() then initializes client for this ChiMod</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Create() method does NOT call <code>chi::Container::Init()</code> (container is already initialized before Create is called)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->All task methods use <code>hipc::FullPtr&lt;TaskType&gt;</code> parameters</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>NO custom Del methods needed</strong> - framework calls <code>ipc_manager-&gt;DelTask()</code> automatically</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Uses <code>CHI_TASK_CC(ClassName)</code> macro for entry points</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Routing is automatic</strong> - tasks are routed through external queue lanes mapped to workers (1:1 worker-to-lane mapping)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="client-api-checklist-_clienthcc">Client API Checklist (<code>_client.h/cc</code>)<a href="#client-api-checklist-_clienthcc" class="hash-link" aria-label="Direct link to client-api-checklist-_clienthcc" title="Direct link to client-api-checklist-_clienthcc" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Inherits from <code>chi::ContainerClient</code></li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Uses <code>CHI_IPC-&gt;NewTask&lt;TaskType&gt;()</code> for allocation</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Uses <code>CHI_IPC-&gt;Enqueue()</code> for task submission</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Uses <code>CHI_IPC-&gt;DelTask()</code> for cleanup</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Provides both sync and async methods</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>CRITICAL</strong>: Create methods update <code>pool_id_ = task-&gt;new_pool_id_</code> after task completion</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="build-system-checklist">Build System Checklist<a href="#build-system-checklist" class="hash-link" aria-label="Direct link to Build System Checklist" title="Direct link to Build System Checklist" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->CMakeLists.txt creates both client and runtime libraries</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->chimaera_mod.yaml defines module metadata</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Auto-generated methods file</strong>: <code>autogen/MOD_NAME_methods.h</code> with Method namespace</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>Include chimaera.h</strong>: In methods file for GLOBAL_CONST macro</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <strong>GLOBAL_CONST constants</strong>: Use namespace constants, not enum class</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Proper install targets configured</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Links against chimaera library</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-pitfalls-to-avoid">Common Pitfalls to Avoid<a href="#common-pitfalls-to-avoid" class="hash-link" aria-label="Direct link to Common Pitfalls to Avoid" title="Direct link to Common Pitfalls to Avoid" translate="no">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ <strong>CRITICAL: Not updating pool_id_ in Create methods</strong> (leads to incorrect pool ID for subsequent operations)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ Using raw pointers instead of FullPtr in runtime methods</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ <strong>Calling <code>chi::Container::Init()</code> in Create method</strong> (container is already initialized by framework before Create is called)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ <strong>Not overriding <code>Init()</code> method</strong> (required to initialize the client member)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ Using non-HSHM types in task data members</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ Implementing custom Del methods (framework calls <code>ipc_manager-&gt;DelTask()</code> automatically)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ Writing complex extern &quot;C&quot; blocks (use <code>CHI_TASK_CC</code> macro instead)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ <strong>Using static_cast with Method values</strong> (use Method::kName directly)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ Attempting to manually manage task routing (framework handles automatically)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ <strong>Missing chimaera.h include</strong> in methods file (GLOBAL_CONST won&#x27;t work)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ <strong>Using enum class for methods</strong> (use namespace with GLOBAL_CONST instead)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ <strong>Using BaseCreateTask directly for non-admin modules</strong> (use GetOrCreatePoolTask instead)</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->❌ <strong>Forgetting GetOrCreatePoolTask template</strong> for container creation (reduces boilerplate)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pool-name-requirements">Pool Name Requirements<a href="#pool-name-requirements" class="hash-link" aria-label="Direct link to Pool Name Requirements" title="Direct link to Pool Name Requirements" translate="no">​</a></h2>
<p><strong>CRITICAL</strong>: All ChiMod Create functions MUST require a user-provided <code>pool_name</code> parameter. Never auto-generate pool names using <code>pool_id_</code> during Create operations.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-pool-names-are-required">Why Pool Names Are Required<a href="#why-pool-names-are-required" class="hash-link" aria-label="Direct link to Why Pool Names Are Required" title="Direct link to Why Pool Names Are Required" translate="no">​</a></h3>
<ol>
<li class=""><strong>pool_id_ Not Available</strong>: <code>pool_id_</code> is not set until after Create completes</li>
<li class=""><strong>User Intent</strong>: Users should explicitly name their pools for better organization</li>
<li class=""><strong>Uniqueness</strong>: Users can ensure uniqueness better than auto-generation</li>
<li class=""><strong>Debugging</strong>: Named pools are easier to identify during debugging</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pool-naming-guidelines">Pool Naming Guidelines<a href="#pool-naming-guidelines" class="hash-link" aria-label="Direct link to Pool Naming Guidelines" title="Direct link to Pool Naming Guidelines" translate="no">​</a></h3>
<ul>
<li class=""><strong>Descriptive Names</strong>: Use names that identify purpose or content</li>
<li class=""><strong>File-based Devices</strong>: For BDev file devices, <code>pool_name</code> serves as the file path</li>
<li class=""><strong>RAM-based Devices</strong>: For BDev RAM devices, <code>pool_name</code> should be unique identifier</li>
<li class=""><strong>Unique Identifiers</strong>: Consider timestamp + PID combinations when needed</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="correct-pool-naming-usage">Correct Pool Naming Usage<a href="#correct-pool-naming-usage" class="hash-link" aria-label="Direct link to Correct Pool Naming Usage" title="Direct link to Correct Pool Naming Usage" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// BDev file-based device - pool_name is the file path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string file_path </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;/path/to/device.dat&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">bdev_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">bdev_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bdev_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                   chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">bdev</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">BdevType</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kFile</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// BDev RAM-based device - pool_name is unique identifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string pool_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_ram_device_&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">to_string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">ram_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7001</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">bdev_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ram_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                   chimaera</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">bdev</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">BdevType</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kRam</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> ram_size</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Other ChiMods - pool_name is descriptive identifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string pool_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;my_container_&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> user_identifier</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolId </span><span class="token function" style="color:rgb(220, 220, 170)">mod_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">7002</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mod_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> mod_pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="incorrect-pool-naming-usage">Incorrect Pool Naming Usage<a href="#incorrect-pool-naming-usage" class="hash-link" aria-label="Direct link to Incorrect Pool Naming Usage" title="Direct link to Incorrect Pool Naming Usage" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: Using pool_id_ before it&#x27;s set (will be 0 or garbage)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string bad_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;pool_&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">to_string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">ToU64</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: Using empty strings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// WRONG: Auto-generating inside Create function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Create functions should not auto-generate names</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string auto_name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;pool_&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">generate_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Wrong approach</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="client-interface-pattern">Client Interface Pattern<a href="#client-interface-pattern" class="hash-link" aria-label="Direct link to Client Interface Pattern" title="Direct link to Client Interface Pattern" translate="no">​</a></h3>
<p>All ChiMod clients should follow this interface pattern:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Client</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:rgb(86, 156, 214)">public</span><span class="token base-clause"> chi</span><span class="token base-clause double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token base-clause class-name" style="color:rgb(78, 201, 176)">ContainerClient</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">public</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Synchronous Create with required pool_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Create</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_name </span><span class="token comment" style="color:rgb(106, 153, 85)">/* user-provided name */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token function" style="color:rgb(220, 220, 170)">Wait</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pool_id_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> task</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token plain">new_pool_id_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Set AFTER Create completes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// ... cleanup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Asynchronous Create with required pool_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">FullPtr</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">CreateTask</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">AsyncCreate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> hipc</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">MemContext</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> mctx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolQuery</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_name </span><span class="token comment" style="color:rgb(106, 153, 85)">/* user-provided name */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Use pool_name directly, never generate internally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">auto</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ipc_manager</span><span class="token operator" style="color:rgb(212, 212, 212)">-&gt;</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">NewTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">CreateTask</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">CreateTaskId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kAdminPoolId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Always use admin pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        CreateParams</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">chimod_lib_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Never hardcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// User-provided name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        pool_id_    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Target pool ID (unset during Create)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> task</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="bdev-specific-requirements">BDev-Specific Requirements<a href="#bdev-specific-requirements" class="hash-link" aria-label="Direct link to BDev-Specific Requirements" title="Direct link to BDev-Specific Requirements" translate="no">​</a></h3>
<ul>
<li class=""><strong>Single Interface</strong>: Use only one <code>Create()</code> and <code>AsyncCreate()</code> method (no multiple overloads)</li>
<li class=""><strong>File Devices</strong>: <code>pool_name</code> parameter serves as the file path</li>
<li class=""><strong>RAM Devices</strong>: <code>pool_name</code> parameter serves as unique identifier</li>
<li class=""><strong>Method Signature</strong>: <code>Create(mctx, pool_query, pool_name, bdev_type, total_size=0, io_depth=32, alignment=4096)</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="compose-configuration-feature">Compose Configuration Feature<a href="#compose-configuration-feature" class="hash-link" aria-label="Direct link to Compose Configuration Feature" title="Direct link to Compose Configuration Feature" translate="no">​</a></h2>
<p>The compose feature allows automatic pool creation from YAML configuration files. This enables declarative infrastructure setup where all required pools can be defined in configuration and created during runtime initialization or via utility script.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="createparams-loadconfig-requirement">CreateParams LoadConfig Requirement<a href="#createparams-loadconfig-requirement" class="hash-link" aria-label="Direct link to CreateParams LoadConfig Requirement" title="Direct link to CreateParams LoadConfig Requirement" translate="no">​</a></h3>
<p><strong>CRITICAL</strong>: All ChiMod CreateParams structures MUST implement a <code>LoadConfig()</code> method to support compose feature.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">/**</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Load configuration from PoolConfig (for compose mode)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * Required for compose feature support</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> * @param pool_config Pool configuration from compose section</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">LoadConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Parse YAML config string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  YAML</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Node config </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">YAML</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Load</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">config_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Load module-specific parameters from YAML</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;parameter_name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    parameter_name_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;parameter_name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">as</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">Type</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Parse size strings (e.g., &quot;2GB&quot;, &quot;512MB&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;capacity&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string capacity_str </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;capacity&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">as</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">std</span><span class="token generic-function generic class-name double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">string</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    total_size_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> hshm</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">ConfigParse</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">ParseSize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">capacity_str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="compose-configuration-format">Compose Configuration Format<a href="#compose-configuration-format" class="hash-link" aria-label="Direct link to Compose Configuration Format" title="Direct link to Compose Configuration Format" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">compose</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">mod_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chimaera_bdev        </span><span class="token comment" style="color:rgb(106, 153, 85)"># ChiMod library name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ram</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">//test          </span><span class="token comment" style="color:rgb(106, 153, 85)"># Pool name (or file path for BDev)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> dynamic            </span><span class="token comment" style="color:rgb(106, 153, 85)"># Either &quot;dynamic&quot; or &quot;local&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">200.0</span><span class="token plain">                 </span><span class="token comment" style="color:rgb(106, 153, 85)"># Pool ID in &quot;major.minor&quot; format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">capacity</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> 2GB                  </span><span class="token comment" style="color:rgb(106, 153, 85)"># Module-specific parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">bdev_type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ram                 </span><span class="token comment" style="color:rgb(106, 153, 85)"># Additional parameters as needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">io_depth</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">alignment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">mod_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> chimaera_another_mod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">pool_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> my_pool</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">pool_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> local</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">pool_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">201.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">custom_param</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> value</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usage-modes">Usage Modes<a href="#usage-modes" class="hash-link" aria-label="Direct link to Usage Modes" title="Direct link to Usage Modes" translate="no">​</a></h3>
<p><strong>1. Automatic During Runtime Init:</strong>
Pools are automatically created when runtime initializes if compose section is present in configuration:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token builtin class-name" style="color:rgb(78, 201, 176)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">CHI_SERVER_CONF</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">/path/to/config_with_compose.yaml</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">chimaera_start_runtime</span><br></span></code></pre></div></div>
<p><strong>2. Manual via chimaera_compose Utility:</strong>
Create pools using compose configuration against running runtime:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">chimaera_compose /path/to/compose_config.yaml</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementation-checklist">Implementation Checklist<a href="#implementation-checklist" class="hash-link" aria-label="Direct link to Implementation Checklist" title="Direct link to Implementation Checklist" translate="no">​</a></h3>
<p>When adding compose support to a ChiMod:</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Add <code>LoadConfig(const chi::PoolConfig&amp; pool_config)</code> method to CreateParams</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Parse all module-specific parameters from YAML config</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Handle optional parameters with defaults</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Use <code>hshm::ConfigParse::ParseSize()</code> for size strings</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Include <code>&lt;yaml-cpp/yaml.h&gt;</code> and <code>&lt;chimaera/config_manager.h&gt;</code> in tasks header</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Test with compose configuration before release</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-admin-chimod-loadconfig">Example Admin ChiMod LoadConfig<a href="#example-admin-chimod-loadconfig" class="hash-link" aria-label="Direct link to Example Admin ChiMod LoadConfig" title="Direct link to Example Admin ChiMod LoadConfig" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">LoadConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Admin doesn&#x27;t have additional configuration fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// YAML config parsing would go here for modules with config fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">pool_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Suppress unused parameter warning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-bdev-chimod-loadconfig">Example BDev ChiMod LoadConfig<a href="#example-bdev-chimod-loadconfig" class="hash-link" aria-label="Direct link to Example BDev ChiMod LoadConfig" title="Direct link to Example BDev ChiMod LoadConfig" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">LoadConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> chi</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PoolConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;</span><span class="token plain"> pool_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  YAML</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">Node config </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">YAML</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">Load</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">pool_config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">config_</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Load BDev type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bdev_type&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string type_str </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;bdev_type&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">as</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">std</span><span class="token generic-function generic class-name double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">string</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">type_str </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;file&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      bdev_type_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> BdevType</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kFile</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">type_str </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;ram&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      bdev_type_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> BdevType</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">kRam</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Load capacity (parse size strings)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;capacity&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token plain">string capacity_str </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;capacity&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">as</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">std</span><span class="token generic-function generic class-name double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">string</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    total_size_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> hshm</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token class-name" style="color:rgb(78, 201, 176)">ConfigParse</span><span class="token double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token function" style="color:rgb(220, 220, 170)">ParseSize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">capacity_str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Load optional parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;io_depth&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    io_depth_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;io_depth&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">as</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">chi</span><span class="token generic-function generic class-name double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">u32</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;alignment&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    alignment_ </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;alignment&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token generic-function function" style="color:rgb(220, 220, 170)">as</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">chi</span><span class="token generic-function generic class-name double-colon punctuation" style="color:rgb(212, 212, 212)">::</span><span class="token generic-function generic class-name" style="color:rgb(78, 201, 176)">u32</span><span class="token generic-function generic class-name operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/iowarp/iowarp.github.io/tree/main/docs/sdk/2.runtime_modules.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/sdk/interprocess"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Hermes Shared Memory (CTE)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/sdk/context_transfer"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Context Transfer SDK</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#linking" class="table-of-contents__link toc-highlight">Linking</a></li><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of Contents</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a><ul><li><a href="#core-principles" class="table-of-contents__link toc-highlight">Core Principles</a></li><li><a href="#key-components" class="table-of-contents__link toc-highlight">Key Components</a></li></ul></li><li><a href="#coding-style" class="table-of-contents__link toc-highlight">Coding Style</a><ul><li><a href="#general-guidelines" class="table-of-contents__link toc-highlight">General Guidelines</a></li><li><a href="#code-formatting" class="table-of-contents__link toc-highlight">Code Formatting</a></li></ul></li><li><a href="#module-structure" class="table-of-contents__link toc-highlight">Module Structure</a><ul><li><a href="#task-definition-mod_name_tasksh" class="table-of-contents__link toc-highlight">Task Definition (MOD_NAME_tasks.h)</a></li><li><a href="#client-implementation-mod_name_clienthcc" class="table-of-contents__link toc-highlight">Client Implementation (MOD_NAME_client.h/cc)</a></li><li><a href="#chimod-createtask-pool-assignment-requirements" class="table-of-contents__link toc-highlight">ChiMod CreateTask Pool Assignment Requirements</a></li><li><a href="#chimod-name-requirements" class="table-of-contents__link toc-highlight">ChiMod Name Requirements</a></li><li><a href="#runtime-container-mod_name_runtimehcc" class="table-of-contents__link toc-highlight">Runtime Container (MOD_NAME_runtime.h/cc)</a></li><li><a href="#execution-modes-and-dynamic-scheduling" class="table-of-contents__link toc-highlight">Execution Modes and Dynamic Scheduling</a></li></ul></li><li><a href="#configuration-and-code-generation" class="table-of-contents__link toc-highlight">Configuration and Code Generation</a><ul><li><a href="#overview-1" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#chimaera_repoyaml" class="table-of-contents__link toc-highlight">chimaera_repo.yaml</a></li><li><a href="#chimaera_modyaml" class="table-of-contents__link toc-highlight">chimaera_mod.yaml</a></li><li><a href="#chi_refresh_repo-utility" class="table-of-contents__link toc-highlight">chi_refresh_repo Utility</a></li><li><a href="#workflow-summary" class="table-of-contents__link toc-highlight">Workflow Summary</a></li></ul></li><li><a href="#task-development" class="table-of-contents__link toc-highlight">Task Development</a><ul><li><a href="#task-requirements" class="table-of-contents__link toc-highlight">Task Requirements</a></li><li><a href="#optional-task-methods-copy-and-aggregate" class="table-of-contents__link toc-highlight">Optional Task Methods: Copy and Aggregate</a></li><li><a href="#task-naming-conventions" class="table-of-contents__link toc-highlight">Task Naming Conventions</a></li><li><a href="#method-system-and-auto-generated-files" class="table-of-contents__link toc-highlight">Method System and Auto-Generated Files</a></li><li><a href="#data-annotations" class="table-of-contents__link toc-highlight">Data Annotations</a></li><li><a href="#task-lifecycle" class="table-of-contents__link toc-highlight">Task Lifecycle</a></li><li><a href="#framework-del-implementation" class="table-of-contents__link toc-highlight">Framework Del Implementation</a></li></ul></li><li><a href="#synchronization-primitives" class="table-of-contents__link toc-highlight">Synchronization Primitives</a><ul><li><a href="#why-use-chimaera-synchronization-primitives" class="table-of-contents__link toc-highlight">Why Use Chimaera Synchronization Primitives?</a></li><li><a href="#comutex-cooperative-mutual-exclusion" class="table-of-contents__link toc-highlight">CoMutex: Cooperative Mutual Exclusion</a></li><li><a href="#corwlock-cooperative-reader-writer-lock" class="table-of-contents__link toc-highlight">CoRwLock: Cooperative Reader-Writer Lock</a></li><li><a href="#taskid-grouping-behavior" class="table-of-contents__link toc-highlight">TaskId Grouping Behavior</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#example-module-with-synchronized-data-structure" class="table-of-contents__link toc-highlight">Example: Module with Synchronized Data Structure</a></li></ul></li><li><a href="#pool-query-and-task-routing" class="table-of-contents__link toc-highlight">Pool Query and Task Routing</a><ul><li><a href="#overview-of-poolquery" class="table-of-contents__link toc-highlight">Overview of PoolQuery</a></li><li><a href="#poolquery-types" class="table-of-contents__link toc-highlight">PoolQuery Types</a></li><li><a href="#poolquery-usage-guidelines" class="table-of-contents__link toc-highlight">PoolQuery Usage Guidelines</a></li><li><a href="#runtime-routing-implementation" class="table-of-contents__link toc-highlight">Runtime Routing Implementation</a></li><li><a href="#poolquery-in-task-definitions" class="table-of-contents__link toc-highlight">PoolQuery in Task Definitions</a></li><li><a href="#advanced-poolquery-features" class="table-of-contents__link toc-highlight">Advanced PoolQuery Features</a></li><li><a href="#troubleshooting-poolquery-issues" class="table-of-contents__link toc-highlight">Troubleshooting PoolQuery Issues</a></li></ul></li><li><a href="#client-server-communication" class="table-of-contents__link toc-highlight">Client-Server Communication</a><ul><li><a href="#client-implementation-patterns" class="table-of-contents__link toc-highlight">Client Implementation Patterns</a></li><li><a href="#memory-segments" class="table-of-contents__link toc-highlight">Memory Segments</a></li><li><a href="#ipc-queue" class="table-of-contents__link toc-highlight">IPC Queue</a></li></ul></li><li><a href="#memory-management" class="table-of-contents__link toc-highlight">Memory Management</a><ul><li><a href="#allocator-usage" class="table-of-contents__link toc-highlight">Allocator Usage</a></li><li><a href="#best-practices-2" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#task-allocation-and-deallocation-pattern" class="table-of-contents__link toc-highlight">Task Allocation and Deallocation Pattern</a></li><li><a href="#chi_ipc-buffer-allocation" class="table-of-contents__link toc-highlight">CHI_IPC Buffer Allocation</a></li><li><a href="#shared-memory-compatible-data-structures" class="table-of-contents__link toc-highlight">Shared-Memory Compatible Data Structures</a></li><li><a href="#bulk-transfer-support-with-arbulk" class="table-of-contents__link toc-highlight">Bulk Transfer Support with ar.bulk</a></li><li><a href="#chiunordered_map_ll---lock-free-unordered-map" class="table-of-contents__link toc-highlight">chi::unordered_map_ll - Lock-Free Unordered Map</a></li></ul></li><li><a href="#build-system-integration" class="table-of-contents__link toc-highlight">Build System Integration</a><ul><li><a href="#cmakeliststxt-template" class="table-of-contents__link toc-highlight">CMakeLists.txt Template</a></li><li><a href="#cmakeliststxt-guidelines" class="table-of-contents__link toc-highlight">CMakeLists.txt Guidelines</a></li><li><a href="#chimod-build-functions-reference" class="table-of-contents__link toc-highlight">ChiMod Build Functions Reference</a></li><li><a href="#target-naming-and-linking" class="table-of-contents__link toc-highlight">Target Naming and Linking</a></li><li><a href="#automatic-dependencies" class="table-of-contents__link toc-highlight">Automatic Dependencies</a></li><li><a href="#targets-created-by-chimod-functions" class="table-of-contents__link toc-highlight">Targets Created by ChiMod Functions</a></li><li><a href="#module-configuration-chimaera_modyaml" class="table-of-contents__link toc-highlight">Module Configuration (chimaera_mod.yaml)</a></li><li><a href="#auto-generated-method-files" class="table-of-contents__link toc-highlight">Auto-Generated Method Files</a></li><li><a href="#runtime-entry-points" class="table-of-contents__link toc-highlight">Runtime Entry Points</a></li></ul></li><li><a href="#auto-generated-code-pattern" class="table-of-contents__link toc-highlight">Auto-Generated Code Pattern</a><ul><li><a href="#overview-4" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#new-pattern-auto-generated-source-files" class="table-of-contents__link toc-highlight">New Pattern: Auto-Generated Source Files</a></li><li><a href="#file-structure" class="table-of-contents__link toc-highlight">File Structure</a></li><li><a href="#auto-generated-source-template" class="table-of-contents__link toc-highlight">Auto-Generated Source Template</a></li><li><a href="#runtime-implementation-changes" class="table-of-contents__link toc-highlight">Runtime Implementation Changes</a></li><li><a href="#cmake-integration" class="table-of-contents__link toc-highlight">CMake Integration</a></li><li><a href="#benefits-of-the-new-pattern" class="table-of-contents__link toc-highlight">Benefits of the New Pattern</a></li><li><a href="#migration-guide" class="table-of-contents__link toc-highlight">Migration Guide</a></li><li><a href="#important-notes-1" class="table-of-contents__link toc-highlight">Important Notes</a></li></ul></li><li><a href="#external-chimod-development" class="table-of-contents__link toc-highlight">External ChiMod Development</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#external-chimod-repository-structure" class="table-of-contents__link toc-highlight">External ChiMod Repository Structure</a></li><li><a href="#repository-configuration-chimaera_repoyaml" class="table-of-contents__link toc-highlight">Repository Configuration (chimaera_repo.yaml)</a></li><li><a href="#root-cmakeliststxt" class="table-of-contents__link toc-highlight">Root CMakeLists.txt</a></li><li><a href="#chimod-cmakeliststxt" class="table-of-contents__link toc-highlight">ChiMod CMakeLists.txt</a></li><li><a href="#external-applications-using-your-chimod" class="table-of-contents__link toc-highlight">External Applications Using Your ChiMod</a></li><li><a href="#external-chimod-implementation" class="table-of-contents__link toc-highlight">External ChiMod Implementation</a></li><li><a href="#building-external-chimods" class="table-of-contents__link toc-highlight">Building External ChiMods</a></li><li><a href="#usage-in-applications" class="table-of-contents__link toc-highlight">Usage in Applications</a></li><li><a href="#chimaera_runtime_init-for-testing-and-benchmarks" class="table-of-contents__link toc-highlight">CHIMAERA_RUNTIME_INIT for Testing and Benchmarks</a></li><li><a href="#dependencies-and-installation-paths" class="table-of-contents__link toc-highlight">Dependencies and Installation Paths</a></li><li><a href="#common-external-development-issues" class="table-of-contents__link toc-highlight">Common External Development Issues</a></li><li><a href="#external-chimod-checklist" class="table-of-contents__link toc-highlight">External ChiMod Checklist</a></li></ul></li><li><a href="#example-module" class="table-of-contents__link toc-highlight">Example Module</a><ul><li><a href="#creating-a-new-module" class="table-of-contents__link toc-highlight">Creating a New Module</a></li></ul></li><li><a href="#recent-changes-and-best-practices" class="table-of-contents__link toc-highlight">Recent Changes and Best Practices</a><ul><li><a href="#container-initialization-pattern" class="table-of-contents__link toc-highlight">Container Initialization Pattern</a></li><li><a href="#framework-managed-task-cleanup" class="table-of-contents__link toc-highlight">Framework-Managed Task Cleanup</a></li><li><a href="#simplified-chimod-entry-points" class="table-of-contents__link toc-highlight">Simplified ChiMod Entry Points</a></li><li><a href="#fullptr-parameter-pattern" class="table-of-contents__link toc-highlight">FullPtr Parameter Pattern</a></li><li><a href="#migration-guide-1" class="table-of-contents__link toc-highlight">Migration Guide</a></li></ul></li><li><a href="#custom-namespace-configuration" class="table-of-contents__link toc-highlight">Custom Namespace Configuration</a><ul><li><a href="#overview-5" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#configuring-custom-namespace" class="table-of-contents__link toc-highlight">Configuring Custom Namespace</a></li><li><a href="#required-changes-for-custom-namespace" class="table-of-contents__link toc-highlight">Required Changes for Custom Namespace</a></li><li><a href="#checklist-for-custom-namespace" class="table-of-contents__link toc-highlight">Checklist for Custom Namespace</a></li><li><a href="#example-complete-custom-namespace-module" class="table-of-contents__link toc-highlight">Example: Complete Custom Namespace Module</a></li><li><a href="#important-notes-2" class="table-of-contents__link toc-highlight">Important Notes</a></li></ul></li><li><a href="#advanced-topics" class="table-of-contents__link toc-highlight">Advanced Topics</a><ul><li><a href="#task-scheduling" class="table-of-contents__link toc-highlight">Task Scheduling</a></li><li><a href="#automatic-routing-architecture" class="table-of-contents__link toc-highlight">Automatic Routing Architecture</a></li><li><a href="#error-handling" class="table-of-contents__link toc-highlight">Error Handling</a></li></ul></li><li><a href="#debugging-tips" class="table-of-contents__link toc-highlight">Debugging Tips</a><ul><li><a href="#common-issues-and-solutions" class="table-of-contents__link toc-highlight">Common Issues and Solutions</a></li></ul></li><li><a href="#performance-considerations-2" class="table-of-contents__link toc-highlight">Performance Considerations</a></li><li><a href="#unit-testing" class="table-of-contents__link toc-highlight">Unit Testing</a></li><li><a href="#quick-reference-checklist" class="table-of-contents__link toc-highlight">Quick Reference Checklist</a><ul><li><a href="#task-definition-checklist-_tasksh" class="table-of-contents__link toc-highlight">Task Definition Checklist (<code>_tasks.h</code>)</a></li><li><a href="#runtime-container-checklist-_runtimehcc" class="table-of-contents__link toc-highlight">Runtime Container Checklist (<code>_runtime.h/cc</code>)</a></li><li><a href="#client-api-checklist-_clienthcc" class="table-of-contents__link toc-highlight">Client API Checklist (<code>_client.h/cc</code>)</a></li><li><a href="#build-system-checklist" class="table-of-contents__link toc-highlight">Build System Checklist</a></li><li><a href="#common-pitfalls-to-avoid" class="table-of-contents__link toc-highlight">Common Pitfalls to Avoid</a></li></ul></li><li><a href="#pool-name-requirements" class="table-of-contents__link toc-highlight">Pool Name Requirements</a><ul><li><a href="#why-pool-names-are-required" class="table-of-contents__link toc-highlight">Why Pool Names Are Required</a></li><li><a href="#pool-naming-guidelines" class="table-of-contents__link toc-highlight">Pool Naming Guidelines</a></li><li><a href="#correct-pool-naming-usage" class="table-of-contents__link toc-highlight">Correct Pool Naming Usage</a></li><li><a href="#incorrect-pool-naming-usage" class="table-of-contents__link toc-highlight">Incorrect Pool Naming Usage</a></li><li><a href="#client-interface-pattern" class="table-of-contents__link toc-highlight">Client Interface Pattern</a></li><li><a href="#bdev-specific-requirements" class="table-of-contents__link toc-highlight">BDev-Specific Requirements</a></li></ul></li><li><a href="#compose-configuration-feature" class="table-of-contents__link toc-highlight">Compose Configuration Feature</a><ul><li><a href="#createparams-loadconfig-requirement" class="table-of-contents__link toc-highlight">CreateParams LoadConfig Requirement</a></li><li><a href="#compose-configuration-format" class="table-of-contents__link toc-highlight">Compose Configuration Format</a></li><li><a href="#usage-modes" class="table-of-contents__link toc-highlight">Usage Modes</a></li><li><a href="#implementation-checklist" class="table-of-contents__link toc-highlight">Implementation Checklist</a></li><li><a href="#example-admin-chimod-loadconfig" class="table-of-contents__link toc-highlight">Example Admin ChiMod LoadConfig</a></li><li><a href="#example-bdev-chimod-loadconfig" class="table-of-contents__link toc-highlight">Example BDev ChiMod LoadConfig</a></li></ul></li></ul></div></div></div></div></main></div></div></div><div class="mt-auto"><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title"> </div><ul class="footer__items clean-list"><li class="footer__item">
                <div style="display: flex; align-items: center; flex-direction: row; justify-content: left; padding: 1rem;">
                  <div style="display: flex; flex-direction: column; align-items: center;">
                    <img src="/img/iowarp_logo.png" alt="IOWarp Logo" style="height: 100px; width: auto;">
                  </div> 
                  <div style="display: flex; flex-direction: column; align-items: center;">
                    <span style="font-size: 1.25rem; font-weight: bold;">IOWarp</span>
                  </div>                  
                </div>
              </li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Quick Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/installation">Get Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://iowarp.zulipchat.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Zulip Chat<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/orgs/iowarp/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/about#contact">Contact</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Gnosis Research Center | © 2025 IOWarp Project</div></div></div></footer></div></div>
</body>
</html>